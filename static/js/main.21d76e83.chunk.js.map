{"version":3,"sources":["communication/Serial2.ts","components/Controls/Uploader.tsx","communication/parseSerial.ts","communication/Serial.ts","communication/bindingsHelper.ts","dsp/spectrum.ts","win.ts","communication/bindings.tsx","components/Plot/hooks.ts","components/Plot/TriggerVoltageHandle.tsx","components/Plot/TriggerPosHandle.tsx","components/formatters.ts","components/Plot/XAxis.tsx","components/Plot/YAxis.tsx","components/Plot/Measure.tsx","components/Plot/Plot.tsx","components/Controls/Trigger.tsx","components/Controls/Channels.tsx","components/Controls/hooks.ts","components/Controls/Amplifier.tsx","components/Controls/TimeScales.tsx","components/Controls/Scales.tsx","components/Controls/SerialControls.tsx","components/Controls/Stats.tsx","components/Controls/index.tsx","components/About.tsx","components/App.tsx","serviceWorker.ts","index.tsx"],"names":["serial","port","reader","writer","console","log","this","cancel","undefined","close","options","navigator","getPorts","Error","_connect","requestPort","baudRate","dataBits","stopBits","parity","bufferSize","rtscts","xon","xoff","open","ReadableWebToNodeStream","readable","writable","getWriter","rwStream","write","buffer","onDone","then","window","serial2","stk500","Stk500","serialOptions","board","signature","Buffer","from","pageSize","timeout","Uploader","percent","setPercent","useState","status","setStatus","isProgressHidden","setIsProgressHidden","message","setMessage","color","onClick","async","hex","fetch","process","response","text","intel_hex","parse","data","serialStream","connect","stream","opt","progress","sent","what","Math","round","length","series","sync","bind","verifySignature","setOptions","enterProgrammingMode","upload","exitProgrammingMode","bootload","e","error","toString","icon","Line","pull","count","result","slice","i","Array","get_uint8_t","res","get_bool","get_uint16_t","l","h","parseSerial","myData","triggerVoltage","triggerDir","secPerSample","arr","int","reverse","reduce","acc","curr","sign","exp","mantissa","float32","parseInt","pow","get_float32_t","triggerPos","amplifier","triggerMode","triggerChannel","isChannelOn","needData","forceUIUpdate","didTrigger","freeMemory","sentSamples","samplesPerBuffer","analogs","digitalBytes","digitals","map","mask","byte","vMax","voltageRanges","buffers","analog","n","digital","bit","channel","v","t","END_SEQUENCE","indexesOfSequence","needle","haystack","strNeedle","c","String","fromCharCode","join","strHaystack","start","indexOf","sleep","ms","Promise","r","setTimeout","readbuffer","outputDone","ports","getReader","encoder","TextEncoderStream","pipeTo","textOutputStream","onData","callback","consume","busy","end","dataFrame","checksumShould","pop","checksumIs","prev","running","value","read","push","produce","memoSelector","theAtom","selector","key","get","set","newValue","makeIntercom","ui2mcu","mcu2ui","default","defaultValue","remoteState","atom","serial_write","send","reset","DefaultValue","receive","addEventListener","getFFT","signal","dt","mid","nextPowerOf2","ceil","log2","padding","paddedSignal","fill","ft","useTriggerVoltage","vmin","vpp","voltageRangeState","useTriggerPos","samples","useSamplesPerBuffer","useSecPerSample","requestData","TriggerDirection","useTriggerDirection","RISING","FALLING","useTriggerChannel","useIsChannelOn","b","_","Boolean","constrain","min","max","useAmplifier","TriggerMode","useTriggerMode","Object","values","AUTO","dataState","isRunningState","oversamplingFactorState","XYModeState","fftState0","fftState1","didTriggerState","freeMemoryState","frequencyState","last","rollingAverage","firstCross","lastCross","getFrequencyCount","voltagesState","vmax","vavr","previous","current","sum","sendFullState","receiveFullState","allDataState","newData","win","$recoilDebugStates","some","oldBuffers","oversamplingFactor","factor","newBuffer","oldBuffer","j","oversample","SLOW","oldLastT","totalSecs","withFFT","SINGLE","margin","xDomainSelector","yDomainSelector","plotWidthSelector","plotHeightSelector","xScaleSelector","xDomain","width","d3","domain","range","yScaleSelector","yDomain","height","rangeRound","lineSelector","xScale","yScale","x","y","XYLineSelector","xMax","yMax","d","TriggerVoltageHandle","line","forwardRef","_props","ref","draggingTV","setDraggingTV","useRecoilValue","setTriggerVoltage","useRecoilState","useImperativeHandle","onMouseUp","onMouseMove","invert","nativeEvent","offsetY","scaledY","className","x1","x2","y1","y2","onMouseDown","preventDefault","stopPropagation","dy","dx","toFixed","displayName","TriggerPosHandle","draggingTP","setDraggingTP","setTriggerPos","offsetX","scaledX","float","digits","formatTime","s","Number","isNaN","m","us","formatVoltage","mv","uv","XAxis","nodeRef","useRef","gEl","useLayoutEffect","xTicks","call","g","attr","tickValues","tickPadding","tickSize","tickFormat","tickSizeOuter","select","remove","YAxis","yTicks","_d","path","Measure","dragging","setDragging","startPos","setStartPos","endPos","setEndPos","isEqual","XYCurve","xyMode","xyLine","Curves","ds","ffts","Plot","triggerPosRef","triggerVoltageRef","measureRef","containerRef","useSize","setPlotHeight","useSetRecoilState","setPlotWidth","useEffect","onMouseLeave","ButtonToolbarStyle","marginTop","display","justifyContent","alignItems","Trigger","isRunning","setTriggerMode","setTriggerChannel","triggerDirection","setTriggerDirection","tooFastForSlowMode","Panel","header","shaded","collapsible","defaultExpanded","ButtonToolbar","style","ButtonGroup","name","idx","Button","appearance","disabled","includes","size","mode","IconButton","Icon","Tag","Channels","setOversamplingFactor","setXYMode","fft0","setFFT0","fft1","setFFT1","setIsChannelOn","Slider","onChange","step","useActiveBtns","state","setState","clearTimeout","timeoutId","Amplifier","setAmplifier","isUpActive","tapUp","isDownActive","tapDown","MouseTrap","unbind","marginBottom","active","SelectPicker","searchable","cleanable","label","flex","marginLeft","marginRight","offset","list","TimeScales","setSecPerSample","isLeftActive","tapLeft","isRightActive","tapRight","perSample","secPerDivision","Scales","setIsRunning","isSpaceActive","tapSpace","backgroundColor","SerialControls","serialState","setSerialState","setAllData","connectWithPaired","catch","placement","Connected","Disconnected","FreeMemory","Frequency","frequency","hz","khz","formatFreq","Wavelength","Voltages","voltages","Stats","Controls","About","href","chromeFlagsUrl","styles","verticalAlign","App","copy","useCopy","Container","Content","Sidebar","bordered","fontSize","Steps","vertical","Item","title","description","Notification","success","alt","src","location","hostname","match","ReactDOM","render","StrictMode","document","getElementById","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.21d76e83.chunk.js","sourcesContent":["// based in wonky  https://github.com/yaakov-h/uniden-web-controller/blob/master/serial.js\nimport { ReadableWebToNodeStream } from 'readable-web-to-node-stream'\nimport { NavigatorSerial, Port, SerialOptions } from './Serial'\n\ndeclare global {\n  interface Window {\n    serial2: Serial\n  }\n  interface Navigator {\n    serial: NavigatorSerial\n  }\n}\n\nexport class Serial {\n  port?: Port\n  reader?: NodeJS.ReadableStream\n  writer?: WritableStreamDefaultWriter\n\n  async close() {\n    console.log('closing')\n    if (this.reader) {\n      // @ts-ignore\n      await this.reader.reader.cancel()\n      // await this.reader.close() // this blocks if uploading failed\n      this.reader = undefined\n    }\n    if (this.writer) {\n      await this.writer.close()\n      this.writer = undefined\n    }\n    if (this.port) {\n      await this.port.close()\n      this.port = undefined\n    }\n    console.log('closed')\n  }\n  async connectWithPaired(options: SerialOptions) {\n    const [port] = await navigator.serial.getPorts()\n    if (!port) throw new Error('no paired')\n    return this._connect(options, port)\n  }\n  async connect(options: SerialOptions) {\n    const port = await navigator.serial.requestPort({})\n    return this._connect(options, port)\n  }\n  async _connect(options: SerialOptions, port: Port) {\n    options = {\n      baudRate: 9600,\n      dataBits: 8,\n      stopBits: 1,\n      parity: 'none',\n      bufferSize: 255,\n      rtscts: false,\n      xon: false,\n      xoff: false,\n      ...options\n    }\n    if (this.port) await this.close()\n    this.port = port\n    await this.port.open(options)\n    this.reader = new ReadableWebToNodeStream(this.port.readable)\n    this.writer = this.port.writable.getWriter()\n\n    // next I'm faking a NodeJS.ReadWriteStream\n    const rwStream = (this.reader as unknown) as NodeJS.ReadWriteStream\n    // @ts-ignore\n    rwStream.write = (\n      buffer: string | Uint8Array,\n      onDone: (err: Error | null | undefined) => void\n    ) => {\n      this.writer!.write(buffer).then(() => onDone(null), onDone)\n      return true\n    }\n    return rwStream\n  }\n}\nconst serial = new Serial()\n\nexport default serial\n\nwindow.serial2 = serial\n// window.addEventListener('beforeunload', () => serial.close())\n","import React, { useState } from 'react'\nimport { Button, Icon, Progress } from 'rsuite'\nimport serial2 from '../../communication/Serial2'\nimport async from 'async'\nimport intel_hex from 'intel-hex'\nimport Stk500 from 'stk500'\n\nconst stk500 = new Stk500()\nconst bootload = async (\n  stream: NodeJS.ReadWriteStream,\n  hex: string,\n  opt: typeof board,\n  progress: (percent: number) => void\n) => {\n  let sent = 0\n  stk500.log = (what: string) => {\n    if (what === 'loaded page') {\n      sent += 1\n      const percent = Math.round((100 * sent) / (hex.length / opt.pageSize))\n      progress(percent)\n    }\n  }\n\n  await async.series([\n    // send two dummy syncs like avrdude does\n    stk500.sync.bind(stk500, stream, 3, opt.timeout),\n    stk500.sync.bind(stk500, stream, 3, opt.timeout),\n    stk500.sync.bind(stk500, stream, 3, opt.timeout),\n    stk500.verifySignature.bind(stk500, stream, opt.signature, opt.timeout),\n    stk500.setOptions.bind(stk500, stream, {}, opt.timeout),\n    stk500.enterProgrammingMode.bind(stk500, stream, opt.timeout),\n    stk500.upload.bind(stk500, stream, hex, opt.pageSize, opt.timeout),\n    // stk500.verify.bind(stk500, stream, hex, opt.pageSize, opt.timeout),\n    stk500.exitProgrammingMode.bind(stk500, stream, opt.timeout)\n  ])\n}\n\nconst serialOptions = {\n  baudRate: 57600,\n  bufferSize: 20000\n}\nconst board = {\n  signature: Buffer.from([0x1e, 0x95, 0x0f]),\n  pageSize: 128,\n  timeout: 400\n}\nfunction Uploader() {\n  const [percent, setPercent] = useState(0)\n  const [status, setStatus] = useState<'active' | 'fail' | 'success'>('active')\n  const [isProgressHidden, setIsProgressHidden] = useState(true)\n  const [message, setMessage] = useState('')\n  const onClick = async () => {\n    setMessage('Uploading...')\n    try {\n      setIsProgressHidden(true)\n      const hex = await fetch(process.env.PUBLIC_URL + '/src.ino.hex')\n        .then((response) => response.text())\n        .then((text) => intel_hex.parse(text).data)\n      const serialStream = await serial2.connect(serialOptions)\n      setStatus('active')\n      setPercent(0)\n      setIsProgressHidden(false)\n      await bootload(serialStream, hex, board, setPercent)\n      setStatus('success')\n      setMessage(`Uploaded ${hex.length} bytes.`)\n    } catch (e) {\n      console.error(e)\n      setMessage(e.toString())\n      setStatus('fail')\n    }\n    serial2.close()\n  }\n  return (\n    <>\n      <br />\n      <Button color=\"green\" onClick={onClick}>\n        <Icon icon=\"upload2\" /> Upload lgt328p Firmware\n      </Button>\n      {!isProgressHidden && (\n        <>\n          <Progress.Line percent={percent} status={status} />\n          {message}\n        </>\n      )}\n    </>\n  )\n}\n\nexport default Uploader\n","import { voltageRanges } from './bindings'\n\ntype Data = {\n  data: number[]\n  i: number\n}\n\nfunction pull(data: Data, count: number) {\n  const result = data.data.slice(data.i, data.i + count)\n  data.i += count\n  return Array.from(result)\n}\n\nfunction get_uint8_t(data: Data) {\n  const res = data.data[data.i]\n  data.i++\n  return res\n}\nconst get_bool = get_uint8_t\n\nfunction get_uint16_t(data: Data) {\n  const l = data.data[data.i]\n  data.i++\n  const h = data.data[data.i]\n  data.i++\n  return (h << 8) | l\n}\nfunction get_float32_t(data: Data) {\n  // IEEE 754\n  // https://gist.github.com/Jozo132/2c0fae763f5dc6635a6714bb741d152f#file-float32encoding-js-L32-L43\n  const arr = data.data.slice(data.i, data.i + 4)\n  data.i += 4\n\n  const int = arr.reverse().reduce((acc, curr) => (acc << 8) + curr)\n  if (int === 0) return 0\n  const sign = int >>> 31 ? -1 : 1\n  let exp = ((int >>> 23) & 0xff) - 127\n  const mantissa = ((int & 0x7fffff) + 0x800000).toString(2)\n  let float32 = 0\n  for (let i = 0; i < mantissa.length; i += 1) {\n    float32 += parseInt(mantissa[i]) ? Math.pow(2, exp) : 0\n    exp--\n  }\n  return float32 * sign\n}\n// function get_int16_t(buffer: number[]) {\n//   const raw = get_uint16_t(buffer)\n//   if (raw & (1 << 15)) {\n//     // negative\n//     return -(~raw + (1 << 16) + 1)\n//   }\n//   return raw\n// }\nexport default function parseSerial(data: number[]) {\n  const myData: Data = {\n    data,\n    i: 0\n  }\n  // input\n  const triggerVoltage = get_uint8_t(myData)\n  const triggerDir = get_uint8_t(myData)\n  const secPerSample = get_float32_t(myData)\n  const triggerPos = get_uint16_t(myData)\n  const amplifier = get_uint8_t(myData)\n  const triggerMode = get_uint8_t(myData)\n  const triggerChannel = get_uint8_t(myData)\n  const isChannelOn = get_uint8_t(myData)\n  // input output\n  // output\n  const needData = get_bool(myData)\n  const forceUIUpdate = get_bool(myData)\n  const didTrigger = get_bool(myData)\n  const freeMemory = get_uint16_t(myData)\n  const sentSamples = get_uint16_t(myData)\n  const samplesPerBuffer = get_uint16_t(myData)\n  const analogs = [\n    isChannelOn & 0b1 ? pull(myData, sentSamples) : [],\n    isChannelOn & 0b10 ? pull(myData, sentSamples) : []\n  ]\n  const digitalBytes = isChannelOn & 0b11111100 ? pull(myData, sentSamples) : []\n  const digitals = [0b000100, 0b001000, 0b010000, 0b100000].map((mask) => {\n    if (isChannelOn & mask) {\n      return digitalBytes.map((byte) => byte & mask && 1)\n    }\n    return []\n  })\n  const vMax = voltageRanges[amplifier]\n  const buffers = [\n    ...analogs.map((analog) => analog.map((n) => (n / 256) * vMax)),\n    ...digitals.map((digital, i) =>\n      digital.map((bit) => (bit * vMax) / 8 + ((i + 0.25) * vMax) / 4)\n    )\n  ].map((channel) => channel.map((v, i) => ({ v, t: (i + 1) * secPerSample })))\n\n  return {\n    //input\n    triggerVoltage,\n    triggerDir,\n    secPerSample,\n    triggerPos,\n    amplifier,\n    triggerMode,\n    triggerChannel,\n    isChannelOn,\n    // output\n    needData,\n    forceUIUpdate,\n    didTrigger,\n    freeMemory,\n    samplesPerBuffer,\n    buffers\n  }\n}\n","// based in wonky  https://github.com/yaakov-h/uniden-web-controller/blob/master/serial.js\n\nexport type Port = {\n  readable: ReadableStream\n  writable: WritableStream\n  open: (options: SerialOptions) => Promise<void>\n  close: () => Promise<void>\n}\nexport type NavigatorSerial = {\n  requestPort: (optn: unknown) => Port\n  getPorts: () => Promise<Port[]>\n}\nexport type SerialOptions = {\n  baudRate?: number\n  dataBits?: number\n  stopBits?: number\n  parity?: string\n  bufferSize?: number\n  rtscts?: boolean\n  xon?: boolean\n  xoff?: boolean\n  xany?: boolean\n}\ndeclare global {\n  interface Window {\n    serial: Serial\n  }\n  interface Navigator {\n    serial: NavigatorSerial\n  }\n}\nconst END_SEQUENCE = [0, 1, 255, 253]\nconst indexesOfSequence = (needle: number[], haystack: number[]) => {\n  const strNeedle = needle.map((c) => String.fromCharCode(c)).join('')\n  const strHaystack = haystack.map((c) => String.fromCharCode(c)).join('')\n  const start = strHaystack.indexOf(strNeedle)\n  const end = strHaystack.indexOf(strNeedle, start + strNeedle.length)\n  return [start, end]\n}\n\nconst sleep = (ms: number) => new Promise((r) => setTimeout(r, ms))\n\nexport class Serial {\n  reader?: ReadableStreamDefaultReader\n  writer?: WritableStreamDefaultWriter\n  port?: Port\n  readbuffer: number[] = []\n  outputDone?: Promise<void>\n  async close() {\n    console.log('closing')\n    if (this.reader) {\n      await this.reader.cancel()\n      this.reader = undefined\n    }\n    if (this.writer) {\n      await this.writer.close()\n      this.writer = undefined\n    }\n    if (this.outputDone) {\n      await this.outputDone\n      this.outputDone = undefined\n    }\n    if (this.port) {\n      await this.port.close()\n      this.port = undefined\n    }\n    console.log('closed')\n  }\n  async connectWithPaired(options: SerialOptions) {\n    const ports = await navigator.serial.getPorts()\n    console.log(ports)\n    if (!ports.length) throw new Error('no paired')\n    this._connect(options, ports[0])\n  }\n  async connect(options: SerialOptions) {\n    const port = await navigator.serial.requestPort({})\n    this._connect(options, port)\n  }\n  async _connect(options: SerialOptions, port: Port) {\n    options = {\n      baudRate: 9600,\n      dataBits: 8,\n      stopBits: 1,\n      parity: 'none',\n      bufferSize: 255,\n      rtscts: false,\n      xon: false,\n      xoff: false,\n      ...options\n    }\n    if (this.port) await this.close()\n    this.port = port\n    await this.port.open(options)\n    this.readbuffer = []\n    this.reader = this.port.readable.getReader()\n    // this.writer = this.port.writable.getWriter() // binary\n    const encoder = new TextEncoderStream()\n    this.outputDone = encoder.readable.pipeTo(this.port.writable)\n    const textOutputStream = encoder.writable\n    this.writer = textOutputStream.getWriter()\n  }\n\n  write = async (text: string) => {\n    if (!this.writer) return\n    await this.writer.write(text)\n  }\n  onData(callback: (data: number[]) => unknown) {\n    const consume = () => {\n      let busy = true\n      while (busy) {\n        const [start, end] = indexesOfSequence(END_SEQUENCE, this.readbuffer)\n        if (start > -1 && end > -1) {\n          const dataFrame = this.readbuffer.slice(\n            start + END_SEQUENCE.length,\n            end\n          )\n          this.readbuffer = this.readbuffer.slice(end)\n          const checksumShould = (dataFrame.pop()! << 8) + dataFrame.pop()!\n          const checksumIs =\n            dataFrame.reduce((prev, curr) => prev + curr, 0) % Math.pow(2, 16)\n          if (checksumShould === checksumIs) {\n            callback(dataFrame)\n          } else {\n            console.error(`Checksum error: ${checksumIs}≠${checksumShould}`)\n            // callback(dataFrame)\n          }\n        } else {\n          busy = false\n        }\n      }\n    }\n    let running = true\n    const produce = async () => {\n      while (running) {\n        await sleep(16)\n        if (!this.reader) continue\n        const { value } = await this.reader.read()\n        if (value !== undefined) {\n          this.readbuffer.push(...value)\n          consume()\n        }\n      }\n    }\n\n    produce()\n    // consume()\n    return () => {\n      running = false\n    }\n  }\n}\nconst serial = new Serial()\n\nexport default serial\n\nwindow.serial = serial\nwindow.addEventListener('beforeunload', () => serial.close())\n","import { atom, selector, DefaultValue, RecoilState, RecoilValue } from 'recoil'\nimport serial from './Serial'\n\nexport function memoSelector<T>(theAtom: RecoilState<T>) {\n  return selector<T>({\n    key: 'memo' + theAtom.key,\n    get: ({ get }) => get(theAtom),\n    set: ({ set, get }, newValue) => {\n      const old = get(theAtom)\n      if (old !== newValue) {\n        set(theAtom, newValue)\n      }\n    }\n  })\n}\ntype GetRecoilValue = <T>(recoilVal: RecoilValue<T>) => T\nexport function makeIntercom<T>({\n  key,\n  ui2mcu,\n  mcu2ui,\n  default: defaultValue\n}: {\n  key: string\n  ui2mcu: (v: T, get: GetRecoilValue | null) => number\n  mcu2ui: (v: number, get: GetRecoilValue | null) => T\n  default: T\n}) {\n  const remoteState = memoSelector(\n    atom<number>({\n      key,\n      default: ui2mcu(defaultValue, null)\n    })\n  )\n\n  // throttle to avoid filling the MCU serial buffer\n  const serial_write = serial.write\n  // const serial_write = throttle(serial.write, 40, {\n  //   leading: false,\n  //   trailing: true\n  // })\n  const send = selector<T>({\n    key: key + '-selector',\n    get: ({ get }) => mcu2ui(get(remoteState), get),\n    set: ({ set, get, reset }, newValue) => {\n      if (newValue instanceof DefaultValue) return reset(remoteState)\n      set(remoteState, ui2mcu(newValue, get))\n      serial_write(key + ui2mcu(newValue, get) + '>')\n    }\n  })\n  const receive = selector<number>({\n    key: key + '-receive-selector',\n    get: () => {\n      throw new Error('cant get here')\n    },\n    set: ({ set }, newValue) => {\n      if (newValue instanceof DefaultValue) throw new Error('no reset allowed')\n      set(remoteState, newValue)\n    }\n  })\n\n  return { send, receive }\n}\n","import ft from 'fourier-transform'\nimport { PlotDatum } from '../communication/bindings'\n\nconst average = (arr: number[]) =>\n  arr.reduce((acc, n) => acc + n, 0) / arr.length\nexport function getFFT(data: PlotDatum[]) {\n  let signal = data.map(({ v }) => v)\n  if (signal.length === 0) return []\n  if (signal.length < 2) {\n    console.log('fix me')\n    return []\n  }\n  const length = data.length\n  const dt = data[length - 1].t - data[length - 2].t\n\n  const mid = average(signal)\n  signal = signal.map((v) => v - mid)\n  // const nextPowerOf2 = Math.ceil(Math.log2(signal.length))\n  const nextPowerOf2 = Math.ceil(Math.log2(512))\n  const padding = Math.pow(2, nextPowerOf2) - signal.length\n  let paddedSignal = signal\n  if (padding > 0) {\n    paddedSignal = [...signal, ...Array(padding).fill(0)]\n  }\n  if (padding < 0) {\n    paddedSignal = signal.slice(0, 512)\n  }\n  const fft = ft(paddedSignal)\n  // https://www.dsprelated.com/showthread/comp.dsp/87526-1.php\n  const normalized = fft.map((v) => (512 * v) / signal.length)\n  // const normalized = fft.map((v) => v * 2)\n  return normalized.map((v, i) => ({ v, t: dt * i }))\n}\n\nexport function rollingAverage(signal: number[]) {\n  // exponential averaging is used to remove wrong frequency readings due to noise\n  let last = signal[0]\n  return signal.map((n) => {\n    last = last * 0.5 + n * 0.5\n    return last\n  })\n}\nexport function getFrequencyCount(data: PlotDatum[]) {\n  if (data.length < 2) return 0\n  const signal = rollingAverage(data.map(({ v }) => v))\n  const max = Math.max(...signal)\n  const min = Math.min(...signal)\n  const mid = (max + min) / 2\n  let firstCross = -1\n  let lastCross = 0\n  let count = 0\n  for (let i = 1; i < data.length; i++) {\n    const risingCross = data[i - 1].v < mid && data[i].v >= mid\n    if (risingCross) {\n      count++\n      if (firstCross < 0) firstCross = data[i].t\n      lastCross = data[i].t\n    }\n  }\n  return (count - 1) / (lastCross - firstCross)\n}\n\nexport function oversample(\n  factor: number,\n  newBuffer: PlotDatum[],\n  oldBuffer: PlotDatum[]\n) {\n  return newBuffer.map(({ v, t }, j) => ({\n    t,\n    v: (oldBuffer[j]?.v || 0) * factor + v * (1 - factor)\n  }))\n}\n","export default window as any\n","import { atom, selector, DefaultValue } from 'recoil'\nimport parseSerial from './parseSerial'\nimport { makeIntercom, memoSelector } from './bindingsHelper'\nimport { getFFT, getFrequencyCount, oversample } from '../dsp/spectrum'\nimport win from '../win'\n\nexport const useTriggerVoltage = makeIntercom<number>({\n  key: 'V',\n  ui2mcu: (v, get) => {\n    const [vmin, , vpp] = get ? get(voltageRangeState) : [0, 5, 5]\n    return Math.ceil(((v + vmin) / vpp) * 255)\n  },\n  mcu2ui: (n, get) => {\n    const [vmin, , vpp] = get ? get(voltageRangeState) : [0, 5, 5]\n    return (n / 255) * vpp + vmin\n  },\n  default: 1\n})\nexport const useTriggerPos = makeIntercom<number>({\n  key: 'P',\n  ui2mcu: (v, get) => {\n    const samples = get ? get(useSamplesPerBuffer.send) : 512\n    const result = v * samples\n    if (result < 0) return 0\n    if (result > samples - 1) return samples - 1\n    return result\n  },\n  mcu2ui: (v, get) => {\n    const samples = get ? get(useSamplesPerBuffer.send) : 512\n    return v / samples\n  },\n  default: 0.5\n})\nexport const useSecPerSample = makeIntercom<number>({\n  key: 'C',\n  ui2mcu: (v) => v,\n  mcu2ui: (v) => v,\n  default: 0.00000275\n})\nexport const requestData = makeIntercom<number>({\n  key: 'R',\n  ui2mcu: (v) => v,\n  mcu2ui: (v) => v,\n  default: 0\n})\nexport enum TriggerDirection {\n  FALLING = 'Falling',\n  RISING = 'Rising'\n}\nexport const useTriggerDirection = makeIntercom<TriggerDirection>({\n  key: 'D',\n  ui2mcu: (v) => (v === TriggerDirection.RISING ? 0 : 1),\n  mcu2ui: (v) => (v ? TriggerDirection.FALLING : TriggerDirection.RISING),\n  default: TriggerDirection.FALLING\n})\nexport const useTriggerChannel = makeIntercom<number>({\n  key: 'T',\n  ui2mcu: (v) => v,\n  mcu2ui: (v) => v,\n  default: 0\n})\nexport const useIsChannelOn = makeIntercom<boolean[]>({\n  key: 'B',\n  ui2mcu: (v) => {\n    const result = v\n      .map((b) => (b ? 1 : 0) as number)\n      .reduce((acc, n, i) => acc + (n << i), 0)\n    return result\n  },\n  mcu2ui: (v) => {\n    const result = Array(8)\n      .fill(0)\n      .map((_, i) => Boolean(v & (1 << i)))\n    return result\n  },\n  default: [true, false, false, false, false, false]\n})\n\nexport const constrain = (v: number, min: number, max: number) =>\n  v < min ? min : v > max ? max : v\nexport const voltageRanges = [\n  25,\n  6.25,\n  5,\n  3.125,\n  1.5625,\n  0.78125,\n  0.78125,\n  0.625,\n  0.390625,\n  0.3125,\n  0.1953125,\n  0.15625\n]\nexport const useAmplifier = makeIntercom<number>({\n  key: 'A',\n  ui2mcu: (v) => constrain(v, 0, voltageRanges.length - 1),\n  mcu2ui: (v) => v,\n  default: 1 //TODO: use volt range or per division\n})\nexport const useSamplesPerBuffer = makeIntercom<number>({\n  key: 'S',\n  ui2mcu: (v) => v,\n  mcu2ui: (v) => v,\n  default: 512 // TODO: this shouldn't be a setter\n})\nexport enum TriggerMode {\n  AUTO = 'Auto',\n  NORMAL = 'Normal',\n  SINGLE = 'Single',\n  SLOW = 'Slow'\n}\n\nexport const useTriggerMode = makeIntercom<TriggerMode>({\n  key: 'M',\n  ui2mcu: (v) => Object.values(TriggerMode).indexOf(v),\n  mcu2ui: (v) => Object.values(TriggerMode)[v],\n  default: TriggerMode.AUTO\n})\n\nexport type PlotDatum = { t: number; v: number }\nexport const dataState = atom({\n  key: 'data',\n  default: [...new Array(8)].map(() => [] as PlotDatum[])\n})\n\nexport const isRunningState = memoSelector(\n  atom({\n    key: 'is-running',\n    default: true\n  })\n)\nexport const oversamplingFactorState = memoSelector(\n  atom({\n    key: 'oversampling-factor',\n    default: 0\n  })\n)\nexport const XYModeState = atom({\n  key: 'xy-mode',\n  default: false\n})\nexport const fftState0 = atom({\n  key: 'fft0',\n  default: false\n})\nexport const fftState1 = atom({\n  key: 'fft1',\n  default: false\n})\n\nexport const didTriggerState = memoSelector(\n  atom({\n    key: 'did-trigger',\n    default: false\n  })\n)\nexport const freeMemoryState = memoSelector(\n  atom({\n    key: 'free-memory',\n    default: 0\n  })\n)\nexport const frequencyState = selector({\n  key: 'frequency',\n  get: ({ get }) => getFrequencyCount(get(dataState)[0])\n})\n\nconst sum = (signal: number[]) =>\n  signal.reduce((previous, current) => previous + current, 0)\nexport const voltagesState = selector({\n  key: 'voltages',\n  get: ({ get }) => {\n    const signal = get(dataState)[0].map(({ v }) => v)\n    const vmax = Math.max(...signal)\n    const vmin = Math.min(...signal)\n    const vpp = vmax - vmin\n    const vavr = sum(signal) / signal.length\n\n    return {\n      vavr,\n      vpp,\n      vmin,\n      vmax\n    }\n  }\n})\n\nexport const voltageRangeState = selector({\n  key: 'voltage-range',\n  get: ({ get }) => {\n    //https://docs.google.com/spreadsheets/d/1urWB28qDmB_LL_khdBBfB-djku5h4lSx-Cw9l7Rz1u8/edit?usp=sharing\n    // TODO: do this in another way\n    // TODO: account for the last fifth of the ADC, which is not usable\n    const vmax = voltageRanges[get(useAmplifier.send)]\n    const vmin = 0\n    return [vmin, vmax, vmax - vmin]\n  }\n})\n\nconst sendFullState = selector<null>({\n  key: 'sendFullState-this shouldnt be a selector',\n  get: () => null,\n  set: ({ get, set }) => {\n    set(useTriggerPos.send, get(useTriggerPos.send))\n    set(useSecPerSample.send, get(useSecPerSample.send))\n    set(useSamplesPerBuffer.send, get(useSamplesPerBuffer.send))\n    set(useAmplifier.send, get(useAmplifier.send))\n    set(useTriggerVoltage.send, get(useTriggerVoltage.send))\n    set(useTriggerDirection.send, get(useTriggerDirection.send))\n    set(useTriggerChannel.send, get(useTriggerChannel.send))\n    set(useTriggerMode.send, get(useTriggerMode.send))\n    set(useIsChannelOn.send, get(useIsChannelOn.send))\n  }\n})\n\ntype Data = ReturnType<typeof parseSerial>\nconst receiveFullState = selector<Data>({\n  key: 'receiveFullState-this shouldnt be a selector',\n  get: () => {\n    throw new Error('write only selector')\n  },\n  set: ({ set }, data) => {\n    if (data instanceof DefaultValue) return\n    set(useTriggerPos.receive, data.triggerPos)\n    set(useSecPerSample.receive, data.secPerSample)\n    set(useSamplesPerBuffer.receive, data.samplesPerBuffer)\n    set(useAmplifier.receive, data.amplifier)\n    set(useTriggerVoltage.receive, data.triggerVoltage)\n    set(useTriggerDirection.receive, data.triggerDir)\n    set(useTriggerChannel.receive, data.triggerChannel)\n    set(useTriggerMode.receive, data.triggerMode)\n    set(useIsChannelOn.receive, data.isChannelOn)\n  }\n})\n\nexport const allDataState = selector<number[]>({\n  key: 'all-data-this shouldnt be a selector',\n  get: () => [], // this is a write only selector\n  set: ({ set, get }, newData) => {\n    win.$recoilDebugStates = [] // TODO: fix memory leak in recoiljs beta\n    if (newData instanceof DefaultValue) return\n    if (newData.length === 0) return\n    const data = parseSerial(newData)\n    if (data.needData) set(sendFullState, null)\n    if (data.forceUIUpdate) set(receiveFullState, data)\n\n    let buffers = data.buffers\n\n    set(freeMemoryState, data.freeMemory)\n    set(didTriggerState, !!data.didTrigger)\n    const shouldUpdate =\n      // todo use isRunning state in board for this\n      get(isRunningState) && buffers.some((buffer) => buffer.length > 0)\n    if (shouldUpdate) {\n      const oldBuffers = get(dataState)\n\n      const oversamplingFactor = get(oversamplingFactorState)\n      if (oversamplingFactor > 0) {\n        const factor = 1 - 2 / (oversamplingFactor + 1)\n        buffers = buffers.map((b, i) =>\n          oversample(factor, buffers[i], oldBuffers[i])\n        )\n      }\n\n      if (get(useTriggerMode.send) === TriggerMode.SLOW) {\n        const oldLastT = Math.max(\n          ...oldBuffers.map((b) => b[b.length - 1]?.t || 0)\n        )\n\n        buffers = buffers.map((b, i) => [\n          ...oldBuffers[i],\n          ...b.map(({ v, t }) => ({ v, t: t + oldLastT }))\n        ])\n        const totalSecs =\n          get(useSecPerSample.send) * get(useSamplesPerBuffer.send)\n        const lastT = Math.max(...buffers.map((b) => b[b.length - 1]?.t || 0))\n        if (lastT > totalSecs) {\n          buffers = buffers.map(() => [])\n        }\n      }\n      const withFFT = [\n        ...buffers,\n        get(fftState0) ? getFFT(buffers[0]) : [],\n        get(fftState1) ? getFFT(buffers[1]) : []\n      ]\n\n      set(dataState, withFFT)\n      if (get(useTriggerMode.send) === TriggerMode.SINGLE) {\n        set(isRunningState, false)\n      }\n    }\n  }\n})\n","import * as d3 from 'd3'\n\nimport {\n  useSecPerSample,\n  dataState,\n  useSamplesPerBuffer,\n  voltageRangeState\n} from '../../communication/bindings'\nimport { selector, atom } from 'recoil'\nimport { memoSelector } from '../../communication/bindingsHelper'\nexport const margin = { top: 20, right: 50, bottom: 30, left: 50 }\n\nexport const xDomainSelector = selector({\n  key: 'xDomain',\n  get: ({ get }) => {\n    const xMax = get(useSecPerSample.send) * get(useSamplesPerBuffer.send)\n    return [0, xMax] as [number, number]\n  }\n})\nexport const yDomainSelector = voltageRangeState\n\nexport const plotWidthSelector = memoSelector(\n  atom({\n    key: 'plot-width',\n    default: 0\n  })\n)\nexport const plotHeightSelector = memoSelector(\n  atom({\n    key: 'plot-height',\n    default: 0\n  })\n)\nexport const xScaleSelector = selector({\n  key: 'xScale',\n  get: ({ get }) => {\n    const xDomain = get(xDomainSelector)\n    const width = get(plotWidthSelector)\n    return d3\n      .scaleLinear()\n      .domain(xDomain)\n      .range([margin.left, width - margin.right])\n  }\n})\nexport const yScaleSelector = selector({\n  key: 'yScale',\n  get: ({ get }) => {\n    const yDomain = get(yDomainSelector)\n    const height = get(plotHeightSelector)\n    return d3\n      .scaleLinear()\n      .domain(yDomain)\n      .rangeRound([height - margin.bottom, margin.top])\n  }\n})\nexport const lineSelector = selector({\n  key: 'line',\n  get: ({ get }) => {\n    const xScale = get(xScaleSelector)\n    const yScale = get(yScaleSelector)\n\n    return d3\n      .line<{ v: number; t: number }>()\n      .x(({ t }) => xScale(t))\n      .y(({ v }) => yScale(v))\n  }\n})\nexport const XYLineSelector = selector({\n  key: 'xy-line',\n  get: ({ get }) => {\n    const yScale = get(yScaleSelector)\n    const xScale = get(xScaleSelector)\n    const [, xMax] = get(xDomainSelector)\n    const [, yMax] = get(yDomainSelector)\n\n    return d3\n      .line<[number, number]>()\n      .x((d) => xScale((d[1] / yMax) * xMax))\n      .y((d) => yScale(-d[0]))\n  }\n})\nexport const plotDataSelector = selector({\n  key: 'plot-data',\n  get: ({ get }) => {\n    const data = get(dataState)\n    const line = get(lineSelector)\n    return data.map((data) => line(data) || undefined)\n  }\n})\n","import React, {\n  forwardRef,\n  MouseEventHandler,\n  useImperativeHandle,\n  useState\n} from 'react'\n\nimport { useTriggerVoltage } from '../../communication/bindings'\nimport { useRecoilState, useRecoilValue } from 'recoil'\nimport { margin, plotWidthSelector, yScaleSelector } from './hooks'\n\nexport type TriggerVoltageRef = {\n  onMouseUp: MouseEventHandler\n  onMouseMove: MouseEventHandler\n}\n\nconst TriggerVoltageHandle = forwardRef<TriggerVoltageRef>((_props, ref) => {\n  const [draggingTV, setDraggingTV] = useState(false)\n  const yScale = useRecoilValue(yScaleSelector)\n  const width = useRecoilValue(plotWidthSelector)\n  const [triggerVoltage, setTriggerVoltage] = useRecoilState(\n    useTriggerVoltage.send\n  )\n  useImperativeHandle(ref, () => ({\n    onMouseUp() {\n      setDraggingTV(false)\n    },\n    onMouseMove(e) {\n      if (draggingTV) {\n        setTriggerVoltage(yScale.invert(e.nativeEvent.offsetY))\n      }\n    }\n  }))\n  const scaledY = yScale(triggerVoltage)\n  return (\n    <>\n      <line\n        className=\"triggerVoltage\"\n        x1={margin.left}\n        x2={width - margin.right}\n        y1={scaledY}\n        y2={scaledY}\n      ></line>\n      <line\n        className=\"triggerVoltageHandle\"\n        onMouseDown={(e) => {\n          e.preventDefault()\n          e.stopPropagation()\n          setDraggingTV(true)\n        }}\n        x1={margin.left}\n        x2={width - margin.right}\n        y1={scaledY}\n        y2={scaledY}\n      ></line>\n      <text\n        fill=\"currentColor\"\n        y={scaledY}\n        x={width - margin.right}\n        dy=\".32em\"\n        dx=\"10\"\n      >\n        {triggerVoltage.toFixed(2)}v\n      </text>\n    </>\n  )\n})\n\nTriggerVoltageHandle.displayName = 'TriggerVoltageHandle'\n\nexport default TriggerVoltageHandle\n","import React, {\n  forwardRef,\n  MouseEventHandler,\n  useImperativeHandle,\n  useState\n} from 'react'\n\nimport { useRecoilState, useRecoilValue } from 'recoil'\nimport { useTriggerPos } from '../../communication/bindings'\nimport {\n  margin,\n  plotHeightSelector,\n  xDomainSelector,\n  xScaleSelector\n} from './hooks'\n\nexport type TriggerPosRef = {\n  onMouseUp: MouseEventHandler\n  onMouseMove: MouseEventHandler\n}\n\nconst TriggerPosHandle = forwardRef<TriggerPosRef>((_props, ref) => {\n  const [draggingTP, setDraggingTP] = useState(false)\n  const xScale = useRecoilValue(xScaleSelector)\n  const height = useRecoilValue(plotHeightSelector)\n  const [triggerPos, setTriggerPos] = useRecoilState(useTriggerPos.send)\n\n  const xDomain = useRecoilValue(xDomainSelector)\n  useImperativeHandle(ref, () => ({\n    onMouseUp() {\n      setDraggingTP(false)\n    },\n    onMouseMove(e) {\n      if (draggingTP) {\n        setTriggerPos(xScale.invert(e.nativeEvent.offsetX) / xDomain[1])\n      }\n    }\n  }))\n  const scaledX = xScale(triggerPos * xDomain[1])\n\n  return (\n    <>\n      <line\n        className=\"triggerPos\"\n        x1={scaledX}\n        x2={scaledX}\n        y1={height - margin.bottom}\n        y2={margin.top}\n      ></line>\n      <line\n        className=\"triggerPosHandle\"\n        onMouseDown={(e) => {\n          e.preventDefault()\n          e.stopPropagation()\n          setDraggingTP(true)\n        }}\n        x1={scaledX}\n        x2={scaledX}\n        y1={height - margin.bottom}\n        y2={margin.top}\n      ></line>\n      <text fill=\"currentColor\" x={scaledX} dx=\"-1em\" dy=\"1em\">\n        {Math.round(triggerPos * 100)}%\n      </text>\n    </>\n  )\n})\n\nTriggerPosHandle.displayName = 'TriggerPosHandle'\nexport default TriggerPosHandle\n","const toFixed = (float: number, digits = 0) => {\n  const padding = Math.pow(10, digits)\n  return (Math.round(float * padding) / padding).toFixed(digits)\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype ohNoItIsAny = any\n\nexport function formatTime(s: ohNoItIsAny) {\n  s = Number(s)\n  if (Number.isNaN(s)) return '--'\n\n  const m = s / 60\n  const h = s / 60 / 60\n  const ms = s * 1000\n  const us = ms * 1000\n  if (us < 1000) return toFixed(us, 0) + 'μs'\n  if (ms < 10) return toFixed(ms, 2) + 'ms'\n  if (ms < 1000) return toFixed(ms) + 'ms'\n  if (s < 10) return toFixed(s, 1) + 's'\n  if (h > 1) return toFixed(h, 0) + 'h' + toFixed(m % 60, 1) + 'm'\n  if (m > 5) return toFixed(m, 0) + 'm' + toFixed(s % 60, 1) + 's'\n  return toFixed(s, 0) + 's'\n}\n\nexport function formatFreq(hz: number) {\n  if (hz > 0) {\n    const khz = hz / 1000\n    if (hz < 1000) return toFixed(hz) + 'Hz'\n    if (khz < 10) return toFixed(khz, 2) + 'KHz'\n    return toFixed(khz) + 'KHz'\n  }\n  return '--'\n}\nexport function formatVoltage(v: number): string {\n  if (v < 0) return '-' + formatVoltage(-v)\n  const mv = v * 1000\n  const uv = mv * 1000\n  if (uv < 10) return toFixed(uv, 2) + 'µv'\n  if (uv < 50) return toFixed(uv, 1) + 'µv'\n  if (uv < 1000) return toFixed(uv, 0) + 'µv'\n  if (mv < 10) return toFixed(mv, 2) + 'mv'\n  if (mv < 50) return toFixed(mv, 1) + 'mv'\n  if (mv < 1000) return toFixed(mv, 0) + 'mv'\n  return toFixed(v, 2) + 'v'\n}\n","import * as d3 from 'd3'\nimport React, { useRef, useLayoutEffect } from 'react'\n\nimport { useRecoilValue } from 'recoil'\nimport { margin, plotHeightSelector, xScaleSelector } from './hooks'\nimport { formatTime } from '../formatters'\n\nexport default function XAxis() {\n  const nodeRef = useRef<SVGSVGElement>(null)\n  const height = useRecoilValue(plotHeightSelector)\n  const xScale = useRecoilValue(xScaleSelector)\n  const gEl = nodeRef.current\n  useLayoutEffect(() => {\n    if (!gEl) return\n    const xTicks = d3.ticks(xScale.domain()[0], xScale.domain()[1], 10)\n    d3.select(gEl).call((g) =>\n      g\n        .attr('transform', `translate(0,${height - margin.bottom})`)\n        .call(\n          d3\n            .axisBottom(xScale)\n            .tickValues(xTicks)\n            .tickPadding(10)\n            .tickSize(-height + margin.top + margin.bottom)\n            .tickFormat(formatTime)\n            .tickSizeOuter(0)\n        )\n        .call((g) => g.select('.domain').remove())\n    )\n  }, [gEl, xScale, height])\n\n  return <g className=\"x axis\" ref={nodeRef} />\n}\n","import * as d3 from 'd3'\nimport React, { useRef, useLayoutEffect } from 'react'\n\nimport { useRecoilValue } from 'recoil'\nimport { margin, plotWidthSelector, yScaleSelector } from './hooks'\n\nexport default function YAxis() {\n  const nodeRef = useRef<SVGSVGElement>(null)\n  const width = useRecoilValue(plotWidthSelector)\n  const yScale = useRecoilValue(yScaleSelector)\n  const gEl = nodeRef.current\n\n  useLayoutEffect(() => {\n    if (!gEl) return\n    const yTicks = d3.ticks(yScale.domain()[0], yScale.domain()[1], 10)\n    d3.select(gEl)\n      .call((g) =>\n        g.attr('transform', `translate(${margin.left},0)`).call(\n          d3\n            .axisLeft(yScale)\n            .tickValues(yTicks)\n            .tickPadding(10)\n            .tickSize(-width + margin.right + margin.left - 1)\n            .tickFormat((v) => v + 'v')\n        )\n      )\n      .call((g) =>\n        g.select('.domain').attr(\n          'd',\n          (_d, _, path) =>\n            // close path so the domain has a right border\n            d3.select(path[0]).attr('d') + 'z'\n        )\n      )\n  }, [gEl, yScale, width])\n\n  return <g className=\"y axis\" ref={nodeRef} />\n}\n","import { isEqual } from 'lodash'\nimport React, {\n  forwardRef,\n  MouseEventHandler,\n  useImperativeHandle,\n  useState\n} from 'react'\n\nimport { useRecoilValue } from 'recoil'\nimport { formatTime, formatVoltage } from '../formatters'\nimport { xScaleSelector, yScaleSelector } from './hooks'\n\nexport type MeasureRef = {\n  onMouseDown: MouseEventHandler\n  onMouseUp: MouseEventHandler\n  onMouseMove: MouseEventHandler\n}\n\nconst Measure = forwardRef<MeasureRef>((_props, ref) => {\n  const [dragging, setDragging] = useState(false)\n  const xScale = useRecoilValue(xScaleSelector)\n  const yScale = useRecoilValue(yScaleSelector)\n  const [startPos, setStartPos] = useState({ x: -1, y: -1 })\n  const [endPos, setEndPos] = useState({ x: -1, y: -1 })\n  useImperativeHandle(ref, () => ({\n    onMouseDown(e) {\n      setStartPos({\n        x: xScale.invert(e.nativeEvent.offsetX),\n        y: yScale.invert(e.nativeEvent.offsetY)\n      })\n      setEndPos({\n        x: xScale.invert(e.nativeEvent.offsetX),\n        y: yScale.invert(e.nativeEvent.offsetY)\n      })\n      setDragging(true)\n    },\n    onMouseUp(e) {\n      if (dragging) {\n        setEndPos({\n          x: xScale.invert(e.nativeEvent.offsetX),\n          y: yScale.invert(e.nativeEvent.offsetY)\n        })\n        setDragging(false)\n      }\n    },\n    onMouseMove(e) {\n      if (dragging) {\n        setEndPos({\n          x: xScale.invert(e.nativeEvent.offsetX),\n          y: yScale.invert(e.nativeEvent.offsetY)\n        })\n      }\n    }\n  }))\n  if (isEqual(startPos, endPos)) return <></>\n  return (\n    <g className=\"Measure\">\n      <line\n        className=\"measureCap\"\n        x1={xScale(startPos.x) - 5}\n        x2={xScale(startPos.x) + 5}\n        y1={yScale(startPos.y) - 5}\n        y2={yScale(startPos.y) + 5}\n      ></line>\n      <line\n        className=\"measureCap\"\n        x1={xScale(startPos.x) - 5}\n        x2={xScale(startPos.x) + 5}\n        y1={yScale(startPos.y) + 5}\n        y2={yScale(startPos.y) - 5}\n      ></line>\n      <line\n        className=\"measureX\"\n        x1={xScale(startPos.x)}\n        x2={xScale(endPos.x)}\n        y1={yScale(startPos.y)}\n        y2={yScale(startPos.y)}\n      ></line>\n      <text\n        fill=\"currentColor\"\n        x={xScale((startPos.x + endPos.x) / 2)}\n        y={yScale(startPos.y)}\n        dx=\"-1em\"\n        dy=\"1.5em\"\n      >\n        {formatTime(endPos.x - startPos.x)}\n      </text>\n      <line\n        className=\"measureCap\"\n        x1={xScale(endPos.x) - 5}\n        x2={xScale(endPos.x) + 5}\n        y1={yScale(endPos.y) - 5}\n        y2={yScale(endPos.y) + 5}\n      ></line>\n      <line\n        className=\"measureCap\"\n        x1={xScale(endPos.x) - 5}\n        x2={xScale(endPos.x) + 5}\n        y1={yScale(endPos.y) + 5}\n        y2={yScale(endPos.y) - 5}\n      ></line>\n      <line\n        className=\"measureY\"\n        x1={xScale(endPos.x)}\n        x2={xScale(endPos.x)}\n        y1={yScale(startPos.y)}\n        y2={yScale(endPos.y)}\n      ></line>\n      <text\n        fill=\"currentColor\"\n        x={xScale(endPos.x)}\n        y={yScale((startPos.y + endPos.y) / 2)}\n        dx=\"1em\"\n        dy=\"0\"\n      >\n        {formatVoltage(endPos.y - startPos.y)}\n      </text>\n    </g>\n  )\n})\n\nMeasure.displayName = 'Measure'\nexport default Measure\n","import React, { useEffect, useRef } from 'react'\nimport useSize from '@react-hook/size'\n\nimport {\n  dataState,\n  useIsChannelOn,\n  XYModeState\n} from '../../communication/bindings'\nimport { useRecoilValue, useSetRecoilState } from 'recoil'\nimport TriggerVoltageHandle, { TriggerVoltageRef } from './TriggerVoltageHandle'\nimport TriggerPosHandle, { TriggerPosRef } from './TriggerPosHandle'\nimport {\n  lineSelector,\n  plotHeightSelector,\n  plotWidthSelector,\n  XYLineSelector\n} from './hooks'\nimport XAxis from './XAxis'\nimport YAxis from './YAxis'\nimport Measure, { MeasureRef } from './Measure'\n\nfunction XYCurve() {\n  const xyMode = useRecoilValue(XYModeState)\n  const isChannelOn = useRecoilValue(useIsChannelOn.send)\n\n  const xyLine = useRecoilValue(XYLineSelector)\n  const data = useRecoilValue(dataState)\n  const d = data[0].map(\n    (d, i) => [-data[1][i]?.v || 0, d.v] as [number, number]\n  )\n  if (!xyMode || !isChannelOn[0] || !isChannelOn[1]) return <></>\n  return (\n    <>\n      <path className={`plot-area-xy`} d={xyLine(d) || undefined}></path>\n    </>\n  )\n}\nfunction Curves() {\n  const line = useRecoilValue(lineSelector)\n  const data = useRecoilValue(dataState)\n  const ds = data.map((data) => line(data) || undefined)\n  const analogs = ds.slice(0, 2)\n  const digitals = ds.slice(2, 6)\n  const ffts = ds.slice(6, 8)\n  return (\n    <>\n      {analogs.map((d, i) => (\n        <path key={i} className={`plot-area-a${i}`} d={d}></path>\n      ))}\n      {digitals.map((d, i) => (\n        <path key={i} className={`plot-area-d${i}`} d={d}></path>\n      ))}\n      {ffts.map((d, i) => (\n        <path key={i} className={`plot-area-fft${i}`} d={d}></path>\n      ))}\n    </>\n  )\n}\n\nexport default function Plot() {\n  const nodeRef = useRef<SVGSVGElement>(null)\n  const triggerPosRef = useRef<TriggerPosRef>(null)\n  const triggerVoltageRef = useRef<TriggerVoltageRef>(null)\n  const measureRef = useRef<MeasureRef>(null)\n  const containerRef = useRef<HTMLDivElement>(null)\n  const [width, height] = useSize(containerRef)\n  const setPlotHeight = useSetRecoilState(plotHeightSelector)\n  const setPlotWidth = useSetRecoilState(plotWidthSelector)\n  useEffect(() => {\n    setPlotHeight(height)\n    setPlotWidth(width)\n  }, [height, setPlotHeight, setPlotWidth, width])\n  return (\n    <div className=\"plotContainer\" ref={containerRef}>\n      <svg\n        className=\"plot\"\n        ref={nodeRef}\n        onMouseMove={(e) => {\n          triggerPosRef.current?.onMouseMove(e)\n          triggerVoltageRef.current?.onMouseMove(e)\n          measureRef.current?.onMouseMove(e)\n          e.preventDefault()\n        }}\n        onMouseLeave={(e) => {\n          triggerPosRef.current?.onMouseUp(e)\n          triggerVoltageRef.current?.onMouseUp(e)\n          measureRef.current?.onMouseUp(e)\n          e.preventDefault()\n        }}\n        onMouseUp={(e) => {\n          triggerPosRef.current?.onMouseUp(e)\n          triggerVoltageRef.current?.onMouseUp(e)\n          measureRef.current?.onMouseUp(e)\n          e.preventDefault()\n        }}\n        onMouseDown={(e) => {\n          measureRef.current?.onMouseDown(e)\n          e.preventDefault()\n        }}\n      >\n        <XAxis />\n        <YAxis />\n        <Curves />\n        <XYCurve />\n        <Measure ref={measureRef} />\n        <TriggerVoltageHandle ref={triggerVoltageRef} />\n        <TriggerPosHandle ref={triggerPosRef} />\n      </svg>\n    </div>\n  )\n}\n","import React from 'react'\nimport {\n  useTriggerDirection,\n  isRunningState,\n  useTriggerMode,\n  TriggerMode,\n  didTriggerState,\n  useTriggerChannel,\n  TriggerDirection,\n  requestData,\n  useSecPerSample\n} from '../../communication/bindings'\nimport {\n  Icon,\n  Panel,\n  Tag,\n  ButtonToolbar,\n  ButtonGroup,\n  Button,\n  IconButton\n} from 'rsuite'\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from 'recoil'\nimport win from '../../win'\n\nconst ButtonToolbarStyle = {\n  marginTop: 10,\n  display: 'flex',\n  justifyContent: 'space-between',\n  alignItems: 'center'\n}\n\nexport default function Trigger() {\n  const isRunning = useRecoilValue(isRunningState)\n  win.requestData = useSetRecoilState(requestData.send)\n  const [triggerMode, setTriggerMode] = useRecoilState(useTriggerMode.send)\n  const [triggerChannel, setTriggerChannel] = useRecoilState(\n    useTriggerChannel.send\n  )\n  const didTrigger = useRecoilValue(didTriggerState)\n  const [triggerDirection, setTriggerDirection] = useRecoilState(\n    useTriggerDirection.send\n  )\n  const secPerSample = useRecoilValue(useSecPerSample.send)\n  const tooFastForSlowMode = secPerSample < 0.003\n  return (\n    <Panel header=\"Trigger\" shaded collapsible defaultExpanded>\n      <ButtonToolbar style={ButtonToolbarStyle}>\n        <ButtonGroup>\n          {['A0', 'AS', 'A2', 'A3', 'A4', 'A5'].map((name, idx) => (\n            <Button\n              key={idx}\n              appearance={triggerChannel === idx ? 'primary' : 'default'}\n              disabled={\n                ['A2', 'A3'].includes(\n                  name\n                ) /* these are connected to the diff amp and generate noise */\n              }\n              size=\"sm\"\n              onClick={() => setTriggerChannel(idx)}\n            >\n              {name}\n            </Button>\n          ))}\n        </ButtonGroup>\n      </ButtonToolbar>\n      <ButtonToolbar style={ButtonToolbarStyle}>\n        <ButtonGroup>\n          {Object.values(TriggerMode).map((mode) => (\n            <Button\n              key={mode}\n              appearance={triggerMode === mode ? 'primary' : 'default'}\n              color={\n                mode === TriggerMode.SLOW && tooFastForSlowMode\n                  ? 'red'\n                  : undefined\n              }\n              size=\"sm\"\n              onClick={() => setTriggerMode(mode)}\n            >\n              {mode}\n            </Button>\n          ))}\n        </ButtonGroup>\n      </ButtonToolbar>\n      <ButtonToolbar style={ButtonToolbarStyle}>\n        <div>Direction:</div>\n        <ButtonGroup>\n          <IconButton\n            size=\"sm\"\n            appearance={\n              triggerDirection === TriggerDirection.FALLING\n                ? 'primary'\n                : 'default'\n            }\n            icon={<Icon icon=\"level-down\" />}\n            onClick={() => setTriggerDirection(TriggerDirection.FALLING)}\n          />\n          <IconButton\n            size=\"sm\"\n            appearance={\n              triggerDirection === TriggerDirection.RISING\n                ? 'primary'\n                : 'default'\n            }\n            icon={<Icon icon=\"level-up\" />}\n            onClick={() => setTriggerDirection(TriggerDirection.RISING)}\n          />\n        </ButtonGroup>\n      </ButtonToolbar>\n      <ButtonToolbar style={ButtonToolbarStyle}>\n        State:&nbsp;\n        {!isRunning ? (\n          <Tag color=\"red\">Hold</Tag>\n        ) : didTrigger ? (\n          <Tag color=\"green\">Triggered</Tag>\n        ) : (\n          <Tag color=\"yellow\">Searching</Tag>\n        )}\n      </ButtonToolbar>\n    </Panel>\n  )\n}\n","import React from 'react'\nimport {\n  useIsChannelOn,\n  oversamplingFactorState,\n  fftState0,\n  fftState1,\n  XYModeState\n} from '../../communication/bindings'\nimport { Panel, ButtonToolbar, ButtonGroup, Button, Slider } from 'rsuite'\nimport { useRecoilState } from 'recoil'\n\nconst ButtonToolbarStyle = {\n  marginTop: 10,\n  display: 'flex',\n  justifyContent: 'space-between',\n  alignItems: 'center'\n}\n\nexport default function Channels() {\n  const [oversamplingFactor, setOversamplingFactor] = useRecoilState(\n    oversamplingFactorState\n  )\n  const [xyMode, setXYMode] = useRecoilState(XYModeState)\n  const [fft0, setFFT0] = useRecoilState(fftState0)\n  const [fft1, setFFT1] = useRecoilState(fftState1)\n  const [isChannelOn, setIsChannelOn] = useRecoilState(useIsChannelOn.send)\n\n  return (\n    <Panel header=\"Channels\" shaded collapsible defaultExpanded>\n      <ButtonToolbar style={ButtonToolbarStyle}>\n        <ButtonGroup>\n          {['A0', 'AS', 'A2', 'A3', 'A4', 'A5'].map((name, i) => (\n            <Button\n              key={i}\n              appearance={isChannelOn[i] ? 'primary' : 'default'}\n              size=\"sm\"\n              disabled={\n                ['A2', 'A3'].includes(\n                  name\n                ) /* these are connected to the diff amp and generate noise */\n              }\n              onClick={() => {\n                const buffer = isChannelOn.slice()\n                buffer[i] = !buffer[i]\n                setIsChannelOn(buffer)\n              }}\n            >\n              {name}\n            </Button>\n          ))}\n        </ButtonGroup>\n      </ButtonToolbar>\n      <div style={ButtonToolbarStyle}>\n        Oversample\n        <Slider\n          style={{ width: '50%' }}\n          value={oversamplingFactor}\n          onChange={setOversamplingFactor}\n          max={30}\n          min={0}\n          step={0.1}\n        />\n      </div>\n\n      <ButtonGroup>\n        <Button\n          appearance={fft0 ? 'primary' : 'default'}\n          disabled={!isChannelOn[0]}\n          size=\"sm\"\n          onClick={() => {\n            setFFT0(!fft0)\n          }}\n        >\n          FFT A0\n        </Button>\n        <Button\n          appearance={fft1 ? 'primary' : 'default'}\n          disabled={!isChannelOn[1]}\n          size=\"sm\"\n          onClick={() => {\n            setFFT1(!fft1)\n          }}\n        >\n          FFT AS\n        </Button>\n        <Button\n          appearance={xyMode ? 'primary' : 'default'}\n          disabled={!(isChannelOn[1] && isChannelOn[0])}\n          size=\"sm\"\n          onClick={() => {\n            setXYMode(!xyMode)\n          }}\n        >\n          XY\n        </Button>\n      </ButtonGroup>\n    </Panel>\n  )\n}\n","import { useState } from 'react'\n\nexport function useActiveBtns() {\n  const [state, setState] = useState(false)\n\n  const [timeout, setTimeout] = useState(-1)\n  const activateBtn = () => {\n    setState(true)\n    clearTimeout(timeout)\n    const timeoutId = window.setTimeout(() => setState(false), 200)\n    setTimeout(timeoutId)\n  }\n  return [state, activateBtn] as [typeof state, typeof activateBtn]\n}\n","import MouseTrap from 'mousetrap'\nimport React, { useEffect } from 'react'\nimport { useAmplifier, voltageRanges } from '../../communication/bindings'\nimport { formatVoltage } from '../formatters'\nimport { Icon, IconButton, SelectPicker } from 'rsuite'\nimport { useRecoilState } from 'recoil'\nimport { useActiveBtns } from './hooks'\n\nfunction Amplifier() {\n  const [amplifier, setAmplifier] = useRecoilState(useAmplifier.send)\n  const [isUpActive, tapUp] = useActiveBtns()\n  const [isDownActive, tapDown] = useActiveBtns()\n  useEffect(() => {\n    MouseTrap.bind('up', (e) => {\n      e.preventDefault()\n      tapUp()\n      setAmplifier(amplifier - 1)\n    })\n    MouseTrap.bind('down', (e) => {\n      e.preventDefault()\n      tapDown()\n      setAmplifier(amplifier + 1)\n    })\n    return () => {\n      MouseTrap.unbind('up')\n      MouseTrap.unbind('down')\n    }\n  }, [amplifier, setAmplifier, tapDown, tapUp])\n\n  return (\n    <div\n      style={{\n        width: ' 100%',\n        display: ' flex',\n        justifyContent: ' space-between',\n        marginBottom: 5\n      }}\n    >\n      <IconButton\n        active={isDownActive}\n        size=\"md\"\n        icon={<Icon icon=\"down\" />}\n        onClick={() => setAmplifier(amplifier + 1)}\n      />\n      <SelectPicker\n        searchable={false}\n        value={amplifier}\n        cleanable={false}\n        onChange={setAmplifier}\n        data={voltageRanges.map((v, i) => {\n          return {\n            label: formatVoltage(v / 10) + ' / div',\n            value: i\n          }\n        })}\n        style={{ flex: 1, marginLeft: 5, marginRight: 5 }}\n      />\n      <IconButton\n        active={isUpActive}\n        size=\"md\"\n        icon={<Icon icon=\"up\" />}\n        onClick={() => setAmplifier(amplifier - 1)}\n      />\n    </div>\n  )\n}\n\nexport default Amplifier\n","import MouseTrap from 'mousetrap'\nimport React, { useEffect } from 'react'\nimport {\n  useSecPerSample,\n  useSamplesPerBuffer,\n  constrain\n} from '../../communication/bindings'\nimport { formatTime } from '../formatters'\nimport { Icon, IconButton, SelectPicker } from 'rsuite'\nimport { useRecoilState, useRecoilValue } from 'recoil'\nimport win from '../../win'\nimport { useActiveBtns } from './hooks'\nconst us = (n: number) => n / 1000000\nconst ms = (n: number) => n / 1000\nconst s = (n: number) => n\nconst offset = (list: { value: number }[], current: number, offset: number) => {\n  let i = list.map(({ value }) => value).indexOf(current) + offset\n  i = constrain(i, 0, list.length - 1)\n  return list[i].value\n}\nexport default function TimeScales() {\n  const [secPerSample, setSecPerSample] = useRecoilState(useSecPerSample.send)\n  const samples = useRecoilValue(useSamplesPerBuffer.send)\n  const [isLeftActive, tapLeft] = useActiveBtns()\n  const [isRightActive, tapRight] = useActiveBtns()\n\n  const perSample = [\n    us(100.8), // as fast as it goes\n    us(140.8), // in synch with adc clock\n    us(200),\n    us(500),\n    us(1000),\n    ms(2),\n    ms(5),\n    ms(10),\n    ms(20),\n    ms(50),\n    s(0.1),\n    s(0.2),\n    s(0.5),\n    s(1),\n    s(2),\n    s(5),\n    s(10),\n    s(20),\n    s(50),\n    s(100),\n    s(1000)\n  ].map((secPerDivision) => {\n    const secPerSample = (secPerDivision * 10) / samples\n    return {\n      label: formatTime(secPerDivision) + ' / div',\n      value: secPerSample\n    }\n  })\n  useEffect(() => {\n    MouseTrap.bind('right', (e) => {\n      e.preventDefault()\n      tapRight()\n      setSecPerSample(offset(perSample, secPerSample, 1))\n    })\n    MouseTrap.bind('left', (e) => {\n      e.preventDefault()\n      tapLeft()\n      setSecPerSample(offset(perSample, secPerSample, -1))\n    })\n    return () => {\n      MouseTrap.unbind('right')\n      MouseTrap.unbind('left')\n    }\n  }, [setSecPerSample, secPerSample, perSample, tapRight, tapLeft])\n  win.setSecPerSample = setSecPerSample\n\n  return (\n    <div\n      style={{\n        width: ' 100%',\n        display: ' flex',\n        justifyContent: ' space-between',\n        marginBottom: 5\n      }}\n    >\n      <IconButton\n        active={isLeftActive}\n        size=\"md\"\n        icon={<Icon icon=\"left\" />}\n        onClick={() => setSecPerSample(offset(perSample, secPerSample, -1))}\n      />\n      <SelectPicker\n        searchable={true}\n        value={secPerSample}\n        cleanable={false}\n        onChange={(n: number) => {\n          setSecPerSample(n)\n        }}\n        data={perSample}\n        style={{ flex: 1, marginLeft: 5, marginRight: 5 }}\n      />\n      <IconButton\n        active={isRightActive}\n        size=\"md\"\n        icon={<Icon icon=\"right\" />}\n        onClick={() => setSecPerSample(offset(perSample, secPerSample, 1))}\n      />\n    </div>\n  )\n}\n","import MouseTrap from 'mousetrap'\nimport React, { useEffect } from 'react'\nimport { isRunningState } from '../../communication/bindings'\nimport { Panel, Button } from 'rsuite'\nimport { useRecoilState } from 'recoil'\nimport Amplifier from './Amplifier'\nimport TimeScales from './TimeScales'\nimport { useActiveBtns } from './hooks'\n\nexport default function Scales() {\n  const [isRunning, setIsRunning] = useRecoilState(isRunningState)\n  const [isSpaceActive, tapSpace] = useActiveBtns()\n\n  useEffect(() => {\n    MouseTrap.bind('space', (e) => {\n      e.preventDefault()\n      tapSpace()\n      setIsRunning((isRunning) => !isRunning)\n    })\n    return () => {\n      MouseTrap.unbind('space')\n    }\n  }, [setIsRunning, tapSpace])\n\n  return (\n    <Panel header=\"Scales\" shaded collapsible defaultExpanded>\n      <Button\n        active={isSpaceActive}\n        style={{\n          color: 'white',\n          backgroundColor: isRunning ? 'green' : 'red',\n          width: '100%',\n          marginBottom: '10px'\n        }}\n        size=\"sm\"\n        onClick={() => {\n          setIsRunning(!isRunning)\n        }}\n      >\n        {(isRunning ? 'Run' : 'Hold') + ' [space]'}\n      </Button>\n      <TimeScales />\n      <Amplifier />\n    </Panel>\n  )\n}\n","import {\n  IconButton,\n  Icon,\n  ButtonToolbar,\n  Tag,\n  ButtonGroup,\n  Panel\n} from 'rsuite'\nimport React, { useEffect, useState } from 'react'\nimport { allDataState } from '../../communication/bindings'\nimport serial from '../../communication/Serial'\nimport { useSetRecoilState } from 'recoil'\nimport Uploader from './Uploader'\n\nconst serialOptions = {\n  baudRate: 115200 * 1,\n  bufferSize: 20000\n}\nconst ButtonToolbarStyle = {\n  marginTop: 10,\n  display: 'flex',\n  justifyContent: 'space-between',\n  alignItems: 'center'\n}\ntype ConnectedState = 'Connected' | 'Disconnected' | 'Connecting...' | 'Error'\n\nfunction SerialControls() {\n  const [serialState, setSerialState] = useState<ConnectedState>('Disconnected')\n  const setAllData = useSetRecoilState(allDataState)\n  useEffect(() => {\n    return serial.onData((data) => {\n      setAllData(data)\n    })\n  }, [setAllData])\n  useEffect(() => {\n    setSerialState('Connecting...')\n    serial\n      .connectWithPaired(serialOptions)\n      .then(() => setSerialState('Connected'))\n      .catch(() => setSerialState('Disconnected'))\n  }, [])\n  return (\n    <Panel shaded header=\"Serial\">\n      <ButtonGroup style={ButtonToolbarStyle}>\n        <IconButton\n          style={{ flex: 1 }}\n          appearance={serialState === 'Connected' ? 'primary' : undefined}\n          size=\"md\"\n          onClick={async () => {\n            serial\n              .connect(serialOptions)\n              .then(() => setSerialState('Connected'))\n              .catch(() => setSerialState('Error'))\n          }}\n          icon={<Icon icon=\"arrow-right\" style={{ width: ' 100%' }} />}\n          placement=\"right\"\n        />\n        <IconButton\n          style={{ flex: 1 }}\n          size=\"md\"\n          appearance={serialState !== 'Connected' ? 'primary' : undefined}\n          onClick={async () => {\n            serial\n              .close()\n              .then(() => setSerialState('Disconnected'))\n              .catch(() => setSerialState('Error'))\n          }}\n          icon={<Icon icon=\"stop\" style={{ width: ' 100%' }} />}\n          placement=\"right\"\n        />\n\n        <IconButton\n          style={{ flex: 1 }}\n          size=\"md\"\n          onClick={async () => {\n            setSerialState('Connecting...')\n\n            await serial\n              .connectWithPaired(serialOptions)\n              .catch(() => serial.connect(serialOptions))\n              .then(() => setSerialState('Connected'))\n              .catch(() => setSerialState('Error'))\n          }}\n          icon={<Icon icon=\"recycle\" style={{ width: ' 100%' }} />}\n          placement=\"right\"\n        />\n      </ButtonGroup>\n\n      <ButtonToolbar style={ButtonToolbarStyle}>\n        State:&nbsp;\n        {(() => {\n          const color = {\n            Connected: 'green',\n            'Connecting...': 'yellow',\n            Error: 'red',\n            Disconnected: undefined\n          }[serialState]\n\n          return <Tag color={color}>{serialState}</Tag>\n        })()}\n      </ButtonToolbar>\n      {serialState === 'Disconnected' && <Uploader />}\n    </Panel>\n  )\n}\n\nexport default SerialControls\n","import React from 'react'\nimport {\n  freeMemoryState,\n  frequencyState,\n  voltagesState\n} from '../../communication/bindings'\nimport { formatFreq, formatTime, formatVoltage } from '../formatters'\nimport { Panel, Tag } from 'rsuite'\nimport { useRecoilValue } from 'recoil'\n\nfunction FreeMemory() {\n  const freeMemory = useRecoilValue(freeMemoryState)\n  return <Tag>Mem: {freeMemory}bytes</Tag>\n}\n\nfunction Frequency() {\n  const frequency = useRecoilValue(frequencyState)\n  return <Tag>Freq: {formatFreq(frequency)}</Tag>\n}\nfunction Wavelength() {\n  const frequency = useRecoilValue(frequencyState)\n  return <Tag>Wavelength: {formatTime(1 / frequency)}</Tag>\n}\n\nconst style = {\n  width: ' 100%',\n  display: ' flex',\n  justifyContent: ' space-between'\n}\nfunction Voltages() {\n  const voltages = useRecoilValue(voltagesState)\n  return (\n    <>\n      <div style={style}>\n        <Tag>Vmin: {formatVoltage(voltages.vmin)}</Tag>\n        <Tag>Vmax: {formatVoltage(voltages.vmax)}</Tag>\n      </div>\n      <div style={style}>\n        <Tag>Vavr: {formatVoltage(voltages.vavr)}</Tag>\n        <Tag>Vp-p: {formatVoltage(voltages.vpp)}</Tag>\n      </div>\n    </>\n  )\n}\nexport default function Stats() {\n  return (\n    <div>\n      <Panel header=\"Voltages\" shaded collapsible defaultExpanded>\n        <Voltages />\n        <div style={style}>\n          <FreeMemory />\n          <Frequency />\n          <Wavelength />\n        </div>\n      </Panel>\n    </div>\n  )\n}\n","import React from 'react'\n\nimport Trigger from './Trigger'\nimport Channels from './Channels'\nimport Scales from './Scales'\nimport SerialControls from './SerialControls'\nimport Stats from './Stats'\n\nfunction Controls() {\n  return (\n    <>\n      <SerialControls />\n      <Scales />\n      <Channels />\n      <Trigger />\n      <Stats />\n    </>\n  )\n}\n\nexport default Controls\n","import React from 'react'\n\nimport { Panel } from 'rsuite'\n\nexport default function About() {\n  return (\n    <Panel header=\"About\" shaded collapsible defaultExpanded>\n      <p>David Buezas 2020</p>\n      <a href=\"https://github.com/dbuezas/arduino-web-oscilloscope\">\n        https://github.com/dbuezas/arduino-web-oscilloscope\n      </a>\n    </Panel>\n  )\n}\n","import React from 'react'\nimport Plot from './Plot/Plot'\n\nimport Controls from './Controls'\nimport {\n  Panel,\n  Container,\n  Content,\n  Sidebar,\n  Button,\n  Notification,\n  Steps\n} from 'rsuite'\nimport About from './About'\nimport useCopy from '@react-hook/copy'\n\nconst chromeFlagsUrl =\n  'chrome://flags/#enable-experimental-web-platform-features'\nconst styles = {\n  width: '200px',\n  display: 'inline-table',\n  verticalAlign: 'top'\n}\nfunction App() {\n  const { copy } = useCopy(chromeFlagsUrl)\n\n  if (!navigator.serial) {\n    return (\n      <div className=\"App\">\n        <Panel shaded bordered style={{ margin: 'auto' }}>\n          <Panel\n            header={\n              <>\n                <p style={{ fontSize: 30 }}>\n                  Enable experimental web platform features to activate the Web\n                  Serial API{' '}\n                </p>\n                <br />\n              </>\n            }\n          >\n            <Steps vertical style={styles}>\n              <Steps.Item\n                title=\"Copy the chrome flags url\"\n                description={\n                  <Button\n                    color=\"green\"\n                    onClick={() => {\n                      copy()\n                      Notification.success({\n                        title: 'It is now in your clipboard',\n                        description: chromeFlagsUrl\n                      })\n                    }}\n                  >\n                    {chromeFlagsUrl}\n                  </Button>\n                }\n              />\n              <Steps.Item\n                title=\"Paste it in the address bar of the browser and press [enter]\"\n                description={\n                  <>\n                    <img\n                      alt=\"\"\n                      src={process.env.PUBLIC_URL + '/address-bar.png'}\n                    ></img>\n                    <p>\n                      Right there. This will take you to the the page where you\n                      can support for the serial port.\n                    </p>\n                  </>\n                }\n              />\n              <Steps.Item\n                title=\"Enable the experimental web platform features\"\n                description={\n                  <img\n                    alt=\"\"\n                    src={\n                      process.env.PUBLIC_URL +\n                      '/ExperimentalWebPlatformFeatures.png'\n                    }\n                  ></img>\n                }\n              />\n              <Steps.Item\n                title=\"Reload this page\"\n                description=\"And you'll be ready to use the oscilloscope\"\n              />\n              <Steps.Item\n                title=\"Enjoy\"\n                description={\n                  <img\n                    width=\"500px\"\n                    alt=\"\"\n                    src={process.env.PUBLIC_URL + '/screenshot.png'}\n                  ></img>\n                }\n              />\n            </Steps>\n          </Panel>\n        </Panel>\n      </div>\n    )\n  }\n  return (\n    <div className=\"App\">\n      <Container>\n        <Content>\n          <Panel shaded>\n            <Plot />\n          </Panel>\n        </Content>\n        <Sidebar width={261}>\n          <Controls />\n          <About />\n        </Sidebar>\n      </Container>\n    </div>\n  )\n}\n\nexport default App\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import './index.scss'\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\n\nimport App from './components/App'\nimport * as serviceWorker from './serviceWorker'\nimport { RecoilRoot } from 'recoil'\n\nReactDOM.render(\n  <React.StrictMode>\n    <RecoilRoot>\n      <App />\n    </RecoilRoot>\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister()\n"],"sourceRoot":""}