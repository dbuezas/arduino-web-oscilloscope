{"version":3,"sources":["communication/Serial2.ts","components/Controls/Uploader.tsx","communication/parseSerial.ts","communication/Serial.ts","communication/bindingsHelper.ts","dsp/spectrum.ts","win.ts","communication/bindings.tsx","components/Plot/hooks.ts","components/Plot/TriggerVoltageHandle.tsx","components/Plot/TriggerPosHandle.tsx","components/formatters.ts","components/Plot/XAxis.tsx","components/Plot/YAxis.tsx","components/Plot/Measure.tsx","components/Plot/Plot.tsx","components/Controls/Trigger.tsx","components/Controls/Channels.tsx","components/Controls/hooks.ts","components/Controls/Amplifier.tsx","components/Controls/TimeScales.tsx","components/Controls/Scales.tsx","components/Controls/SerialControls.tsx","components/Controls/Stats.tsx","components/Controls/index.tsx","components/About.tsx","components/EnableSerialInstructions.tsx","components/App.tsx","serviceWorker.ts","index.tsx"],"names":["serial","port","reader","writer","console","log","this","undefined","cancel","close","options","navigator","getPorts","Error","_connect","requestPort","baudRate","dataBits","stopBits","parity","bufferSize","rtscts","xon","xoff","open","ReadableWebToNodeStream","readable","writable","getWriter","rwStream","write","buffer","onDone","then","window","serial2","stk500","Stk500","bootload","stream","hex","opt","progress","a","sent","what","percent","Math","round","length","pageSize","async","series","sync","bind","timeout","verifySignature","signature","setOptions","enterProgrammingMode","upload","exitProgrammingMode","serialOptions","board","Buffer","from","Uploader","useState","setPercent","status","setStatus","isProgressHidden","setIsProgressHidden","message","setMessage","onClick","fetch","process","response","text","intel_hex","parse","data","connect","serialStream","error","toString","color","icon","Line","pull","count","result","slice","i","Array","get_uint8_t","res","get_bool","get_uint16_t","l","h","parseSerial","myData","triggerVoltage","triggerDir","secPerSample","arr","int","reverse","reduce","acc","curr","sign","exp","mantissa","float32","parseInt","pow","get_float32_t","triggerPos","amplifier","triggerMode","triggerChannel","isChannelOn","needData","forceUIUpdate","didTrigger","freeMemory","sentSamples","samplesPerBuffer","analogs","digitalBytes","digitals","map","mask","byte","vMax","voltageRanges","buffers","analog","n","digital","bit","channel","v","t","END_SEQUENCE","indexesOfSequence","needle","haystack","strNeedle","c","String","fromCharCode","join","strHaystack","start","indexOf","sleep","ms","Promise","r","setTimeout","readbuffer","outputDone","filter","JSON","localStorage","serialFilter","ports","stringify","getInfo","getReader","encoder","TextEncoderStream","pipeTo","textOutputStream","callback","consume","busy","end","dataFrame","checksumShould","pop","checksumIs","prev","running","read","value","push","produce","memoSelector","theAtom","selector","key","get","set","newValue","makeIntercom","ui2mcu","mcu2ui","defaultValue","default","remoteState","atom","serial_write","send","reset","DefaultValue","receive","addEventListener","getFFT","signal","dt","mid","nextPowerOf2","ceil","log2","padding","paddedSignal","fill","ft","TriggerDirection","useTriggerVoltage","voltageRangeState","vmin","vpp","useTriggerPos","vavr","voltagesState","samples","useSamplesPerBuffer","useSecPerSample","requestData","TriggerMode","useTriggerDirection","RISING","FALLING","useTriggerChannel","useIsChannelOn","b","_","Boolean","constrain","min","max","useAmplifier","useTriggerMode","Object","values","AUTO","dataState","isRunningState","oversamplingFactorState","XYModeState","fftState0","fftState1","didTriggerState","freeMemoryState","frequencyState","lowThird","firstCross","lastCross","locked","Number","isFinite","NaN","getFrequencyCount","vmax","previous","current","sum","sendFullState","receiveFullState","allDataState","newData","win","$recoilDebugStates","some","oldBuffers","oversamplingFactor","factor","newBuffer","oldBuffer","j","oversample","SLOW","oldLastT","totalSecs","withFFT","SINGLE","margin","xDomainSelector","yDomainSelector","plotWidthSelector","plotHeightSelector","xScaleSelector","xDomain","width","d3","domain","range","yScaleSelector","yDomain","height","rangeRound","lineSelector","xScale","yScale","x","y","XYLineSelector","xMax","yMax","d","TriggerVoltageHandle","line","forwardRef","_props","ref","draggingTV","setDraggingTV","useRecoilValue","useRecoilState","setTriggerVoltage","useImperativeHandle","onMouseUp","onMouseMove","e","invert","nativeEvent","offsetY","scaledY","className","x1","x2","y1","y2","onMouseDown","preventDefault","stopPropagation","dy","dx","toFixed","displayName","TriggerPosHandle","draggingTP","setDraggingTP","setTriggerPos","offsetX","scaledX","float","digits","formatTime","s","m","us","formatVoltage","mv","uv","XAxis","nodeRef","useRef","gEl","useLayoutEffect","xTicks","call","g","attr","tickValues","tickPadding","tickSize","tickFormat","tickSizeOuter","select","remove","YAxis","yTicks","_d","path","Measure","dragging","setDragging","startPos","setStartPos","endPos","setEndPos","isEqual","XYCurve","xyMode","xyLine","Curves","ds","ffts","Plot","triggerPosRef","triggerVoltageRef","measureRef","containerRef","useSize","setPlotHeight","useSetRecoilState","setPlotWidth","useEffect","onMouseLeave","ButtonToolbarStyle","marginTop","display","justifyContent","alignItems","Trigger","isRunning","setTriggerMode","setTriggerChannel","triggerDirection","setTriggerDirection","tooFastForSlowMode","Panel","header","shaded","collapsible","defaultExpanded","ButtonToolbar","style","ButtonGroup","name","idx","Button","appearance","disabled","includes","size","mode","IconButton","Icon","Tag","Channels","setOversamplingFactor","setXYMode","fft0","setFFT0","fft1","setFFT1","setIsChannelOn","Slider","onChange","step","useActiveBtns","state","setState","clearTimeout","timeoutId","Amplifier","setAmplifier","isUpActive","tapUp","isDownActive","tapDown","MouseTrap","unbind","marginBottom","active","SelectPicker","searchable","cleanable","label","flex","marginLeft","marginRight","offset","list","TimeScales","setSecPerSample","isLeftActive","tapLeft","isRightActive","tapRight","perSample","secPerDivision","Scales","setIsRunning","isSpaceActive","tapSpace","backgroundColor","SerialControls","connectedWith","setConnectedWith","setError","serialState","setSerialState","setAllData","onData","connectWithPaired","catch","placement","Connected","Disconnected","fontSize","FreeMemory","FPS","setLastT","fps","setFps","lastT","performance","now","Frequency","frequency","hz","khz","formatFreq","Wavelength","Voltages","voltages","Stats","Controls","About","href","chromeFlagsUrl","styles","verticalAlign","EnableSerialInstructions","copy","useCopy","bordered","overflow","zoom","Steps","vertical","Item","title","description","Notification","success","alt","src","App","raw","userAgent","match","getChromeVersion","Container","Content","Sidebar","location","hostname","ReactDOM","render","StrictMode","document","getElementById","serviceWorker","ready","registration","unregister"],"mappings":"gNA+EMA,EAAS,IAlEf,iDACEC,UADF,OAEEC,YAFF,OAGEC,YAHF,6KAMIC,QAAQC,IAAI,YACRC,KAAKJ,OAPb,uBAQYA,EAASI,KAAKJ,OACpBI,KAAKJ,YAASK,EATpB,SAWYL,EAAOA,OAAOM,SAX1B,WAcQF,KAAKH,OAdb,wBAeYA,EAASG,KAAKH,OACpBG,KAAKH,YAASI,EAhBpB,UAiBYJ,EAAOM,QAjBnB,YAmBQH,KAAKL,KAnBb,wBAoBYA,EAAOK,KAAKL,KAClBK,KAAKL,UAAOM,EArBlB,UAsBYN,EAAKQ,QAtBjB,QAwBIL,QAAQC,IAAI,UAxBhB,wLA0B0BK,GA1B1B,2FA2ByBC,UAAUX,OAAOY,WA3B1C,sCA2BWX,EA3BX,2BA4BqB,IAAIY,MAAM,aA5B/B,gCA6BWP,KAAKQ,SAASJ,EAAST,IA7BlC,8KA+BgBS,GA/BhB,uFAgCuBC,UAAUX,OAAOe,YAAY,IAhCpD,cAgCUd,EAhCV,yBAiCWK,KAAKQ,SAASJ,EAAST,IAjClC,+KAmCiBS,EAAwBT,GAnCzC,iFAoCIS,EAAO,aACLM,SAAU,KACVC,SAAU,EACVC,SAAU,EACVC,OAAQ,OACRC,WAAY,IACZC,QAAQ,EACRC,KAAK,EACLC,MAAM,GACHb,IAEDJ,KAAKL,KA/Cb,gCA+CyBK,KAAKG,QA/C9B,cAgDIH,KAAKL,KAAOA,EAhDhB,SAiDUK,KAAKL,KAAKuB,KAAKd,GAjDzB,cAkDIJ,KAAKJ,OAAS,IAAIuB,0BAAwBnB,KAAKL,KAAKyB,UACpDpB,KAAKH,OAASG,KAAKL,KAAK0B,SAASC,aAG3BC,EAAYvB,KAAKJ,QAEd4B,MAAQ,SACfC,EACAC,GAGA,OADA,EAAK7B,OAAQ2B,MAAMC,GAAQE,MAAK,kBAAMD,EAAO,QAAOA,IAC7C,GA7Db,kBA+DWH,GA/DX,kHAoEe7B,MAEfkC,OAAOC,QAAUnC,G,wKC5EXoC,EAAS,I,OAAIC,GACbC,EAAQ,uCAAG,WACfC,EACAC,EACAC,EACAC,GAJe,eAAAC,EAAA,6DAMXC,EAAO,EACXR,EAAO/B,IAAM,SAACwC,GACZ,GAAa,gBAATA,EAAwB,CAC1BD,GAAQ,EACR,IAAME,EAAUC,KAAKC,MAAO,IAAMJ,GAASJ,EAAIS,OAASR,EAAIS,WAC5DR,EAASI,KAXE,SAeTK,IAAMC,OAAO,CAEjBhB,EAAOiB,KAAKC,KAAKlB,EAAQG,EAAQ,EAAGE,EAAIc,SACxCnB,EAAOiB,KAAKC,KAAKlB,EAAQG,EAAQ,EAAGE,EAAIc,SACxCnB,EAAOiB,KAAKC,KAAKlB,EAAQG,EAAQ,EAAGE,EAAIc,SACxCnB,EAAOoB,gBAAgBF,KAAKlB,EAAQG,EAAQE,EAAIgB,UAAWhB,EAAIc,SAC/DnB,EAAOsB,WAAWJ,KAAKlB,EAAQG,EAAQ,GAAIE,EAAIc,SAC/CnB,EAAOuB,qBAAqBL,KAAKlB,EAAQG,EAAQE,EAAIc,SACrDnB,EAAOwB,OAAON,KAAKlB,EAAQG,EAAQC,EAAKC,EAAIS,SAAUT,EAAIc,SAE1DnB,EAAOyB,oBAAoBP,KAAKlB,EAAQG,EAAQE,EAAIc,WAzBvC,2CAAH,4DA6BRO,EAAgB,CACpB9C,SAAU,MACVI,WAAY,KAER2C,EAAQ,CACZN,UAAWO,EAAOC,KAAK,CAAC,GAAM,IAAM,KACpCf,SAAU,IACVK,QAAS,KA4CIW,IA1Cf,WAAqB,IAAD,EACYC,mBAAS,GADrB,mBACXrB,EADW,KACFsB,EADE,OAEUD,mBAAwC,UAFlD,mBAEXE,EAFW,KAEHC,EAFG,OAG8BH,oBAAS,GAHvC,mBAGXI,EAHW,KAGOC,EAHP,OAIYL,mBAAS,IAJrB,mBAIXM,EAJW,KAIFC,EAJE,KAKZC,EAAO,uCAAG,8BAAAhC,EAAA,6DACd+B,EAAW,gBADG,SAGZF,GAAoB,GAHR,SAIMI,MAAMC,yCACrB5C,MAAK,SAAC6C,GAAD,OAAcA,EAASC,UAC5B9C,MAAK,SAAC8C,GAAD,OAAUC,IAAUC,MAAMF,GAAMG,QAN5B,cAIN1C,EAJM,gBAOeL,IAAQgD,QAAQrB,GAP/B,cAONsB,EAPM,OAQZd,EAAU,UACVF,EAAW,GACXI,GAAoB,GAVR,UAWNlC,EAAS8C,EAAc5C,EAAKuB,EAAOK,GAX7B,QAYZE,EAAU,WACVI,EAAW,YAAD,OAAalC,EAAIS,OAAjB,YAbE,kDAeZ7C,QAAQiF,MAAR,MACAX,EAAW,KAAEY,YACbhB,EAAU,QAjBE,QAmBdnC,IAAQ1B,QAnBM,0DAAH,qDAqBb,OACE,oCACE,6BACA,kBAAC,IAAD,CAAQ8E,MAAM,QAAQZ,QAASA,GAC7B,kBAAC,IAAD,CAAMa,KAAK,YADb,6BAGEjB,GACA,oCACE,kBAAC,IAASkB,KAAV,CAAe3C,QAASA,EAASuB,OAAQA,IACxCI,O,gPC1EX,SAASiB,EAAKR,EAAYS,GACxB,IAAMC,EAASV,EAAKA,KAAKW,MAAMX,EAAKY,EAAGZ,EAAKY,EAAIH,GAEhD,OADAT,EAAKY,GAAKH,EACHI,MAAM9B,KAAK2B,GAGpB,SAASI,EAAYd,GACnB,IAAMe,EAAMf,EAAKA,KAAKA,EAAKY,GAE3B,OADAZ,EAAKY,IACEG,EAET,IAAMC,EAAWF,EAEjB,SAASG,EAAajB,GACpB,IAAMkB,EAAIlB,EAAKA,KAAKA,EAAKY,GACzBZ,EAAKY,IACL,IAAMO,EAAInB,EAAKA,KAAKA,EAAKY,GAEzB,OADAZ,EAAKY,IACGO,GAAK,EAAKD,EA4BL,SAASE,EAAYpB,GAClC,IAAMqB,EAAe,CACnBrB,OACAY,EAAG,GAGCU,EAAiBR,EAAYO,GAC7BE,EAAaT,EAAYO,GACzBG,EAlCR,SAAuBxB,GAGrB,IAAMyB,EAAMzB,EAAKA,KAAKW,MAAMX,EAAKY,EAAGZ,EAAKY,EAAI,GAC7CZ,EAAKY,GAAK,EAEV,IAAMc,EAAMD,EAAIE,UAAUC,QAAO,SAACC,EAAKC,GAAN,OAAgBD,GAAO,GAAKC,KAC7D,GAAY,IAARJ,EAAW,OAAO,EAKtB,IAJA,IAAMK,EAAOL,IAAQ,IAAM,EAAI,EAC3BM,GAAQN,IAAQ,GAAM,KAAQ,IAC5BO,GAA+B,SAAZ,QAANP,IAA4BtB,SAAS,GACpD8B,EAAU,EACLtB,EAAI,EAAGA,EAAIqB,EAASlE,OAAQ6C,GAAK,EACxCsB,GAAWC,SAASF,EAASrB,IAAM/C,KAAKuE,IAAI,EAAGJ,GAAO,EACtDA,IAEF,OAAOE,EAAUH,EAkBIM,CAAchB,GAC7BiB,EAAarB,EAAaI,GAC1BkB,EAAYzB,EAAYO,GACxBmB,EAAc1B,EAAYO,GAC1BoB,EAAiB3B,EAAYO,GAC7BqB,EAAc5B,EAAYO,GAG1BsB,EAAW3B,EAASK,GACpBuB,EAAgB5B,EAASK,GACzBwB,EAAa7B,EAASK,GACtByB,EAAa7B,EAAaI,GAC1B0B,EAAc9B,EAAaI,GAC3B2B,EAAmB/B,EAAaI,GAChC4B,EAAU,CACA,EAAdP,EAAoBlC,EAAKa,EAAQ0B,GAAe,GAClC,EAAdL,EAAqBlC,EAAKa,EAAQ0B,GAAe,IAE7CG,EAA6B,IAAdR,EAA2BlC,EAAKa,EAAQ0B,GAAe,GACtEI,EAAW,CAAC,EAAU,EAAU,GAAU,IAAUC,KAAI,SAACC,GAC7D,OAAIX,EAAcW,EACTH,EAAaE,KAAI,SAACE,GAAD,OAAUA,EAAOD,GAAQ,KAE5C,MAEHE,EAAOC,EAAcjB,GACrBkB,EAAU,sBACXR,EAAQG,KAAI,SAACM,GAAD,OAAYA,EAAON,KAAI,SAACO,GAAD,OAAQA,EAAI,IAAOJ,SAD3C,YAEXJ,EAASC,KAAI,SAACQ,EAAShD,GAAV,OACdgD,EAAQR,KAAI,SAACS,GAAD,OAAUA,EAAMN,EAAQ,GAAM3C,EAAI,KAAQ2C,EAAQ,UAEhEH,KAAI,SAACU,GAAD,OAAaA,EAAQV,KAAI,SAACW,EAAGnD,GAAJ,MAAW,CAAEmD,IAAGC,GAAIpD,EAAI,GAAKY,SAE5D,MAAO,CAELF,iBACAC,aACAC,eACAc,aACAC,YACAC,cACAC,iBACAC,cAEAC,WACAC,gBACAC,aACAC,aACAE,mBACAS,W,oDC9EEQ,EAAe,CAAC,EAAG,EAAG,IAAK,KAC3BC,EAAoB,SAACC,EAAkBC,GAC3C,IAAMC,EAAYF,EAAOf,KAAI,SAACkB,GAAD,OAAOC,OAAOC,aAAaF,MAAIG,KAAK,IAC3DC,EAAcN,EAAShB,KAAI,SAACkB,GAAD,OAAOC,OAAOC,aAAaF,MAAIG,KAAK,IAC/DE,EAAQD,EAAYE,QAAQP,GAElC,MAAO,CAACM,EADID,EAAYE,QAAQP,EAAWM,EAAQN,EAAUtG,UAIzD8G,EAAQ,SAACC,GAAD,OAAgB,IAAIC,SAAQ,SAACC,GAAD,OAAOC,WAAWD,EAAGF,OA2HzDhK,EAAS,IAzHf,4DACEE,YADF,OAEEC,YAFF,OAGEF,UAHF,OAIEmK,WAAuB,GAJzB,KAKEC,gBALF,OAwEEvI,MAxEF,uCAwEU,WAAOiD,GAAP,SAAApC,EAAA,yDACD,EAAKxC,OADJ,iEAEA,EAAKA,OAAO2B,MAAMiD,GAFlB,2CAxEV,mOAOI3E,QAAQC,IAAI,YACRC,KAAKJ,OARb,uBASYA,EAASI,KAAKJ,OACpBI,KAAKJ,YAASK,EAVpB,SAWYL,EAAOM,SAXnB,WAaQF,KAAKH,OAbb,wBAcYA,EAASG,KAAKH,OACpBG,KAAKH,YAASI,EAfpB,UAgBYJ,EAAOM,QAhBnB,YAkBQH,KAAK+J,WAlBb,wBAmBYA,EAAa/J,KAAK+J,WACxB/J,KAAK+J,gBAAa9J,EApBxB,UAqBY8J,EArBZ,YAuBQ/J,KAAKL,KAvBb,wBAwBYA,EAAOK,KAAKL,KAClBK,KAAKL,UAAOM,EAzBlB,UA0BYN,EAAKQ,QA1BjB,QA4BIL,QAAQC,IAAI,UA5BhB,wLA8B0BK,GA9B1B,sFA+BU4J,EAASC,KAAKtF,MAAMuF,aAAaC,cA/B3C,SAgCwB9J,UAAUX,OAAOY,WAhCzC,UAgCU8J,EAhCV,SAiCmBA,EAAMJ,QACnB,SAACrK,GAAD,OAAUsK,KAAKI,UAAUL,KAAYC,KAAKI,UAAU1K,EAAK2K,cAlC/D,mBAiCW3K,EAjCX,KAoCIG,QAAQC,IAAIqK,EAAOzK,GACdA,EArCT,sBAqCqB,IAAIY,MAAM,aArC/B,gCAsCWP,KAAKQ,SAASJ,EAAST,IAtClC,8KAwCgBS,GAxChB,uFAyCuBC,UAAUX,OAAOe,YAAY,IAzCpD,cAyCUd,EAzCV,yBA0CWK,KAAKQ,SAASJ,EAAST,IA1ClC,+KA4CiBS,EAAwBT,GA5CzC,8EA6CIS,EAAO,aACLM,SAAU,KACVC,SAAU,EACVC,SAAU,EACVC,OAAQ,OACRC,WAAY,IACZC,QAAQ,EACRC,KAAK,EACLC,MAAM,GACHb,IAEDJ,KAAKL,KAxDb,gCAwDyBK,KAAKG,QAxD9B,cAyDIH,KAAKL,KAAOA,EAzDhB,SA2DUK,KAAKL,KAAKuB,KAAKd,GA3DzB,cA4DU+J,EAAexK,EAAK2K,UAC1BJ,aAAaC,aAAeF,KAAKI,UAAUF,GAC3CnK,KAAK8J,WAAa,GAClB9J,KAAKJ,OAASI,KAAKL,KAAKyB,SAASmJ,YAE3BC,EAAU,IAAIC,kBACpBzK,KAAK+J,WAAaS,EAAQpJ,SAASsJ,OAAO1K,KAAKL,KAAK0B,UAC9CsJ,EAAmBH,EAAQnJ,SACjCrB,KAAKH,OAAS8K,EAAiBrJ,YApEnC,kBAqEW6I,GArEX,uIA4ESS,GAAwC,IAAD,OACtCC,EAAU,WAEd,IADA,IAAIC,GAAO,EACJA,GAAM,CAAC,IAAD,EACUhC,EAAkBD,EAAc,EAAKiB,YAD/C,mBACJP,EADI,KACGwB,EADH,KAEX,GAAIxB,GAAS,GAAKwB,GAAO,EAAG,CAC1B,IAAMC,EAAY,EAAKlB,WAAWvE,MAChCgE,EAAQV,EAAalG,OACrBoI,GAEF,EAAKjB,WAAa,EAAKA,WAAWvE,MAAMwF,GACxC,IAAME,GAAkBD,EAAUE,OAAU,GAAKF,EAAUE,MACrDC,EACJH,EAAUxE,QAAO,SAAC4E,EAAM1E,GAAP,OAAgB0E,EAAO1E,IAAM,GAAKjE,KAAKuE,IAAI,EAAG,IAC7DiE,IAAmBE,EACrBP,EAASI,GAETlL,QAAQiF,MAAR,0BAAiCoG,EAAjC,iBAA+CF,SAIjDH,GAAO,IAITO,GAAU,EAed,OAda,uCAAG,gCAAAhJ,EAAA,0DACPgJ,EADO,iCAEN5B,EAAM,IAFA,UAGP,EAAK7J,OAHE,qEAIY,EAAKA,OAAO0L,OAJxB,qBAKErL,KADNsL,EAJI,EAIJA,UAEN,IAAKzB,YAAW0B,KAAhB,oBAAwBD,IACxBV,KAPU,2DAAH,oDAYbY,GAEO,WACLJ,GAAU,OArHhB,MA2He3L,ICnKR,SAASgM,EAAgBC,GAC9B,OAAOC,YAAY,CACjBC,IAAK,OAASF,EAAQE,IACtBC,IAAI,SAAD,oGAAC,EAAC,mBAAaA,EAAb,EAAGA,KAAcH,MACtBI,IAAK,WAAeC,GAAc,IAA1BD,EAAyB,EAAzBA,KACMD,EADmB,EAApBA,KACKH,KACJK,GACVD,EAAIJ,EAASK,MAMd,SAASC,EAAT,GAUH,IATFJ,EASC,EATDA,IACAK,EAQC,EARDA,OACAC,EAOC,EAPDA,OACSC,EAMR,EANDC,QAOMC,EAAcZ,EAClBa,YAAa,CACXV,MACAQ,QAASH,EAAOE,EAAc,SAK5BI,EAAe9M,EAAO8B,MAyB5B,MAAO,CAAEiL,KApBIb,YAAY,CACvBC,IAAKA,EAAM,YACXC,IAAI,SAAD,oGAAC,EAAC,gBAAGA,EAAH,EAAGA,IAAH,OAAaK,EAAOL,EAAIQ,GAAcR,MAC3CC,IAAK,WAAsBC,GAAc,IAAjCD,EAAgC,EAAhCA,IAAKD,EAA2B,EAA3BA,IAAKY,EAAsB,EAAtBA,MAChB,GAAIV,aAAoBW,IAAc,OAAOD,EAAMJ,GACnDP,EAAIO,EAAaJ,EAAOF,EAAUF,IAClCU,EAAaX,EAAMK,EAAOF,EAAUF,GAAO,QAchCc,QAXChB,YAAiB,CAC/BC,IAAKA,EAAM,oBACXC,IAAK,WACH,MAAM,IAAIvL,MAAM,kBAElBwL,IAAK,WAAUC,GAAc,IAArBD,EAAoB,EAApBA,IACN,GAAIC,aAAoBW,IAAc,MAAM,IAAIpM,MAAM,oBACtDwL,EAAIO,EAAaN,ODgHvBpK,OAAOlC,OAASA,EAChBkC,OAAOiL,iBAAiB,gBAAgB,kBAAMnN,EAAOS,W,sBEpK9C,SAAS2M,EAAOlI,GACrB,IAAImI,EAASnI,EAAKoD,KAAI,qBAAGW,KACzB,GAAsB,IAAlBoE,EAAOpK,OAAc,MAAO,GAChC,GAAIoK,EAAOpK,OAAS,EAElB,OADA7C,QAAQC,IAAI,UACL,GAET,IATesG,EAST1D,EAASiC,EAAKjC,OACdqK,EAAKpI,EAAKjC,EAAS,GAAGiG,EAAIhE,EAAKjC,EAAS,GAAGiG,EAE3CqE,GAZS5G,EAYK0G,GAXhBvG,QAAO,SAACC,EAAK8B,GAAN,OAAY9B,EAAM8B,IAAG,GAAKlC,EAAI1D,OAYzCoK,EAASA,EAAO/E,KAAI,SAACW,GAAD,OAAOA,EAAIsE,KAE/B,IAAMC,EAAezK,KAAK0K,KAAK1K,KAAK2K,KAAK,MACnCC,EAAU5K,KAAKuE,IAAI,EAAGkG,GAAgBH,EAAOpK,OAC/C2K,EAAeP,EAWnB,OAVIM,EAAU,IACZC,EAAY,sBAAOP,GAAP,YAAkBtH,MAAM4H,GAASE,KAAK,MAEhDF,EAAU,IACZC,EAAeP,EAAOxH,MAAM,EAAG,MAErBiI,IAAGF,GAEQtF,KAAI,SAACW,GAAD,OAAQ,IAAMA,EAAKoE,EAAOpK,UAEnCqF,KAAI,SAACW,EAAGnD,GAAJ,MAAW,CAAEmD,IAAGC,EAAGoE,EAAKxH,MC/BjC5D,ICuDH6L,EDvDG7L,SCMF8L,EAAoBzB,EAAqB,CACpDJ,IAAK,IACLK,OAAQ,SAACvD,EAAGmD,GAAS,IAAD,EACIA,EAAMA,EAAI6B,IAAqB,CAAC,EAAG,EAAG,GAD1C,mBACXC,EADW,KACHC,EADG,KAElB,OAAOpL,KAAK0K,MAAOxE,EAAIiF,GAAQC,EAAO,MAExC1B,OAAQ,SAAC5D,EAAGuD,GAAS,IAAD,EACIA,EAAMA,EAAI6B,IAAqB,CAAC,EAAG,EAAG,GAD1C,mBACXC,EADW,KAElB,OAAQrF,EAAI,IAFM,KAEOqF,GAE3BvB,QAAS,IAYEyB,GAT6BlC,YAAS,CACjDC,IAAK,sBACLC,IAAK,kBAAM,GACXC,IAAK,YAAmB,IAAhBA,EAAe,EAAfA,IACEgC,GAASjC,EADI,EAAVA,KACUkC,IAAbD,KACRhC,EAAI2B,EAAkBjB,KAAMsB,MAIH9B,EAAqB,CAChDJ,IAAK,IACLK,OAAQ,SAACvD,EAAGmD,GACV,IAAMmC,EAAUnC,EAAMA,EAAIoC,EAAoBzB,MAAQ,IAChDnH,EAASqD,EAAIsF,EACnB,OAAI3I,EAAS,EAAU,EACnBA,EAAS2I,EAAU,EAAUA,EAAU,EACpC3I,GAET6G,OAAQ,SAACxD,EAAGmD,GAEV,OAAOnD,GADSmD,EAAMA,EAAIoC,EAAoBzB,MAAQ,MAGxDJ,QAAS,MAEE8B,EAAkBlC,EAAqB,CAClDJ,IAAK,IACLK,OAAQ,SAACvD,GAAD,OAAOA,GACfwD,OAAQ,SAACxD,GAAD,OAAOA,GACf0D,QAAS,SAEE+B,EAAcnC,EAAqB,CAC9CJ,IAAK,IACLK,OAAQ,SAACvD,GAAD,OAAOA,GACfwD,OAAQ,SAACxD,GAAD,OAAOA,GACf0D,QAAS,K,SAECoB,K,kBAAAA,E,iBAAAA,M,KAIL,IAyDKY,EAzDCC,EAAsBrC,EAA+B,CAChEJ,IAAK,IACLK,OAAQ,SAACvD,GAAD,OAAQA,IAAM8E,EAAiBc,OAAS,EAAI,GACpDpC,OAAQ,SAACxD,GAAD,OAAQA,EAAI8E,EAAiBe,QAAUf,EAAiBc,QAChElC,QAASoB,EAAiBe,UAEfC,EAAoBxC,EAAqB,CACpDJ,IAAK,IACLK,OAAQ,SAACvD,GAAD,OAAOA,GACfwD,OAAQ,SAACxD,GAAD,OAAOA,GACf0D,QAAS,IAEEqC,EAAiBzC,EAAwB,CACpDJ,IAAK,IACLK,OAAQ,SAACvD,GAIP,OAHeA,EACZX,KAAI,SAAC2G,GAAD,OAAQA,EAAI,EAAI,KACpBnI,QAAO,SAACC,EAAK8B,EAAG/C,GAAT,OAAeiB,GAAO8B,GAAK/C,KAAI,IAG3C2G,OAAQ,SAACxD,GAIP,OAHelD,MAAM,GAClB8H,KAAK,GACLvF,KAAI,SAAC4G,EAAGpJ,GAAJ,OAAUqJ,QAAQlG,EAAK,GAAKnD,OAGrC6G,QAAS,EAAC,GAAM,GAAO,GAAO,GAAO,GAAO,KAGjCyC,EAAY,SAACnG,EAAWoG,EAAaC,GAAzB,OACvBrG,EAAIoG,EAAMA,EAAMpG,EAAIqG,EAAMA,EAAMrG,GACrBP,EAAgB,CAC3B,GACA,KACA,EACA,MACA,OACA,OACA,OACA,KACA,QACA,MACA,SACA,QAEW6G,EAAehD,EAAqB,CAC/CJ,IAAK,IACLK,OAAQ,SAACvD,GAAD,OAAOmG,EAAUnG,EAAG,EAAGP,EAAczF,OAAS,IACtDwJ,OAAQ,SAACxD,GAAD,OAAOA,GACf0D,QAAS,IAEE6B,EAAsBjC,EAAqB,CACtDJ,IAAK,IACLK,OAAQ,SAACvD,GAAD,OAAOA,GACfwD,OAAQ,SAACxD,GAAD,OAAOA,GACf0D,QAAS,O,SAECgC,K,YAAAA,E,gBAAAA,E,gBAAAA,E,aAAAA,M,KAOL,IAAMa,EAAiBjD,EAA0B,CACtDJ,IAAK,IACLK,OAAQ,SAACvD,GAAD,OAAOwG,OAAOC,OAAOf,GAAa7E,QAAQb,IAClDwD,OAAQ,SAACxD,GAAD,OAAOwG,OAAOC,OAAOf,GAAa1F,IAC1C0D,QAASgC,EAAYgB,OAIVC,EAAY/C,YAAK,CAC5BV,IAAK,OACLQ,QAAS,YAAI,IAAI5G,MAAM,IAAIuC,KAAI,iBAAM,QAG1BuH,EAAiB7D,EAC5Ba,YAAK,CACHV,IAAK,aACLQ,SAAS,KAGAmD,EAA0B9D,EACrCa,YAAK,CACHV,IAAK,sBACLQ,QAAS,KAGAoD,EAAclD,YAAK,CAC9BV,IAAK,UACLQ,SAAS,IAEEqD,EAAYnD,YAAK,CAC5BV,IAAK,OACLQ,SAAS,IAEEsD,EAAYpD,YAAK,CAC5BV,IAAK,OACLQ,SAAS,IAGEuD,EAAkBlE,EAC7Ba,YAAK,CACHV,IAAK,cACLQ,SAAS,KAGAwD,GAAkBnE,EAC7Ba,YAAK,CACHV,IAAK,cACLQ,QAAS,KAGAyD,GAAiBlE,YAAS,CACrCC,IAAK,YACLC,IAAK,mBF7IA,SAA2BlH,GAChC,GAAIA,EAAKjC,OAAS,EAAG,OAAO,EAW5B,IAVA,IAAMoK,EAASnI,EAAKoD,KAAI,qBAAGW,KACrBqG,EAAMvM,KAAKuM,IAAL,MAAAvM,KAAI,YAAQsK,IAClBgC,EAAMtM,KAAKsM,IAAL,MAAAtM,KAAI,YAAQsK,IAElBgD,GAAYf,EAAY,EAAND,GAAW,EAC7B9B,GAAO+B,EAAMD,GAAO,EACtBiB,GAAc,EACdC,EAAY,EACZ5K,EAAQ,EACR6K,GAAS,EACJ1K,EAAI,EAAGA,EAAIZ,EAAKjC,OAAQ6C,IAAK,CAChCZ,EAAKY,GAAGmD,EAAIoH,IAAUG,GAAS,IACdA,GAAUtL,EAAKY,EAAI,GAAGmD,EAAIsE,GAAOrI,EAAKY,GAAGmD,GAAKsE,IAEjEiD,GAAS,EACT7K,IACI2K,EAAa,IAAGA,EAAapL,EAAKY,GAAGoD,GACzCqH,EAAYrL,EAAKY,GAAGoD,GAGxB,IAAMtD,GAAUD,EAAQ,IAAM4K,EAAYD,GAC1C,OAAI3K,EAAQ,GAAK8K,OAAOC,SAAS9K,GAAgBA,EAC1C6K,OAAOE,IEqHIC,EAAkBxE,EAA/B,EAAGA,KAAgCwD,GAAW,OAKxCtB,GAAgBpC,YAAS,CACpCC,IAAK,WACLC,IAAK,YAAc,IACXiB,GAASjB,EADC,EAAVA,KACawD,GAAW,GAAGtH,KAAI,qBAAGW,KAClC4H,EAAO9N,KAAKuM,IAAL,MAAAvM,KAAI,YAAQsK,IACnBa,EAAOnL,KAAKsM,IAAL,MAAAtM,KAAI,YAAQsK,IACnBc,EAAM0C,EAAO3C,EAGnB,MAAO,CACLG,KAZM,SAAChB,GAAD,OACVA,EAAOvG,QAAO,SAACgK,EAAUC,GAAX,OAAuBD,EAAWC,IAAS,GAQ1CC,CAAI3D,GAAUA,EAAOpK,OAIhCkL,MACAD,OACA2C,WAKO5C,GAAoB/B,YAAS,CACxCC,IAAK,gBACLC,IAAK,YAAc,IAAXA,EAAU,EAAVA,IAIAyE,EAAOnI,EAAc0D,EAAImD,EAAaxC,OAE5C,MAAO,CADM,EACC8D,EAAMA,EADP,MAKXI,GAAgB/E,YAAe,CACnCC,IAAK,4CACLC,IAAK,kBAAM,MACXC,IAAK,YAAmB,IAAhBD,EAAe,EAAfA,IAAKC,EAAU,EAAVA,IACXA,EAAI+B,EAAcrB,KAAMX,EAAIgC,EAAcrB,OAC1CV,EAAIoC,EAAgB1B,KAAMX,EAAIqC,EAAgB1B,OAC9CV,EAAImC,EAAoBzB,KAAMX,EAAIoC,EAAoBzB,OACtDV,EAAIkD,EAAaxC,KAAMX,EAAImD,EAAaxC,OACxCV,EAAI2B,EAAkBjB,KAAMX,EAAI4B,EAAkBjB,OAClDV,EAAIuC,EAAoB7B,KAAMX,EAAIwC,EAAoB7B,OACtDV,EAAI0C,EAAkBhC,KAAMX,EAAI2C,EAAkBhC,OAClDV,EAAImD,EAAezC,KAAMX,EAAIoD,EAAezC,OAC5CV,EAAI2C,EAAejC,KAAMX,EAAI4C,EAAejC,UAK1CmE,GAAmBhF,YAAe,CACtCC,IAAK,+CACLC,IAAK,WACH,MAAM,IAAIvL,MAAM,wBAElBwL,IAAK,WAAUnH,GAAU,IAAjBmH,EAAgB,EAAhBA,IACFnH,aAAgB+H,MACpBZ,EAAI+B,EAAclB,QAAShI,EAAKsC,YAChC6E,EAAIoC,EAAgBvB,QAAShI,EAAKwB,cAClC2F,EAAImC,EAAoBtB,QAAShI,EAAKgD,kBACtCmE,EAAIkD,EAAarC,QAAShI,EAAKuC,WAC/B4E,EAAI2B,EAAkBd,QAAShI,EAAKsB,gBACpC6F,EAAIuC,EAAoB1B,QAAShI,EAAKuB,YACtC4F,EAAI0C,EAAkB7B,QAAShI,EAAKyC,gBACpC0E,EAAImD,EAAetC,QAAShI,EAAKwC,aACjC2E,EAAI2C,EAAe9B,QAAShI,EAAK0C,iBAIxBuJ,GAAejF,YAAmB,CAC7CC,IAAK,uCACLC,IAAK,iBAAM,IACXC,IAAK,WAAe+E,GAAa,IAAzB/E,EAAwB,EAAxBA,IAAKD,EAAmB,EAAnBA,IAEX,GADAiF,EAAIC,mBAAqB,KACrBF,aAAmBnE,MACA,IAAnBmE,EAAQnO,OAAZ,CACA,IAAMiC,EAAOoB,EAAY8K,GACrBlM,EAAK2C,UAAUwE,EAAI4E,GAAe,MAClC/L,EAAK4C,eAAeuE,EAAI6E,GAAkBhM,GAE9C,IAAIyD,EAAUzD,EAAKyD,QAOnB,GALA0D,EAAI8D,GAAiBjL,EAAK8C,YAC1BqE,EAAI6D,IAAmBhL,EAAK6C,YAG1BqE,EAAIyD,IAAmBlH,EAAQ4I,MAAK,SAACxP,GAAD,OAAYA,EAAOkB,OAAS,KAChD,CAChB,IAAMuO,EAAapF,EAAIwD,GAEjB6B,EAAqBrF,EAAI0D,GAC/B,GAAI2B,EAAqB,EAAG,CAC1B,IAAMC,EAAS,EAAI,GAAKD,EAAqB,GAC7C9I,EAAUA,EAAQL,KAAI,SAAC2G,EAAGnJ,GAAJ,OFjNvB,SACL4L,EACAC,EACAC,GAEA,OAAOD,EAAUrJ,KAAI,WAAWuJ,GAAX,MAAG5I,EAAH,EAAGA,EAAH,MAAkB,CACrCC,EADmB,EAAMA,EAEzBD,IAAI,UAAA2I,EAAUC,UAAV,eAAc5I,IAAK,GAAKyI,EAASzI,GAAK,EAAIyI,OE2MxCI,CAAWJ,EAAQ/I,EAAQ7C,GAAI0L,EAAW1L,OAI9C,GAAIsG,EAAIoD,EAAezC,QAAU4B,EAAYoD,KAAM,CACjD,IAAMC,EAAWjP,KAAKuM,IAAL,MAAAvM,KAAI,YAChByO,EAAWlJ,KAAI,SAAC2G,GAAD,aAAO,UAAAA,EAAEA,EAAEhM,OAAS,UAAb,eAAiBiG,IAAK,OAGjDP,EAAUA,EAAQL,KAAI,SAAC2G,EAAGnJ,GAAJ,4BACjB0L,EAAW1L,IADM,YAEjBmJ,EAAE3G,KAAI,kBAAe,CAAEW,EAAjB,EAAGA,EAAiBC,EAApB,EAAMA,EAAqB8I,WAEtC,IAAMC,EACJ7F,EAAIqC,EAAgB1B,MAAQX,EAAIoC,EAAoBzB,MACxChK,KAAKuM,IAAL,MAAAvM,KAAI,YAAQ4F,EAAQL,KAAI,SAAC2G,GAAD,aAAO,UAAAA,EAAEA,EAAEhM,OAAS,UAAb,eAAiBiG,IAAK,OACvD+I,IACVtJ,EAAUA,EAAQL,KAAI,iBAAM,OAGhC,IAAM4J,EAAO,sBACRvJ,GADQ,CAEXyD,EAAI4D,GAAa5C,EAAOzE,EAAQ,IAAM,GACtCyD,EAAI6D,GAAa7C,EAAOzE,EAAQ,IAAM,KAGxC0D,EAAIuD,EAAWsC,GACX9F,EAAIoD,EAAezC,QAAU4B,EAAYwD,QAC3C9F,EAAIwD,GAAgB,Q,SCjSfuC,GAAgB,GAAhBA,GAA2B,GAA3BA,GAAuC,GAAvCA,GAAiD,GAEjDC,GAAkBnG,YAAS,CACtCC,IAAK,UACLC,IAAK,YAAc,IAAXA,EAAU,EAAVA,IAEN,MAAO,CAAC,EADKA,EAAIqC,EAAgB1B,MAAQX,EAAIoC,EAAoBzB,UAIxDuF,GAAkBrE,GAElBsE,GAAoBvG,EAC/Ba,YAAK,CACHV,IAAK,aACLQ,QAAS,KAGA6F,GAAqBxG,EAChCa,YAAK,CACHV,IAAK,cACLQ,QAAS,KAGA8F,GAAiBvG,YAAS,CACrCC,IAAK,SACLC,IAAK,YAAc,IAAXA,EAAU,EAAVA,IACAsG,EAAUtG,EAAIiG,IACdM,EAAQvG,EAAImG,IAClB,OAAOK,OAEJC,OAAOH,GACPI,MAAM,CAACV,GAAaO,EAAQP,QAGtBW,GAAiB7G,YAAS,CACrCC,IAAK,SACLC,IAAK,YAAc,IAAXA,EAAU,EAAVA,IACA4G,EAAU5G,EAAIkG,IACdW,EAAS7G,EAAIoG,IACnB,OAAOI,OAEJC,OAAOG,GACPE,WAAW,CAACD,EAASb,GAAeA,QAG9Be,GAAejH,YAAS,CACnCC,IAAK,OACLC,IAAK,YAAc,IAAXA,EAAU,EAAVA,IACAgH,EAAShH,EAAIqG,IACbY,EAASjH,EAAI2G,IAEnB,OAAOH,OAEJU,GAAE,gBAAGpK,EAAH,EAAGA,EAAH,OAAWkK,EAAOlK,MACpBqK,GAAE,gBAAGtK,EAAH,EAAGA,EAAH,OAAWoK,EAAOpK,SAGduK,GAAiBtH,YAAS,CACrCC,IAAK,UACLC,IAAK,YAAc,IAAXA,EAAU,EAAVA,IACAiH,EAASjH,EAAI2G,IACbK,EAAShH,EAAIqG,IAFH,EAGCrG,EAAIiG,IAAZoB,EAHO,sBAICrH,EAAIkG,IAAZoB,EAJO,oBAMhB,OAAOd,OAEJU,GAAE,SAACK,GAAD,OAAOP,EAAQO,EAAE,GAAKD,EAAQD,MAChCF,GAAE,SAACI,GAAD,OAAON,GAAQM,EAAE,UC9DpBC,IDiE0B1H,YAAS,CACvCC,IAAK,YACLC,IAAK,YAAc,IAAXA,EAAU,EAAVA,IACAlH,EAAOkH,EAAIwD,GACXiE,EAAOzH,EAAI+G,IACjB,OAAOjO,EAAKoD,KAAI,SAACpD,GAAD,OAAU2O,EAAK3O,SAAS3E,QCtEfuT,sBAA8B,SAACC,EAAQC,GAAS,IAAD,EACtC7P,oBAAS,GAD6B,mBACnE8P,EADmE,KACvDC,EADuD,KAEpEb,EAASc,YAAepB,IACxBJ,EAAQwB,YAAe5B,IAH6C,EAI9B6B,YAC1CpG,EAAkBjB,MALsD,mBAInEvG,EAJmE,KAInD6N,EAJmD,KAO1EC,8BAAoBN,GAAK,iBAAO,CAC9BO,UAD8B,WAE5BL,GAAc,IAEhBM,YAJ8B,SAIlBC,GACNR,GACFI,EAAkBhB,EAAOqB,OAAOD,EAAEE,YAAYC,eAIpD,IAAMC,EAAUxB,EAAO7M,GACvB,OACE,oCACE,0BACEsO,UAAU,iBACVC,GAAI3C,GACJ4C,GAAIrC,EAAQP,GACZ6C,GAAIJ,EACJK,GAAIL,IAEN,0BACEC,UAAU,uBACVK,YAAa,SAACV,GACZA,EAAEW,iBACFX,EAAEY,kBACFnB,GAAc,IAEhBa,GAAI3C,GACJ4C,GAAIrC,EAAQP,GACZ6C,GAAIJ,EACJK,GAAIL,IAEN,0BACEhH,KAAK,eACL0F,EAAGsB,EACHvB,EAAGX,EAAQP,GACXkD,GAAG,QACHC,GAAG,MAEF/O,EAAegP,QAAQ,GAP1B,UAaN5B,GAAqB6B,YAAc,uBAEpB7B,UCjDT8B,GAAmB5B,sBAA0B,SAACC,EAAQC,GAAS,IAAD,EAC9B7P,oBAAS,GADqB,mBAC3DwR,EAD2D,KAC/CC,EAD+C,KAE5DxC,EAASe,YAAe1B,IACxBQ,EAASkB,YAAe3B,IAHoC,EAI9B4B,YAAehG,EAAcrB,MAJC,mBAI3DvF,EAJ2D,KAI/CqO,EAJ+C,KAM5DnD,EAAUyB,YAAe9B,IAC/BiC,8BAAoBN,GAAK,iBAAO,CAC9BO,UAD8B,WAE5BqB,GAAc,IAEhBpB,YAJ8B,SAIlBC,GACNkB,GACFE,EAAczC,EAAOsB,OAAOD,EAAEE,YAAYmB,SAAWpD,EAAQ,SAInE,IAAMqD,EAAU3C,EAAO5L,EAAakL,EAAQ,IAE5C,OACE,oCACE,0BACEoC,UAAU,aACVC,GAAIgB,EACJf,GAAIe,EACJd,GAAIhC,EAASb,GACb8C,GAAI9C,KAEN,0BACE0C,UAAU,mBACVK,YAAa,SAACV,GACZA,EAAEW,iBACFX,EAAEY,kBACFO,GAAc,IAEhBb,GAAIgB,EACJf,GAAIe,EACJd,GAAIhC,EAASb,GACb8C,GAAI9C,KAEN,0BAAMvE,KAAK,eAAeyF,EAAGyC,EAASR,GAAG,OAAOD,GAAG,OAChDvS,KAAKC,MAAmB,IAAbwE,GADd,SAONkO,GAAiBD,YAAc,mBAChBC,UCrETF,GAAU,SAACQ,GAA+B,IAAhBC,EAAe,uDAAN,EACjCtI,EAAU5K,KAAKuE,IAAI,GAAI2O,GAC7B,OAAQlT,KAAKC,MAAMgT,EAAQrI,GAAWA,GAAS6H,QAAQS,IAMlD,SAASC,GAAWC,GAEzB,GADAA,EAAI1F,OAAO0F,IACN1F,OAAOC,SAASyF,GAAI,MAAO,KAEhC,IAAMC,EAAID,EAAI,GACR9P,EAAI8P,EAAI,GAAK,GACbnM,EAAS,IAAJmM,EACLE,EAAU,IAALrM,EACX,OAAIqM,EAAK,IAAab,GAAQa,EAAI,GAAK,UACnCrM,EAAK,GAAWwL,GAAQxL,EAAI,GAAK,KACjCA,EAAK,IAAawL,GAAQxL,GAAM,KAChCmM,EAAI,GAAWX,GAAQW,EAAG,GAAK,IAC/B9P,EAAI,EAAUmP,GAAQnP,EAAG,GAAK,IAAMmP,GAAQY,EAAI,GAAI,GAAK,IACzDA,EAAI,EAAUZ,GAAQY,EAAG,GAAK,IAAMZ,GAAQW,EAAI,GAAI,GAAK,IACtDX,GAAQW,EAAG,GAAK,IAWlB,SAASG,GAAcrN,GAC5B,IAAKwH,OAAOC,SAASzH,GAAI,MAAO,KAEhC,GAAIA,EAAI,EAAG,MAAO,IAAMqN,IAAerN,GACvC,IAAMsN,EAAS,IAAJtN,EACLuN,EAAU,IAALD,EACX,OAAIC,EAAK,GAAWhB,GAAQgB,EAAI,GAAK,QACjCA,EAAK,GAAWhB,GAAQgB,EAAI,GAAK,QACjCA,EAAK,IAAahB,GAAQgB,EAAI,GAAK,QACnCD,EAAK,GAAWf,GAAQe,EAAI,GAAK,KACjCA,EAAK,GAAWf,GAAQe,EAAI,GAAK,KACjCA,EAAK,IAAaf,GAAQe,EAAI,GAAK,KAChCf,GAAQvM,EAAG,GAAK,ICtCV,SAASwN,KACtB,IAAMC,EAAUC,iBAAsB,MAChC1D,EAASkB,YAAe3B,IACxBY,EAASe,YAAe1B,IACxBmE,EAAMF,EAAQ3F,QAoBpB,OAnBA8F,2BAAgB,WACd,GAAKD,EAAL,CACA,IAAME,EAASlE,KAASQ,EAAOP,SAAS,GAAIO,EAAOP,SAAS,GAAI,IAChED,KAAUgE,GAAKG,MAAK,SAACC,GAAD,OAClBA,EACGC,KAAK,YADR,sBACoChE,EAASb,GAD7C,MAEG2E,KACCnE,KACcQ,GACX8D,WAAWJ,GACXK,YAAY,IACZC,UAAUnE,EAASb,GAAaA,IAChCiF,WAAWnB,IACXoB,cAAc,IAElBP,MAAK,SAACC,GAAD,OAAOA,EAAEO,OAAO,WAAWC,kBAEpC,CAACZ,EAAKxD,EAAQH,IAEV,uBAAG6B,UAAU,SAASd,IAAK0C,ICzBrB,SAASe,KACtB,IAAMf,EAAUC,iBAAsB,MAChChE,EAAQwB,YAAe5B,IACvBc,EAASc,YAAepB,IACxB6D,EAAMF,EAAQ3F,QA0BpB,OAxBA8F,2BAAgB,WACd,GAAKD,EAAL,CACA,IAAMc,EAAS9E,KAASS,EAAOR,SAAS,GAAIQ,EAAOR,SAAS,GAAI,IAChED,KAAUgE,GACPG,MAAK,SAACC,GAAD,OACJA,EAAEC,KAAK,YAAP,oBAAiC7E,GAAjC,QAAmD2E,KACjDnE,KACYS,GACT6D,WAAWQ,GACXP,YAAY,IACZC,UAAUzE,EAAQP,GAAeA,GAAc,GAC/CiF,YAAW,SAACpO,GAAD,OAAOA,EAAI,WAG5B8N,MAAK,SAACC,GAAD,OACJA,EAAEO,OAAO,WAAWN,KAClB,KACA,SAACU,EAAIzI,EAAG0I,GAAR,OAEEhF,KAAUgF,EAAK,IAAIX,KAAK,KAAO,aAGtC,CAACL,EAAKvD,EAAQV,IAEV,uBAAGmC,UAAU,SAASd,IAAK0C,I,cClB9BmB,GAAU/D,sBAAuB,SAACC,EAAQC,GAAS,IAAD,EACtB7P,oBAAS,GADa,mBAC/C2T,EAD+C,KACrCC,EADqC,KAEhD3E,EAASe,YAAe1B,IACxBY,EAASc,YAAepB,IAHwB,EAItB5O,mBAAS,CAAEmP,GAAI,EAAGC,GAAI,IAJA,mBAI/CyE,EAJ+C,KAIrCC,EAJqC,OAK1B9T,mBAAS,CAAEmP,GAAI,EAAGC,GAAI,IALI,mBAK/C2E,EAL+C,KAKvCC,EALuC,KAoCtD,OA9BA7D,8BAAoBN,GAAK,iBAAO,CAC9BmB,YAD8B,SAClBV,GACVwD,EAAY,CACV3E,EAAGF,EAAOsB,OAAOD,EAAEE,YAAYmB,SAC/BvC,EAAGF,EAAOqB,OAAOD,EAAEE,YAAYC,WAEjCuD,EAAU,CACR7E,EAAGF,EAAOsB,OAAOD,EAAEE,YAAYmB,SAC/BvC,EAAGF,EAAOqB,OAAOD,EAAEE,YAAYC,WAEjCmD,GAAY,IAEdxD,UAZ8B,SAYpBE,GACJqD,IACFK,EAAU,CACR7E,EAAGF,EAAOsB,OAAOD,EAAEE,YAAYmB,SAC/BvC,EAAGF,EAAOqB,OAAOD,EAAEE,YAAYC,WAEjCmD,GAAY,KAGhBvD,YArB8B,SAqBlBC,GACNqD,GACFK,EAAU,CACR7E,EAAGF,EAAOsB,OAAOD,EAAEE,YAAYmB,SAC/BvC,EAAGF,EAAOqB,OAAOD,EAAEE,YAAYC,gBAKnCwD,mBAAQJ,EAAUE,GAAgB,qCAEpC,uBAAGpD,UAAU,WACX,0BACEA,UAAU,aACVC,GAAI3B,EAAO4E,EAAS1E,GAAM,EAC1B0B,GAAI5B,EAAO4E,EAAS1E,GAAM,EAC1B2B,GAAI5B,EAAO2E,EAASzE,GAAM,EAC1B2B,GAAI7B,EAAO2E,EAASzE,GAAM,IAE5B,0BACEuB,UAAU,aACVC,GAAI3B,EAAO4E,EAAS1E,GAAM,EAC1B0B,GAAI5B,EAAO4E,EAAS1E,GAAM,EAC1B2B,GAAI5B,EAAO2E,EAASzE,GAAM,EAC1B2B,GAAI7B,EAAO2E,EAASzE,GAAM,IAE5B,0BACEuB,UAAU,WACVC,GAAI3B,EAAO4E,EAAS1E,GACpB0B,GAAI5B,EAAO8E,EAAO5E,GAClB2B,GAAI5B,EAAO2E,EAASzE,GACpB2B,GAAI7B,EAAO2E,EAASzE,KAEtB,0BACE1F,KAAK,eACLyF,EAAGF,GAAQ4E,EAAS1E,EAAI4E,EAAO5E,GAAK,GACpCC,EAAGF,EAAO2E,EAASzE,GACnBgC,GAAG,OACHD,GAAG,SAEFY,GAAWgC,EAAO5E,EAAI0E,EAAS1E,IAElC,0BACEwB,UAAU,aACVC,GAAI3B,EAAO8E,EAAO5E,GAAM,EACxB0B,GAAI5B,EAAO8E,EAAO5E,GAAM,EACxB2B,GAAI5B,EAAO6E,EAAO3E,GAAM,EACxB2B,GAAI7B,EAAO6E,EAAO3E,GAAM,IAE1B,0BACEuB,UAAU,aACVC,GAAI3B,EAAO8E,EAAO5E,GAAM,EACxB0B,GAAI5B,EAAO8E,EAAO5E,GAAM,EACxB2B,GAAI5B,EAAO6E,EAAO3E,GAAM,EACxB2B,GAAI7B,EAAO6E,EAAO3E,GAAM,IAE1B,0BACEuB,UAAU,WACVC,GAAI3B,EAAO8E,EAAO5E,GAClB0B,GAAI5B,EAAO8E,EAAO5E,GAClB2B,GAAI5B,EAAO2E,EAASzE,GACpB2B,GAAI7B,EAAO6E,EAAO3E,KAEpB,0BACE1F,KAAK,eACLyF,EAAGF,EAAO8E,EAAO5E,GACjBC,EAAGF,GAAQ2E,EAASzE,EAAI2E,EAAO3E,GAAK,GACpCgC,GAAG,MACHD,GAAG,KAEFgB,GAAc4B,EAAO3E,EAAIyE,EAASzE,QAM3CsE,GAAQpC,YAAc,UACPoC,UCrGf,SAASQ,KACP,IAAMC,EAASnE,YAAepE,GACxBnI,EAAcuM,YAAenF,EAAejC,MAE5CwL,EAASpE,YAAeX,IACxBtO,EAAOiP,YAAevE,GACtB+D,EAAIzO,EAAK,GAAGoD,KAChB,SAACqL,EAAG7N,GAAJ,YAAU,GAAC,UAACZ,EAAK,GAAGY,UAAT,aAAC,EAAYmD,IAAK,EAAG0K,EAAE1K,MAEpC,OAAKqP,GAAW1Q,EAAY,IAAOA,EAAY,GAE7C,oCACE,0BAAMkN,UAAS,eAAkBnB,EAAG4E,EAAO5E,SAAMpT,KAHK,qCAO5D,SAASiY,KACP,IAAM3E,EAAOM,YAAehB,IAEtBsF,EADOtE,YAAevE,GACZtH,KAAI,SAACpD,GAAD,OAAU2O,EAAK3O,SAAS3E,KACtC4H,EAAUsQ,EAAG5S,MAAM,EAAG,GACtBwC,EAAWoQ,EAAG5S,MAAM,EAAG,GACvB6S,EAAOD,EAAG5S,MAAM,EAAG,GACzB,OACE,oCACGsC,EAAQG,KAAI,SAACqL,EAAG7N,GAAJ,OACX,0BAAMqG,IAAKrG,EAAGgP,UAAS,qBAAgBhP,GAAK6N,EAAGA,OAEhDtL,EAASC,KAAI,SAACqL,EAAG7N,GAAJ,OACZ,0BAAMqG,IAAKrG,EAAGgP,UAAS,qBAAgBhP,GAAK6N,EAAGA,OAEhD+E,EAAKpQ,KAAI,SAACqL,EAAG7N,GAAJ,OACR,0BAAMqG,IAAKrG,EAAGgP,UAAS,uBAAkBhP,GAAK6N,EAAGA,QAM1C,SAASgF,KACtB,IAAMjC,EAAUC,iBAAsB,MAChCiC,EAAgBjC,iBAAsB,MACtCkC,EAAoBlC,iBAA0B,MAC9CmC,EAAanC,iBAAmB,MAChCoC,EAAepC,iBAAuB,MALf,EAMLqC,YAAQD,GANH,mBAMtBpG,EANsB,KAMfM,EANe,KAOvBgG,EAAgBC,YAAkB1G,IAClC2G,EAAeD,YAAkB3G,IAKvC,OAJA6G,qBAAU,WACRH,EAAchG,GACdkG,EAAaxG,KACZ,CAACM,EAAQgG,EAAeE,EAAcxG,IAEvC,yBAAKmC,UAAU,gBAAgBd,IAAK+E,GAClC,yBACEjE,UAAU,OACVd,IAAK0C,EACLlC,YAAa,SAACC,GAAO,IAAD,MAClB,UAAAmE,EAAc7H,eAAd,SAAuByD,YAAYC,GACnC,UAAAoE,EAAkB9H,eAAlB,SAA2ByD,YAAYC,GACvC,UAAAqE,EAAW/H,eAAX,SAAoByD,YAAYC,GAChCA,EAAEW,kBAEJiE,aAAc,SAAC5E,GAAO,IAAD,MACnB,UAAAmE,EAAc7H,eAAd,SAAuBwD,UAAUE,GACjC,UAAAoE,EAAkB9H,eAAlB,SAA2BwD,UAAUE,GACrC,UAAAqE,EAAW/H,eAAX,SAAoBwD,UAAUE,GAC9BA,EAAEW,kBAEJb,UAAW,SAACE,GAAO,IAAD,MAChB,UAAAmE,EAAc7H,eAAd,SAAuBwD,UAAUE,GACjC,UAAAoE,EAAkB9H,eAAlB,SAA2BwD,UAAUE,GACrC,UAAAqE,EAAW/H,eAAX,SAAoBwD,UAAUE,GAC9BA,EAAEW,kBAEJD,YAAa,SAACV,GAAO,IAAD,EAClB,UAAAqE,EAAW/H,eAAX,SAAoBoE,YAAYV,GAChCA,EAAEW,mBAGJ,kBAACqB,GAAD,MACA,kBAACgB,GAAD,MACA,kBAACe,GAAD,MACA,kBAACH,GAAD,MACA,kBAAC,GAAD,CAASrE,IAAK8E,IACd,kBAAC,GAAD,CAAsB9E,IAAK6E,IAC3B,kBAAC,GAAD,CAAkB7E,IAAK4E,M,yEClFzBU,GAAqB,CACzBC,UAAW,GACXC,QAAS,OACTC,eAAgB,gBAChBC,WAAY,UAGC,SAASC,KACtB,IAAMC,EAAYzF,YAAetE,GACjCwB,EAAI3C,YAAcwK,YAAkBxK,EAAY3B,MAFhB,MAGMqH,YAAe5E,EAAezC,MAHpC,mBAGzBrF,EAHyB,KAGZmS,EAHY,OAIYzF,YAC1CrF,EAAkBhC,MALY,mBAIzBpF,EAJyB,KAITmS,EAJS,KAO1B/R,EAAaoM,YAAejE,GAPF,EAQgBkE,YAC9CxF,EAAoB7B,MATU,mBAQzBgN,EARyB,KAQPC,EARO,KAY1BC,EADe9F,YAAe1F,EAAgB1B,MACV,KAC1C,OACE,kBAACmN,GAAA,EAAD,CAAOC,OAAO,UAAUC,QAAM,EAACC,aAAW,EAACC,iBAAe,GACxD,kBAACC,GAAA,EAAD,CAAeC,MAAOlB,IACpB,kBAACmB,GAAA,EAAD,KACG,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAAMnS,KAAI,SAACoS,EAAMC,GAAP,OACxC,kBAACC,GAAA,EAAD,CACEzO,IAAKwO,EACLE,WAAYlT,IAAmBgT,EAAM,UAAY,UACjDG,SACE,CAAC,KAAM,MAAMC,SACXL,GAGJM,KAAK,KACLrW,QAAS,kBAAMmV,EAAkBa,KAEhCD,QAKT,kBAACH,GAAA,EAAD,CAAeC,MAAOlB,IACpB,kBAACmB,GAAA,EAAD,KACGhL,OAAOC,OAAOf,GAAarG,KAAI,SAAC2S,GAAD,OAC9B,kBAACL,GAAA,EAAD,CACEzO,IAAK8O,EACLJ,WAAYnT,IAAgBuT,EAAO,UAAY,UAC/C1V,MACE0V,IAAStM,EAAYoD,MAAQkI,EACzB,WACA1Z,EAENya,KAAK,KACLrW,QAAS,kBAAMkV,EAAeoB,KAE7BA,QAKT,kBAACV,GAAA,EAAD,CAAeC,MAAOlB,IACpB,2CACA,kBAACmB,GAAA,EAAD,KACE,kBAACS,GAAA,EAAD,CACEF,KAAK,KACLH,WACEd,IAAqBhM,EAAiBe,QAClC,UACA,UAENtJ,KAAM,kBAAC2V,GAAA,EAAD,CAAM3V,KAAK,eACjBb,QAAS,kBAAMqV,EAAoBjM,EAAiBe,YAEtD,kBAACoM,GAAA,EAAD,CACEF,KAAK,KACLH,WACEd,IAAqBhM,EAAiBc,OAClC,UACA,UAENrJ,KAAM,kBAAC2V,GAAA,EAAD,CAAM3V,KAAK,aACjBb,QAAS,kBAAMqV,EAAoBjM,EAAiBc,aAI1D,kBAAC0L,GAAA,EAAD,CAAeC,MAAOlB,IAAtB,aAEIM,EAEE7R,EACF,kBAACqT,GAAA,EAAD,CAAK7V,MAAM,SAAX,aAEA,kBAAC6V,GAAA,EAAD,CAAK7V,MAAM,UAAX,aAJA,kBAAC6V,GAAA,EAAD,CAAK7V,MAAM,OAAX,U,cCrGJ+T,GAAqB,CACzBC,UAAW,GACXC,QAAS,OACTC,eAAgB,gBAChBC,WAAY,UAGC,SAAS2B,KAAY,IAAD,EACmBjH,YAClDtE,GAF+B,mBAC1B2B,EAD0B,KACN6J,EADM,OAILlH,YAAerE,GAJV,mBAI1BuI,EAJ0B,KAIlBiD,EAJkB,OAKTnH,YAAepE,GALN,mBAK1BwL,EAL0B,KAKpBC,EALoB,OAMTrH,YAAenE,GANN,mBAM1ByL,EAN0B,KAMpBC,EANoB,OAOKvH,YAAepF,EAAejC,MAPnC,mBAO1BnF,EAP0B,KAObgU,EAPa,KASjC,OACE,kBAAC1B,GAAA,EAAD,CAAOC,OAAO,WAAWC,QAAM,EAACC,aAAW,EAACC,iBAAe,GACzD,kBAACC,GAAA,EAAD,CAAeC,MAAOlB,IACpB,kBAACmB,GAAA,EAAD,KACG,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAAMnS,KAAI,SAACoS,EAAM5U,GAAP,OACxC,kBAAC8U,GAAA,EAAD,CACEzO,IAAKrG,EACL+U,WAAYjT,EAAY9B,GAAK,UAAY,UACzCkV,KAAK,KACLF,SACE,CAAC,KAAM,MAAMC,SACXL,GAGJ/V,QAAS,WACP,IAAM5C,EAAS6F,EAAY/B,QAC3B9D,EAAO+D,IAAM/D,EAAO+D,GACpB8V,EAAe7Z,KAGhB2Y,QAKT,yBAAKF,MAAOlB,IAAZ,aAEE,kBAACuC,GAAA,EAAD,CACErB,MAAO,CAAE7H,MAAO,OAChB9G,MAAO4F,EACPqK,SAAUR,EACVhM,IAAK,GACLD,IAAK,EACL0M,KAAM,MAIV,kBAACtB,GAAA,EAAD,KACE,kBAACG,GAAA,EAAD,CACEC,WAAYW,EAAO,UAAY,UAC/BV,UAAWlT,EAAY,GACvBoT,KAAK,KACLrW,QAAS,WACP8W,GAASD,KALb,UAUA,kBAACZ,GAAA,EAAD,CACEC,WAAYa,EAAO,UAAY,UAC/BZ,UAAWlT,EAAY,GACvBoT,KAAK,KACLrW,QAAS,WACPgX,GAASD,KALb,UAUA,kBAACd,GAAA,EAAD,CACEC,WAAYvC,EAAS,UAAY,UACjCwC,WAAYlT,EAAY,IAAMA,EAAY,IAC1CoT,KAAK,KACLrW,QAAS,WACP4W,GAAWjD,KALf,Q,kCCnFD,SAAS0D,KAAiB,IAAD,EACJ7X,oBAAS,GADL,mBACvB8X,EADuB,KAChBC,EADgB,OAGA/X,oBAAU,GAHV,mBAGvBZ,EAHuB,KAGd4G,EAHc,KAU9B,MAAO,CAAC8R,EANY,WAClBC,GAAS,GACTC,aAAa5Y,GACb,IAAM6Y,EAAYla,OAAOiI,YAAW,kBAAM+R,GAAS,KAAQ,KAC3D/R,EAAWiS,KCyDAC,OA3Df,WAAsB,IAAD,EACejI,YAAe7E,EAAaxC,MAD3C,mBACZtF,EADY,KACD6U,EADC,OAESN,KAFT,mBAEZO,EAFY,KAEAC,EAFA,OAGaR,KAHb,mBAGZS,EAHY,KAGEC,EAHF,KAqBnB,OAjBAtD,qBAAU,WAWR,OAVAuD,KAAUrZ,KAAK,MAAM,SAACmR,GACpBA,EAAEW,iBACFoH,IACAF,EAAa7U,EAAY,MAE3BkV,KAAUrZ,KAAK,QAAQ,SAACmR,GACtBA,EAAEW,iBACFsH,IACAJ,EAAa7U,EAAY,MAEpB,WACLkV,KAAUC,OAAO,MACjBD,KAAUC,OAAO,WAElB,CAACnV,EAAW6U,EAAcI,EAASF,IAGpC,yBACEhC,MAAO,CACL7H,MAAO,QACP6G,QAAS,QACTC,eAAgB,iBAChBoD,aAAc,IAGhB,kBAAC3B,GAAA,EAAD,CACE4B,OAAQL,EACRzB,KAAK,KACLxV,KAAM,kBAAC2V,GAAA,EAAD,CAAM3V,KAAK,SACjBb,QAAS,kBAAM2X,EAAa7U,EAAY,MAE1C,kBAACsV,GAAA,EAAD,CACEC,YAAY,EACZnR,MAAOpE,EACPwV,WAAW,EACXnB,SAAUQ,EACVpX,KAAMwD,EAAcJ,KAAI,SAACW,EAAGnD,GAC1B,MAAO,CACLoX,MAAO5G,GAAcrN,EAAI,IAAM,SAC/B4C,MAAO/F,MAGX0U,MAAO,CAAE2C,KAAM,EAAGC,WAAY,EAAGC,YAAa,KAEhD,kBAACnC,GAAA,EAAD,CACE4B,OAAQP,EACRvB,KAAK,KACLxV,KAAM,kBAAC2V,GAAA,EAAD,CAAM3V,KAAK,OACjBb,QAAS,kBAAM2X,EAAa7U,EAAY,QCjD1C4O,GAAK,SAACxN,GAAD,OAAeA,EAAI,KACxBmB,GAAK,SAACnB,GAAD,OAAeA,EAAI,KAExByU,GAAS,SAACC,EAA2BxM,EAAiBuM,GAC1D,IAAIxX,EAAIyX,EAAKjV,KAAI,qBAAGuD,SAAmB/B,QAAQiH,GAAWuM,EAE1D,OAAOC,EADPzX,EAAIsJ,EAAUtJ,EAAG,EAAGyX,EAAKta,OAAS,IACnB4I,OAEF,SAAS2R,KAAc,IAAD,EACKpJ,YAAe3F,EAAgB1B,MADpC,mBAC5BrG,EAD4B,KACd+W,EADc,KAE7BlP,EAAU4F,YAAe3F,EAAoBzB,MAFhB,EAGHiP,KAHG,mBAG5B0B,EAH4B,KAGdC,EAHc,OAID3B,KAJC,mBAI5B4B,EAJ4B,KAIbC,EAJa,KAM7BC,EAAY,CAChBzH,GAAG,MACHA,GAAG,MACHA,GAAG,OACHA,GAAG,OACHA,GAAG,KACHA,GAAG,KACHA,GAAG,KACHrM,GAAG,GACHA,GAAG,GACHA,GAAG,IACHA,GAAG,IACHA,GAAG,IACD,GACA,GACA,GACA,EACA,EACA,EACA,GACA,GACA,GACA,IACA,KACF1B,KAAI,SAACyV,GACL,IAAMrX,EAAiC,GAAjBqX,EAAuBxP,EAC7C,MAAO,CACL2O,MAAOhH,GAAW6H,GAAkB,SACpClS,MAAOnF,MAqBX,OAlBA0S,qBAAU,WAWR,OAVAuD,KAAUrZ,KAAK,SAAS,SAACmR,GACvBA,EAAEW,iBACFyI,IACAJ,EAAgBH,GAAOQ,EAAWpX,EAAc,OAElDiW,KAAUrZ,KAAK,QAAQ,SAACmR,GACtBA,EAAEW,iBACFuI,IACAF,EAAgBH,GAAOQ,EAAWpX,GAAe,OAE5C,WACLiW,KAAUC,OAAO,SACjBD,KAAUC,OAAO,WAElB,CAACa,EAAiB/W,EAAcoX,EAAWD,EAAUF,IACxDtM,EAAIoM,gBAAkBA,EAGpB,yBACEjD,MAAO,CACL7H,MAAO,QACP6G,QAAS,QACTC,eAAgB,iBAChBoD,aAAc,IAGhB,kBAAC3B,GAAA,EAAD,CACE4B,OAAQY,EACR1C,KAAK,KACLxV,KAAM,kBAAC2V,GAAA,EAAD,CAAM3V,KAAK,SACjBb,QAAS,kBAAM8Y,EAAgBH,GAAOQ,EAAWpX,GAAe,OAElE,kBAACqW,GAAA,EAAD,CACEC,YAAY,EACZnR,MAAOnF,EACPuW,WAAW,EACXnB,SAAU,SAACjT,GACT4U,EAAgB5U,IAElB3D,KAAM4Y,EACNtD,MAAO,CAAE2C,KAAM,EAAGC,WAAY,EAAGC,YAAa,KAEhD,kBAACnC,GAAA,EAAD,CACE4B,OAAQc,EACR5C,KAAK,KACLxV,KAAM,kBAAC2V,GAAA,EAAD,CAAM3V,KAAK,UACjBb,QAAS,kBAAM8Y,EAAgBH,GAAOQ,EAAWpX,EAAc,QC/FxD,SAASsX,KAAU,IAAD,EACG5J,YAAevE,GADlB,mBACxB+J,EADwB,KACbqE,EADa,OAEGjC,KAFH,mBAExBkC,EAFwB,KAETC,EAFS,KAe/B,OAXA/E,qBAAU,WAMR,OALAuD,KAAUrZ,KAAK,SAAS,SAACmR,GACvBA,EAAEW,iBACF+I,IACAF,GAAa,SAACrE,GAAD,OAAgBA,QAExB,WACL+C,KAAUC,OAAO,YAElB,CAACqB,EAAcE,IAGhB,kBAACjE,GAAA,EAAD,CAAOC,OAAO,SAASC,QAAM,EAACC,aAAW,EAACC,iBAAe,GACvD,kBAACM,GAAA,EAAD,CACEkC,OAAQoB,EACR1D,MAAO,CACLjV,MAAO,QACP6Y,gBAAiBxE,EAAY,QAAU,MACvCjH,MAAO,OACPkK,aAAc,QAEhB7B,KAAK,KACLrW,QAAS,WACPsZ,GAAcrE,MAGdA,EAAY,MAAQ,QAAU,YAElC,kBAAC4D,GAAD,MACA,kBAAC,GAAD,O,cC5BA1Z,GAAgB,CACpB9C,SAAU,OACVI,WAAY,KAERkY,GAAqB,CACzBC,UAAW,GACXC,QAAS,OACTC,eAAgB,gBAChBC,WAAY,UAsGC2E,OAlGf,WAA2B,IAAD,EACkBla,mBAAS,IAD3B,mBACjBma,EADiB,KACFC,EADE,OAEEpa,mBAAS,IAFX,mBAEjBkB,EAFiB,KAEVmZ,EAFU,OAGcra,mBAAyB,gBAHvC,mBAGjBsa,EAHiB,KAGJC,EAHI,KAIlBC,EAAazF,YAAkB/H,IAiBrC,OAhBAiI,qBAAU,WACY,UAAhBqF,GAAyBD,EAAS,MACrC,CAACC,IACJrF,qBAAU,WACR,OAAOpZ,EAAO4e,QAAO,SAAC1Z,GACpByZ,EAAWzZ,QAEZ,CAACyZ,IACJvF,qBAAU,WACRsF,EAAe,iBACf1e,EACG6e,kBAAkB/a,IAClB7B,KAAKsc,GACLtc,MAAK,kBAAMyc,EAAe,gBAC1BI,OAAM,kBAAMJ,EAAe,qBAC7B,IAED,kBAACxE,GAAA,EAAD,CAAOE,QAAM,EAACD,OAAO,UACnB,kBAACM,GAAA,EAAD,CAAaD,MAAOlB,IAClB,kBAAC4B,GAAA,EAAD,CACEV,MAAO,CAAE2C,KAAM,GACftC,WAA4B,cAAhB4D,EAA8B,eAAYle,EACtDya,KAAK,KACLrW,QAAO,sBAAE,sBAAAhC,EAAA,sDACP3C,EACGmF,QAAQrB,IACR7B,KAAKsc,GACLtc,MAAK,kBAAMyc,EAAe,gBAC1BI,OAAM,SAACrK,GACNiK,EAAe,SACfF,EAAS/J,EAAEnP,eAPR,2CAUTE,KAAM,kBAAC2V,GAAA,EAAD,CAAM3V,KAAK,cAAcgV,MAAO,CAAE7H,MAAO,WAC/CoM,UAAU,UAEZ,kBAAC7D,GAAA,EAAD,CACEV,MAAO,CAAE2C,KAAM,GACfnC,KAAK,KACLH,WAA4B,cAAhB4D,EAA8B,eAAYle,EACtDoE,QAAO,sBAAE,sBAAAhC,EAAA,sDACP3C,EACGS,QACAwB,MAAK,kBAAMyc,EAAe,mBAC1BI,OAAM,kBAAMJ,EAAe,YAJvB,2CAMTlZ,KAAM,kBAAC2V,GAAA,EAAD,CAAM3V,KAAK,OAAOgV,MAAO,CAAE7H,MAAO,WACxCoM,UAAU,UAGZ,kBAAC7D,GAAA,EAAD,CACEV,MAAO,CAAE2C,KAAM,GACfnC,KAAK,KACLrW,QAAO,sBAAE,sBAAAhC,EAAA,6DACP+b,EAAe,iBADR,SAGD1e,EACH6e,kBAAkB/a,IAClB7B,KAAKsc,GACLO,OAAM,kBAAM9e,EAAOmF,QAAQrB,IAAe7B,KAAKsc,MAC/Ctc,MAAK,kBAAMyc,EAAe,gBAC1BI,OAAM,kBAAMJ,EAAe,YARvB,2CAUTlZ,KAAM,kBAAC2V,GAAA,EAAD,CAAM3V,KAAK,UAAUgV,MAAO,CAAE7H,MAAO,WAC3CoM,UAAU,WAId,kBAACxE,GAAA,EAAD,CAAeC,MAAOlB,IAAtB,aAEI,WACA,IAAM/T,EAAQ,CACZyZ,UAAW,QACX,gBAAiB,SACjBne,MAAO,MACPoe,kBAAc1e,GACdke,GAEF,OACE,kBAACrD,GAAA,EAAD,CAAK7V,MAAOA,GACTkZ,EADH,IACiBpZ,GAVnB,IAea,cAAhBoZ,GACC,yBAAKjE,MAAO,CAAE0E,SAAU,KAAO3U,KAAKI,UAAU2T,IAE/B,iBAAhBG,GAAkC,kBAACva,GAAA,EAAD,QC5GzC,SAASib,KACP,IAAMnX,EAAamM,YAAehE,IAClC,OAAO,kBAACiL,GAAA,EAAD,aAAWpT,EAAX,SAET,SAASoX,KAAO,IAAD,EACQjb,mBAAS,GAArBkb,EADI,sBAESlb,mBAAS,GAFlB,mBAENmb,EAFM,KAEDC,EAFC,KAGPra,EAAOiP,YAAevE,GAU5B,OATAwJ,qBAAU,WACRiG,GAAS,SAACG,GAKR,OAJAD,GAAO,SAACD,GAEN,MAAa,GAANA,EAAqB,IADb,KAAQG,YAAYC,MAAQF,OAGtCC,YAAYC,WAEpB,CAACxa,IACG,kBAACkW,GAAA,EAAD,aAAWrY,KAAKC,MAAMsc,IAG/B,SAASK,KACP,IAAMC,EAAYzL,YAAe/D,IACjC,OAAO,kBAACgL,GAAA,EAAD,cZRF,SAAoByE,GACzB,IAAKpP,OAAOC,SAASmP,GAAK,MAAO,KAEjC,IAAMC,EAAMD,EAAK,IACjB,OAAIA,EAAK,IAAarK,GAAQqK,GAAM,KAChCC,EAAM,GAAWtK,GAAQsK,EAAK,GAAK,MAChCtK,GAAQsK,GAAO,MYEHC,CAAWH,IAEhC,SAASI,KACP,IAAMJ,EAAYzL,YAAe/D,IACjC,OAAO,kBAACgL,GAAA,EAAD,iBAAelF,GAAW,EAAI0J,IAGvC,IAAMpF,GAAQ,CACZ7H,MAAO,QACP6G,QAAS,QACTC,eAAgB,kBAElB,SAASwG,KACP,IAAMC,EAAW/L,YAAe7F,IAChC,OACE,oCACE,yBAAKkM,MAAOA,IACV,kBAACY,GAAA,EAAD,cAAY9E,GAAc4J,EAAShS,OACnC,kBAACkN,GAAA,EAAD,cAAY9E,GAAc4J,EAASrP,QAErC,yBAAK2J,MAAOA,IACV,kBAACY,GAAA,EAAD,cAAY9E,GAAc4J,EAAS7R,OACnC,kBAAC+M,GAAA,EAAD,cAAY9E,GAAc4J,EAAS/R,QAK5B,SAASgS,KACtB,OACE,6BACE,kBAACjG,GAAA,EAAD,CAAOC,OAAO,WAAWC,QAAM,EAACC,aAAW,EAACC,iBAAe,GACzD,kBAAC2F,GAAD,MACA,yBAAKzF,MAAOA,IACV,kBAACwF,GAAD,MACA,kBAACL,GAAD,OAEF,yBAAKnF,MAAOA,IACV,kBAAC2E,GAAD,MACA,kBAACC,GAAD,SCnDKgB,OAZf,WACE,OACE,oCACE,kBAAC,GAAD,MACA,kBAACpC,GAAD,MACA,kBAAC3C,GAAD,MACA,kBAAC1B,GAAD,MACA,kBAACwG,GAAD,Q,8BCXS,SAASE,KACtB,OACE,kBAACnG,GAAA,EAAD,CAAOC,OAAO,QAAQC,QAAM,EAACC,aAAW,EAACC,iBAAe,GACtD,gDACA,uBAAGgG,KAAK,uDAAR,wD,kCCHAC,GACJ,4DACIC,GAAS,CACb7N,MAAO,QACP6G,QAAS,eACTiH,cAAe,OAqGFC,OAnGf,WAAqC,IAC3BC,EAASC,aAAQL,IAAjBI,KAER,OACE,yBAAK7L,UAAU,OACb,kBAACoF,GAAA,EAAD,CACEE,QAAM,EACNyG,UAAQ,EACRrG,MAAO,CACLpI,OAAQ,YACR0O,SAAU,SACV7N,OAAQ,OACR8N,KAAM,KAGR,kBAAC7G,GAAA,EAAD,CACEC,OACE,oCACE,uBAAGK,MAAO,CAAE0E,SAAU,KAAtB,2EAEa,KAEb,+BAIJ,kBAAC8B,GAAA,EAAD,CAAOC,UAAQ,EAACzG,MAAOgG,IACrB,kBAACQ,GAAA,EAAME,KAAP,CACEC,MAAM,4BACNC,YACE,kBAACxG,GAAA,EAAD,CACErV,MAAM,QACNZ,QAAS,WACPgc,IACAU,KAAaC,QAAQ,CACnBH,MAAO,8BACPC,YAAab,OAIhBA,MAIP,kBAACS,GAAA,EAAME,KAAP,CACEC,MAAM,+DACNC,YACE,oCACE,yBACEG,IAAI,GACJC,IAAK3c,8CAEP,4HAON,kBAACmc,GAAA,EAAME,KAAP,CACEC,MAAM,gDACNC,YACE,yBACEG,IAAI,GACJC,IACE3c,oEAMR,kBAACmc,GAAA,EAAME,KAAP,CACEC,MAAM,mBACNC,YAAY,gDAEd,kBAACJ,GAAA,EAAME,KAAP,CACEC,MAAM,QACNC,YACE,oCACE,yBACEzO,MAAM,QACN4O,IAAI,GACJC,IAAK3c,6CAEP,4KC/DH4c,OArBf,WACE,OALF,WACE,IAAMC,EAAM/gB,UAAUghB,UAAUC,MAAM,4BACtC,OAAOnR,SAAOiR,GAAMra,SAASqa,EAAI,GAAI,KAGjCG,GAAqB,GAChB,oFACJlhB,UAAUX,OAEb,yBAAK8U,UAAU,OACb,kBAACgN,GAAA,EAAD,KACE,kBAACC,GAAA,EAAD,KACE,kBAAC7H,GAAA,EAAD,CAAOE,QAAM,GACX,kBAACzB,GAAD,QAGJ,kBAACqJ,GAAA,EAAD,CAASrP,MAAO,KACd,kBAAC,GAAD,MACA,kBAAC0N,GAAD,SAXsB,kBAAC,GAAD,OCHZlR,QACW,cAA7BjN,OAAO+f,SAASC,UAEe,UAA7BhgB,OAAO+f,SAASC,UAEhBhgB,OAAO+f,SAASC,SAASN,MACvB,2DCTNO,IAASC,OACP,kBAAC,IAAMC,WAAP,KACE,kBAAC,IAAD,KACE,kBAAC,GAAD,QAGJC,SAASC,eAAe,SD4HpB,kBAAmB5hB,WACrBA,UAAU6hB,cAAcC,MACrBxgB,MAAK,SAAAygB,GACJA,EAAaC,gBAEd7D,OAAM,SAAAzZ,GACLjF,QAAQiF,MAAMA,EAAMZ,c","file":"static/js/main.2a171da0.chunk.js","sourcesContent":["// based in wonky  https://github.com/yaakov-h/uniden-web-controller/blob/master/serial.js\nimport { ReadableWebToNodeStream } from 'readable-web-to-node-stream'\nimport { NavigatorSerial, Port, SerialOptions } from './Serial'\n\ndeclare global {\n  interface Window {\n    serial2: Serial\n  }\n  interface Navigator {\n    serial: NavigatorSerial\n  }\n}\n\nexport class Serial {\n  port?: Port\n  reader?: NodeJS.ReadableStream\n  writer?: WritableStreamDefaultWriter\n\n  async close() {\n    console.log('closing')\n    if (this.reader) {\n      const reader = this.reader\n      this.reader = undefined\n      // @ts-ignore\n      await reader.reader.cancel()\n      // await this.reader.close() // this blocks if uploading failed\n    }\n    if (this.writer) {\n      const writer = this.writer\n      this.writer = undefined\n      await writer.close()\n    }\n    if (this.port) {\n      const port = this.port\n      this.port = undefined\n      await port.close()\n    }\n    console.log('closed')\n  }\n  async connectWithPaired(options: SerialOptions) {\n    const [port] = await navigator.serial.getPorts()\n    if (!port) throw new Error('no paired')\n    return this._connect(options, port)\n  }\n  async connect(options: SerialOptions) {\n    const port = await navigator.serial.requestPort({})\n    return this._connect(options, port)\n  }\n  async _connect(options: SerialOptions, port: Port) {\n    options = {\n      baudRate: 9600,\n      dataBits: 8,\n      stopBits: 1,\n      parity: 'none',\n      bufferSize: 255,\n      rtscts: false,\n      xon: false,\n      xoff: false,\n      ...options\n    }\n    if (this.port) await this.close()\n    this.port = port\n    await this.port.open(options)\n    this.reader = new ReadableWebToNodeStream(this.port.readable)\n    this.writer = this.port.writable.getWriter()\n\n    // next I'm faking a NodeJS.ReadWriteStream\n    const rwStream = (this.reader as unknown) as NodeJS.ReadWriteStream\n    // @ts-ignore\n    rwStream.write = (\n      buffer: string | Uint8Array,\n      onDone: (err: Error | null | undefined) => void\n    ) => {\n      this.writer!.write(buffer).then(() => onDone(null), onDone)\n      return true\n    }\n    return rwStream\n  }\n}\nconst serial = new Serial()\n\nexport default serial\n\nwindow.serial2 = serial\n// window.addEventListener('beforeunload', () => serial.close())\n","import React, { useState } from 'react'\nimport { Button, Icon, Progress } from 'rsuite'\nimport serial2 from '../../communication/Serial2'\nimport async from 'async'\nimport intel_hex from 'intel-hex'\nimport Stk500 from 'stk500'\n\nconst stk500 = new Stk500()\nconst bootload = async (\n  stream: NodeJS.ReadWriteStream,\n  hex: string,\n  opt: typeof board,\n  progress: (percent: number) => void\n) => {\n  let sent = 0\n  stk500.log = (what: string) => {\n    if (what === 'loaded page') {\n      sent += 1\n      const percent = Math.round((100 * sent) / (hex.length / opt.pageSize))\n      progress(percent)\n    }\n  }\n\n  await async.series([\n    // send two dummy syncs like avrdude does\n    stk500.sync.bind(stk500, stream, 3, opt.timeout),\n    stk500.sync.bind(stk500, stream, 3, opt.timeout),\n    stk500.sync.bind(stk500, stream, 3, opt.timeout),\n    stk500.verifySignature.bind(stk500, stream, opt.signature, opt.timeout),\n    stk500.setOptions.bind(stk500, stream, {}, opt.timeout),\n    stk500.enterProgrammingMode.bind(stk500, stream, opt.timeout),\n    stk500.upload.bind(stk500, stream, hex, opt.pageSize, opt.timeout),\n    // stk500.verify.bind(stk500, stream, hex, opt.pageSize, opt.timeout),\n    stk500.exitProgrammingMode.bind(stk500, stream, opt.timeout)\n  ])\n}\n\nconst serialOptions = {\n  baudRate: 57600,\n  bufferSize: 20000\n}\nconst board = {\n  signature: Buffer.from([0x1e, 0x95, 0x0f]),\n  pageSize: 128,\n  timeout: 400\n}\nfunction Uploader() {\n  const [percent, setPercent] = useState(0)\n  const [status, setStatus] = useState<'active' | 'fail' | 'success'>('active')\n  const [isProgressHidden, setIsProgressHidden] = useState(true)\n  const [message, setMessage] = useState('')\n  const onClick = async () => {\n    setMessage('Uploading...')\n    try {\n      setIsProgressHidden(true)\n      const hex = await fetch(process.env.PUBLIC_URL + '/src.ino.hex')\n        .then((response) => response.text())\n        .then((text) => intel_hex.parse(text).data)\n      const serialStream = await serial2.connect(serialOptions)\n      setStatus('active')\n      setPercent(0)\n      setIsProgressHidden(false)\n      await bootload(serialStream, hex, board, setPercent)\n      setStatus('success')\n      setMessage(`Uploaded ${hex.length} bytes.`)\n    } catch (e) {\n      console.error(e)\n      setMessage(e.toString())\n      setStatus('fail')\n    }\n    serial2.close()\n  }\n  return (\n    <>\n      <br />\n      <Button color=\"green\" onClick={onClick}>\n        <Icon icon=\"upload2\" /> Upload lgt328p Firmware\n      </Button>\n      {!isProgressHidden && (\n        <>\n          <Progress.Line percent={percent} status={status} />\n          {message}\n        </>\n      )}\n    </>\n  )\n}\n\nexport default Uploader\n","import { voltageRanges } from './bindings'\n\ntype Data = {\n  data: number[]\n  i: number\n}\n\nfunction pull(data: Data, count: number) {\n  const result = data.data.slice(data.i, data.i + count)\n  data.i += count\n  return Array.from(result)\n}\n\nfunction get_uint8_t(data: Data) {\n  const res = data.data[data.i]\n  data.i++\n  return res\n}\nconst get_bool = get_uint8_t\n\nfunction get_uint16_t(data: Data) {\n  const l = data.data[data.i]\n  data.i++\n  const h = data.data[data.i]\n  data.i++\n  return (h << 8) | l\n}\nfunction get_float32_t(data: Data) {\n  // IEEE 754\n  // https://gist.github.com/Jozo132/2c0fae763f5dc6635a6714bb741d152f#file-float32encoding-js-L32-L43\n  const arr = data.data.slice(data.i, data.i + 4)\n  data.i += 4\n\n  const int = arr.reverse().reduce((acc, curr) => (acc << 8) + curr)\n  if (int === 0) return 0\n  const sign = int >>> 31 ? -1 : 1\n  let exp = ((int >>> 23) & 0xff) - 127\n  const mantissa = ((int & 0x7fffff) + 0x800000).toString(2)\n  let float32 = 0\n  for (let i = 0; i < mantissa.length; i += 1) {\n    float32 += parseInt(mantissa[i]) ? Math.pow(2, exp) : 0\n    exp--\n  }\n  return float32 * sign\n}\n// function get_int16_t(buffer: number[]) {\n//   const raw = get_uint16_t(buffer)\n//   if (raw & (1 << 15)) {\n//     // negative\n//     return -(~raw + (1 << 16) + 1)\n//   }\n//   return raw\n// }\nexport default function parseSerial(data: number[]) {\n  const myData: Data = {\n    data,\n    i: 0\n  }\n  // input\n  const triggerVoltage = get_uint8_t(myData)\n  const triggerDir = get_uint8_t(myData)\n  const secPerSample = get_float32_t(myData)\n  const triggerPos = get_uint16_t(myData)\n  const amplifier = get_uint8_t(myData)\n  const triggerMode = get_uint8_t(myData)\n  const triggerChannel = get_uint8_t(myData)\n  const isChannelOn = get_uint8_t(myData)\n  // input output\n  // output\n  const needData = get_bool(myData)\n  const forceUIUpdate = get_bool(myData)\n  const didTrigger = get_bool(myData)\n  const freeMemory = get_uint16_t(myData)\n  const sentSamples = get_uint16_t(myData)\n  const samplesPerBuffer = get_uint16_t(myData)\n  const analogs = [\n    isChannelOn & 0b1 ? pull(myData, sentSamples) : [],\n    isChannelOn & 0b10 ? pull(myData, sentSamples) : []\n  ]\n  const digitalBytes = isChannelOn & 0b11111100 ? pull(myData, sentSamples) : []\n  const digitals = [0b000100, 0b001000, 0b010000, 0b100000].map((mask) => {\n    if (isChannelOn & mask) {\n      return digitalBytes.map((byte) => byte & mask && 1)\n    }\n    return []\n  })\n  const vMax = voltageRanges[amplifier]\n  const buffers = [\n    ...analogs.map((analog) => analog.map((n) => (n / 256) * vMax)),\n    ...digitals.map((digital, i) =>\n      digital.map((bit) => (bit * vMax) / 8 + ((i + 0.25) * vMax) / 4)\n    )\n  ].map((channel) => channel.map((v, i) => ({ v, t: (i + 1) * secPerSample })))\n\n  return {\n    //input\n    triggerVoltage,\n    triggerDir,\n    secPerSample,\n    triggerPos,\n    amplifier,\n    triggerMode,\n    triggerChannel,\n    isChannelOn,\n    // output\n    needData,\n    forceUIUpdate,\n    didTrigger,\n    freeMemory,\n    samplesPerBuffer,\n    buffers\n  }\n}\n","// based in wonky  https://github.com/yaakov-h/uniden-web-controller/blob/master/serial.js\n\nexport type Port = {\n  readable: ReadableStream\n  writable: WritableStream\n  open: (options: SerialOptions) => Promise<void>\n  close: () => Promise<void>\n  getInfo: () => { usbProductId: number; usbVendorId: number }\n}\nexport type NavigatorSerial = {\n  requestPort: (optn: unknown) => Port\n  getPorts: () => Promise<Port[]>\n}\nexport type SerialOptions = {\n  baudRate?: number\n  dataBits?: number\n  stopBits?: number\n  parity?: string\n  bufferSize?: number\n  rtscts?: boolean\n  xon?: boolean\n  xoff?: boolean\n  xany?: boolean\n}\ndeclare global {\n  interface Window {\n    serial: Serial\n  }\n  interface Navigator {\n    serial: NavigatorSerial\n  }\n}\nconst END_SEQUENCE = [0, 1, 255, 253]\nconst indexesOfSequence = (needle: number[], haystack: number[]) => {\n  const strNeedle = needle.map((c) => String.fromCharCode(c)).join('')\n  const strHaystack = haystack.map((c) => String.fromCharCode(c)).join('')\n  const start = strHaystack.indexOf(strNeedle)\n  const end = strHaystack.indexOf(strNeedle, start + strNeedle.length)\n  return [start, end]\n}\n\nconst sleep = (ms: number) => new Promise((r) => setTimeout(r, ms))\n\nexport class Serial {\n  reader?: ReadableStreamDefaultReader\n  writer?: WritableStreamDefaultWriter\n  port?: Port\n  readbuffer: number[] = []\n  outputDone?: Promise<void>\n  async close() {\n    console.log('closing')\n    if (this.reader) {\n      const reader = this.reader\n      this.reader = undefined\n      await reader.cancel()\n    }\n    if (this.writer) {\n      const writer = this.writer\n      this.writer = undefined\n      await writer.close()\n    }\n    if (this.outputDone) {\n      const outputDone = this.outputDone\n      this.outputDone = undefined\n      await outputDone\n    }\n    if (this.port) {\n      const port = this.port\n      this.port = undefined\n      await port.close()\n    }\n    console.log('closed')\n  }\n  async connectWithPaired(options: SerialOptions) {\n    const filter = JSON.parse(localStorage.serialFilter)\n    const ports = await navigator.serial.getPorts()\n    const [port] = ports.filter(\n      (port) => JSON.stringify(filter) === JSON.stringify(port.getInfo())\n    )\n    console.log(ports, port)\n    if (!port) throw new Error('no paired')\n    return this._connect(options, port)\n  }\n  async connect(options: SerialOptions) {\n    const port = await navigator.serial.requestPort({})\n    return this._connect(options, port)\n  }\n  async _connect(options: SerialOptions, port: Port) {\n    options = {\n      baudRate: 9600,\n      dataBits: 8,\n      stopBits: 1,\n      parity: 'none',\n      bufferSize: 255,\n      rtscts: false,\n      xon: false,\n      xoff: false,\n      ...options\n    }\n    if (this.port) await this.close()\n    this.port = port\n\n    await this.port.open(options)\n    const serialFilter = port.getInfo()\n    localStorage.serialFilter = JSON.stringify(serialFilter)\n    this.readbuffer = []\n    this.reader = this.port.readable.getReader()\n    // this.writer = this.port.writable.getWriter() // binary\n    const encoder = new TextEncoderStream()\n    this.outputDone = encoder.readable.pipeTo(this.port.writable)\n    const textOutputStream = encoder.writable\n    this.writer = textOutputStream.getWriter()\n    return serialFilter\n  }\n\n  write = async (text: string) => {\n    if (!this.writer) return\n    await this.writer.write(text)\n  }\n  onData(callback: (data: number[]) => unknown) {\n    const consume = () => {\n      let busy = true\n      while (busy) {\n        const [start, end] = indexesOfSequence(END_SEQUENCE, this.readbuffer)\n        if (start > -1 && end > -1) {\n          const dataFrame = this.readbuffer.slice(\n            start + END_SEQUENCE.length,\n            end\n          )\n          this.readbuffer = this.readbuffer.slice(end)\n          const checksumShould = (dataFrame.pop()! << 8) + dataFrame.pop()!\n          const checksumIs =\n            dataFrame.reduce((prev, curr) => prev + curr, 0) % Math.pow(2, 16)\n          if (checksumShould === checksumIs) {\n            callback(dataFrame)\n          } else {\n            console.error(`Checksum error: ${checksumIs}${checksumShould}`)\n            // callback(dataFrame)\n          }\n        } else {\n          busy = false\n        }\n      }\n    }\n    let running = true\n    const produce = async () => {\n      while (running) {\n        await sleep(16)\n        if (!this.reader) continue\n        const { value } = await this.reader.read()\n        if (value !== undefined) {\n          this.readbuffer.push(...value)\n          consume()\n        }\n      }\n    }\n\n    produce()\n    // consume()\n    return () => {\n      running = false\n    }\n  }\n}\nconst serial = new Serial()\n\nexport default serial\n\nwindow.serial = serial\nwindow.addEventListener('beforeunload', () => serial.close())\n","import { atom, selector, DefaultValue, RecoilState, RecoilValue } from 'recoil'\nimport serial from './Serial'\n\nexport function memoSelector<T>(theAtom: RecoilState<T>) {\n  return selector<T>({\n    key: 'memo' + theAtom.key,\n    get: ({ get }) => get(theAtom),\n    set: ({ set, get }, newValue) => {\n      const old = get(theAtom)\n      if (old !== newValue) {\n        set(theAtom, newValue)\n      }\n    }\n  })\n}\ntype GetRecoilValue = <T>(recoilVal: RecoilValue<T>) => T\nexport function makeIntercom<T>({\n  key,\n  ui2mcu,\n  mcu2ui,\n  default: defaultValue\n}: {\n  key: string\n  ui2mcu: (v: T, get: GetRecoilValue | null) => number\n  mcu2ui: (v: number, get: GetRecoilValue | null) => T\n  default: T\n}) {\n  const remoteState = memoSelector(\n    atom<number>({\n      key,\n      default: ui2mcu(defaultValue, null)\n    })\n  )\n\n  // throttle to avoid filling the MCU serial buffer\n  const serial_write = serial.write\n  // const serial_write = throttle(serial.write, 40, {\n  //   leading: false,\n  //   trailing: true\n  // })\n  const send = selector<T>({\n    key: key + '-selector',\n    get: ({ get }) => mcu2ui(get(remoteState), get),\n    set: ({ set, get, reset }, newValue) => {\n      if (newValue instanceof DefaultValue) return reset(remoteState)\n      set(remoteState, ui2mcu(newValue, get))\n      serial_write(key + ui2mcu(newValue, get) + '>')\n    }\n  })\n  const receive = selector<number>({\n    key: key + '-receive-selector',\n    get: () => {\n      throw new Error('cant get here')\n    },\n    set: ({ set }, newValue) => {\n      if (newValue instanceof DefaultValue) throw new Error('no reset allowed')\n      set(remoteState, newValue)\n    }\n  })\n\n  return { send, receive }\n}\n","import ft from 'fourier-transform'\nimport { PlotDatum } from '../communication/bindings'\n\nconst average = (arr: number[]) =>\n  arr.reduce((acc, n) => acc + n, 0) / arr.length\nexport function getFFT(data: PlotDatum[]) {\n  let signal = data.map(({ v }) => v)\n  if (signal.length === 0) return []\n  if (signal.length < 2) {\n    console.log('fix me')\n    return []\n  }\n  const length = data.length\n  const dt = data[length - 1].t - data[length - 2].t\n\n  const mid = average(signal)\n  signal = signal.map((v) => v - mid)\n  // const nextPowerOf2 = Math.ceil(Math.log2(signal.length))\n  const nextPowerOf2 = Math.ceil(Math.log2(512))\n  const padding = Math.pow(2, nextPowerOf2) - signal.length\n  let paddedSignal = signal\n  if (padding > 0) {\n    paddedSignal = [...signal, ...Array(padding).fill(0)]\n  }\n  if (padding < 0) {\n    paddedSignal = signal.slice(0, 512)\n  }\n  const fft = ft(paddedSignal)\n  // https://www.dsprelated.com/showthread/comp.dsp/87526-1.php\n  const normalized = fft.map((v) => (512 * v) / signal.length)\n  // const normalized = fft.map((v) => v * 2)\n  return normalized.map((v, i) => ({ v, t: dt * i }))\n}\n\nexport function getFrequencyCount(data: PlotDatum[]) {\n  if (data.length < 2) return 0\n  const signal = data.map(({ v }) => v)\n  const max = Math.max(...signal)\n  const min = Math.min(...signal)\n\n  const lowThird = (max + min * 2) / 3\n  const mid = (max + min) / 2\n  let firstCross = -1\n  let lastCross = 0\n  let count = 0\n  let locked = true\n  for (let i = 1; i < data.length; i++) {\n    if (data[i].v < lowThird) locked = false\n    const risingCross = !locked && data[i - 1].v < mid && data[i].v >= mid\n    if (risingCross) {\n      locked = true\n      count++\n      if (firstCross < 0) firstCross = data[i].t\n      lastCross = data[i].t\n    }\n  }\n  const result = (count - 1) / (lastCross - firstCross)\n  if (count > 1 && Number.isFinite(result)) return result\n  return Number.NaN\n}\n\nexport function oversample(\n  factor: number,\n  newBuffer: PlotDatum[],\n  oldBuffer: PlotDatum[]\n) {\n  return newBuffer.map(({ v, t }, j) => ({\n    t,\n    v: (oldBuffer[j]?.v || 0) * factor + v * (1 - factor)\n  }))\n}\n","export default window as any\n","import { atom, selector, DefaultValue } from 'recoil'\nimport parseSerial from './parseSerial'\nimport { makeIntercom, memoSelector } from './bindingsHelper'\nimport { getFFT, getFrequencyCount, oversample } from '../dsp/spectrum'\nimport win from '../win'\n\nexport const useTriggerVoltage = makeIntercom<number>({\n  key: 'V',\n  ui2mcu: (v, get) => {\n    const [vmin, , vpp] = get ? get(voltageRangeState) : [0, 5, 5]\n    return Math.ceil(((v + vmin) / vpp) * 255)\n  },\n  mcu2ui: (n, get) => {\n    const [vmin, , vpp] = get ? get(voltageRangeState) : [0, 5, 5]\n    return (n / 255) * vpp + vmin\n  },\n  default: 1\n})\n\nexport const use50percentTriggerVoltage = selector({\n  key: '50% trigger voltage',\n  get: () => false,\n  set: ({ set, get }) => {\n    const { vavr } = get(voltagesState)\n    set(useTriggerVoltage.send, vavr)\n  }\n})\n\nexport const useTriggerPos = makeIntercom<number>({\n  key: 'P',\n  ui2mcu: (v, get) => {\n    const samples = get ? get(useSamplesPerBuffer.send) : 512\n    const result = v * samples\n    if (result < 0) return 0\n    if (result > samples - 1) return samples - 1\n    return result\n  },\n  mcu2ui: (v, get) => {\n    const samples = get ? get(useSamplesPerBuffer.send) : 512\n    return v / samples\n  },\n  default: 0.5\n})\nexport const useSecPerSample = makeIntercom<number>({\n  key: 'C',\n  ui2mcu: (v) => v,\n  mcu2ui: (v) => v,\n  default: 0.00000275\n})\nexport const requestData = makeIntercom<number>({\n  key: 'R',\n  ui2mcu: (v) => v,\n  mcu2ui: (v) => v,\n  default: 0\n})\nexport enum TriggerDirection {\n  FALLING = 'Falling',\n  RISING = 'Rising'\n}\nexport const useTriggerDirection = makeIntercom<TriggerDirection>({\n  key: 'D',\n  ui2mcu: (v) => (v === TriggerDirection.RISING ? 0 : 1),\n  mcu2ui: (v) => (v ? TriggerDirection.FALLING : TriggerDirection.RISING),\n  default: TriggerDirection.FALLING\n})\nexport const useTriggerChannel = makeIntercom<number>({\n  key: 'T',\n  ui2mcu: (v) => v,\n  mcu2ui: (v) => v,\n  default: 0\n})\nexport const useIsChannelOn = makeIntercom<boolean[]>({\n  key: 'B',\n  ui2mcu: (v) => {\n    const result = v\n      .map((b) => (b ? 1 : 0) as number)\n      .reduce((acc, n, i) => acc + (n << i), 0)\n    return result\n  },\n  mcu2ui: (v) => {\n    const result = Array(8)\n      .fill(0)\n      .map((_, i) => Boolean(v & (1 << i)))\n    return result\n  },\n  default: [true, false, false, false, false, false]\n})\n\nexport const constrain = (v: number, min: number, max: number) =>\n  v < min ? min : v > max ? max : v\nexport const voltageRanges = [\n  25,\n  6.25,\n  5,\n  3.125,\n  1.5625,\n  0.78125,\n  0.78125,\n  0.625,\n  0.390625,\n  0.3125,\n  0.1953125,\n  0.15625\n]\nexport const useAmplifier = makeIntercom<number>({\n  key: 'A',\n  ui2mcu: (v) => constrain(v, 0, voltageRanges.length - 1),\n  mcu2ui: (v) => v,\n  default: 1 //TODO: use volt range or per division\n})\nexport const useSamplesPerBuffer = makeIntercom<number>({\n  key: 'S',\n  ui2mcu: (v) => v,\n  mcu2ui: (v) => v,\n  default: 512 // TODO: this shouldn't be a setter\n})\nexport enum TriggerMode {\n  AUTO = 'Auto',\n  NORMAL = 'Normal',\n  SINGLE = 'Single',\n  SLOW = 'Slow'\n}\n\nexport const useTriggerMode = makeIntercom<TriggerMode>({\n  key: 'M',\n  ui2mcu: (v) => Object.values(TriggerMode).indexOf(v),\n  mcu2ui: (v) => Object.values(TriggerMode)[v],\n  default: TriggerMode.AUTO\n})\n\nexport type PlotDatum = { t: number; v: number }\nexport const dataState = atom({\n  key: 'data',\n  default: [...new Array(8)].map(() => [] as PlotDatum[])\n})\n\nexport const isRunningState = memoSelector(\n  atom({\n    key: 'is-running',\n    default: true\n  })\n)\nexport const oversamplingFactorState = memoSelector(\n  atom({\n    key: 'oversampling-factor',\n    default: 0\n  })\n)\nexport const XYModeState = atom({\n  key: 'xy-mode',\n  default: false\n})\nexport const fftState0 = atom({\n  key: 'fft0',\n  default: false\n})\nexport const fftState1 = atom({\n  key: 'fft1',\n  default: false\n})\n\nexport const didTriggerState = memoSelector(\n  atom({\n    key: 'did-trigger',\n    default: false\n  })\n)\nexport const freeMemoryState = memoSelector(\n  atom({\n    key: 'free-memory',\n    default: 0\n  })\n)\nexport const frequencyState = selector({\n  key: 'frequency',\n  get: ({ get }) => getFrequencyCount(get(dataState)[0])\n})\n\nconst sum = (signal: number[]) =>\n  signal.reduce((previous, current) => previous + current, 0)\nexport const voltagesState = selector({\n  key: 'voltages',\n  get: ({ get }) => {\n    const signal = get(dataState)[0].map(({ v }) => v)\n    const vmax = Math.max(...signal)\n    const vmin = Math.min(...signal)\n    const vpp = vmax - vmin\n    const vavr = sum(signal) / signal.length\n\n    return {\n      vavr,\n      vpp,\n      vmin,\n      vmax\n    }\n  }\n})\n\nexport const voltageRangeState = selector({\n  key: 'voltage-range',\n  get: ({ get }) => {\n    //https://docs.google.com/spreadsheets/d/1urWB28qDmB_LL_khdBBfB-djku5h4lSx-Cw9l7Rz1u8/edit?usp=sharing\n    // TODO: do this in another way\n    // TODO: account for the last fifth of the ADC, which is not usable\n    const vmax = voltageRanges[get(useAmplifier.send)]\n    const vmin = 0\n    return [vmin, vmax, vmax - vmin]\n  }\n})\n\nconst sendFullState = selector<null>({\n  key: 'sendFullState-this shouldnt be a selector',\n  get: () => null,\n  set: ({ get, set }) => {\n    set(useTriggerPos.send, get(useTriggerPos.send))\n    set(useSecPerSample.send, get(useSecPerSample.send))\n    set(useSamplesPerBuffer.send, get(useSamplesPerBuffer.send))\n    set(useAmplifier.send, get(useAmplifier.send))\n    set(useTriggerVoltage.send, get(useTriggerVoltage.send))\n    set(useTriggerDirection.send, get(useTriggerDirection.send))\n    set(useTriggerChannel.send, get(useTriggerChannel.send))\n    set(useTriggerMode.send, get(useTriggerMode.send))\n    set(useIsChannelOn.send, get(useIsChannelOn.send))\n  }\n})\n\ntype Data = ReturnType<typeof parseSerial>\nconst receiveFullState = selector<Data>({\n  key: 'receiveFullState-this shouldnt be a selector',\n  get: () => {\n    throw new Error('write only selector')\n  },\n  set: ({ set }, data) => {\n    if (data instanceof DefaultValue) return\n    set(useTriggerPos.receive, data.triggerPos)\n    set(useSecPerSample.receive, data.secPerSample)\n    set(useSamplesPerBuffer.receive, data.samplesPerBuffer)\n    set(useAmplifier.receive, data.amplifier)\n    set(useTriggerVoltage.receive, data.triggerVoltage)\n    set(useTriggerDirection.receive, data.triggerDir)\n    set(useTriggerChannel.receive, data.triggerChannel)\n    set(useTriggerMode.receive, data.triggerMode)\n    set(useIsChannelOn.receive, data.isChannelOn)\n  }\n})\n\nexport const allDataState = selector<number[]>({\n  key: 'all-data-this shouldnt be a selector',\n  get: () => [], // this is a write only selector\n  set: ({ set, get }, newData) => {\n    win.$recoilDebugStates = [] // TODO: fix memory leak in recoiljs beta\n    if (newData instanceof DefaultValue) return\n    if (newData.length === 0) return\n    const data = parseSerial(newData)\n    if (data.needData) set(sendFullState, null)\n    if (data.forceUIUpdate) set(receiveFullState, data)\n\n    let buffers = data.buffers\n\n    set(freeMemoryState, data.freeMemory)\n    set(didTriggerState, !!data.didTrigger)\n    const shouldUpdate =\n      // todo use isRunning state in board for this\n      get(isRunningState) && buffers.some((buffer) => buffer.length > 0)\n    if (shouldUpdate) {\n      const oldBuffers = get(dataState)\n\n      const oversamplingFactor = get(oversamplingFactorState)\n      if (oversamplingFactor > 0) {\n        const factor = 1 - 2 / (oversamplingFactor + 1)\n        buffers = buffers.map((b, i) =>\n          oversample(factor, buffers[i], oldBuffers[i])\n        )\n      }\n\n      if (get(useTriggerMode.send) === TriggerMode.SLOW) {\n        const oldLastT = Math.max(\n          ...oldBuffers.map((b) => b[b.length - 1]?.t || 0)\n        )\n\n        buffers = buffers.map((b, i) => [\n          ...oldBuffers[i],\n          ...b.map(({ v, t }) => ({ v, t: t + oldLastT }))\n        ])\n        const totalSecs =\n          get(useSecPerSample.send) * get(useSamplesPerBuffer.send)\n        const lastT = Math.max(...buffers.map((b) => b[b.length - 1]?.t || 0))\n        if (lastT > totalSecs) {\n          buffers = buffers.map(() => [])\n        }\n      }\n      const withFFT = [\n        ...buffers,\n        get(fftState0) ? getFFT(buffers[0]) : [],\n        get(fftState1) ? getFFT(buffers[1]) : []\n      ]\n\n      set(dataState, withFFT)\n      if (get(useTriggerMode.send) === TriggerMode.SINGLE) {\n        set(isRunningState, false)\n      }\n    }\n  }\n})\n","import * as d3 from 'd3'\n\nimport {\n  useSecPerSample,\n  dataState,\n  useSamplesPerBuffer,\n  voltageRangeState\n} from '../../communication/bindings'\nimport { selector, atom } from 'recoil'\nimport { memoSelector } from '../../communication/bindingsHelper'\nexport const margin = { top: 20, right: 50, bottom: 30, left: 50 }\n\nexport const xDomainSelector = selector({\n  key: 'xDomain',\n  get: ({ get }) => {\n    const xMax = get(useSecPerSample.send) * get(useSamplesPerBuffer.send)\n    return [0, xMax] as [number, number]\n  }\n})\nexport const yDomainSelector = voltageRangeState\n\nexport const plotWidthSelector = memoSelector(\n  atom({\n    key: 'plot-width',\n    default: 0\n  })\n)\nexport const plotHeightSelector = memoSelector(\n  atom({\n    key: 'plot-height',\n    default: 0\n  })\n)\nexport const xScaleSelector = selector({\n  key: 'xScale',\n  get: ({ get }) => {\n    const xDomain = get(xDomainSelector)\n    const width = get(plotWidthSelector)\n    return d3\n      .scaleLinear()\n      .domain(xDomain)\n      .range([margin.left, width - margin.right])\n  }\n})\nexport const yScaleSelector = selector({\n  key: 'yScale',\n  get: ({ get }) => {\n    const yDomain = get(yDomainSelector)\n    const height = get(plotHeightSelector)\n    return d3\n      .scaleLinear()\n      .domain(yDomain)\n      .rangeRound([height - margin.bottom, margin.top])\n  }\n})\nexport const lineSelector = selector({\n  key: 'line',\n  get: ({ get }) => {\n    const xScale = get(xScaleSelector)\n    const yScale = get(yScaleSelector)\n\n    return d3\n      .line<{ v: number; t: number }>()\n      .x(({ t }) => xScale(t)!)\n      .y(({ v }) => yScale(v)!)\n  }\n})\nexport const XYLineSelector = selector({\n  key: 'xy-line',\n  get: ({ get }) => {\n    const yScale = get(yScaleSelector)\n    const xScale = get(xScaleSelector)\n    const [, xMax] = get(xDomainSelector)\n    const [, yMax] = get(yDomainSelector)\n\n    return d3\n      .line<[number, number]>()\n      .x((d) => xScale((d[1] / yMax) * xMax)!)\n      .y((d) => yScale(-d[0])!)\n  }\n})\nexport const plotDataSelector = selector({\n  key: 'plot-data',\n  get: ({ get }) => {\n    const data = get(dataState)\n    const line = get(lineSelector)\n    return data.map((data) => line(data) || undefined)\n  }\n})\n","import React, {\n  forwardRef,\n  MouseEventHandler,\n  useImperativeHandle,\n  useState\n} from 'react'\n\nimport { useTriggerVoltage } from '../../communication/bindings'\nimport { useRecoilState, useRecoilValue } from 'recoil'\nimport { margin, plotWidthSelector, yScaleSelector } from './hooks'\n\nexport type TriggerVoltageRef = {\n  onMouseUp: MouseEventHandler\n  onMouseMove: MouseEventHandler\n}\n\nconst TriggerVoltageHandle = forwardRef<TriggerVoltageRef>((_props, ref) => {\n  const [draggingTV, setDraggingTV] = useState(false)\n  const yScale = useRecoilValue(yScaleSelector)\n  const width = useRecoilValue(plotWidthSelector)\n  const [triggerVoltage, setTriggerVoltage] = useRecoilState(\n    useTriggerVoltage.send\n  )\n  useImperativeHandle(ref, () => ({\n    onMouseUp() {\n      setDraggingTV(false)\n    },\n    onMouseMove(e) {\n      if (draggingTV) {\n        setTriggerVoltage(yScale.invert(e.nativeEvent.offsetY))\n      }\n    }\n  }))\n  const scaledY = yScale(triggerVoltage)\n  return (\n    <>\n      <line\n        className=\"triggerVoltage\"\n        x1={margin.left}\n        x2={width - margin.right}\n        y1={scaledY}\n        y2={scaledY}\n      ></line>\n      <line\n        className=\"triggerVoltageHandle\"\n        onMouseDown={(e) => {\n          e.preventDefault()\n          e.stopPropagation()\n          setDraggingTV(true)\n        }}\n        x1={margin.left}\n        x2={width - margin.right}\n        y1={scaledY}\n        y2={scaledY}\n      ></line>\n      <text\n        fill=\"currentColor\"\n        y={scaledY}\n        x={width - margin.right}\n        dy=\".32em\"\n        dx=\"10\"\n      >\n        {triggerVoltage.toFixed(2)}v\n      </text>\n    </>\n  )\n})\n\nTriggerVoltageHandle.displayName = 'TriggerVoltageHandle'\n\nexport default TriggerVoltageHandle\n","import React, {\n  forwardRef,\n  MouseEventHandler,\n  useImperativeHandle,\n  useState\n} from 'react'\n\nimport { useRecoilState, useRecoilValue } from 'recoil'\nimport { useTriggerPos } from '../../communication/bindings'\nimport {\n  margin,\n  plotHeightSelector,\n  xDomainSelector,\n  xScaleSelector\n} from './hooks'\n\nexport type TriggerPosRef = {\n  onMouseUp: MouseEventHandler\n  onMouseMove: MouseEventHandler\n}\n\nconst TriggerPosHandle = forwardRef<TriggerPosRef>((_props, ref) => {\n  const [draggingTP, setDraggingTP] = useState(false)\n  const xScale = useRecoilValue(xScaleSelector)\n  const height = useRecoilValue(plotHeightSelector)\n  const [triggerPos, setTriggerPos] = useRecoilState(useTriggerPos.send)\n\n  const xDomain = useRecoilValue(xDomainSelector)\n  useImperativeHandle(ref, () => ({\n    onMouseUp() {\n      setDraggingTP(false)\n    },\n    onMouseMove(e) {\n      if (draggingTP) {\n        setTriggerPos(xScale.invert(e.nativeEvent.offsetX) / xDomain[1])\n      }\n    }\n  }))\n  const scaledX = xScale(triggerPos * xDomain[1])\n\n  return (\n    <>\n      <line\n        className=\"triggerPos\"\n        x1={scaledX}\n        x2={scaledX}\n        y1={height - margin.bottom}\n        y2={margin.top}\n      ></line>\n      <line\n        className=\"triggerPosHandle\"\n        onMouseDown={(e) => {\n          e.preventDefault()\n          e.stopPropagation()\n          setDraggingTP(true)\n        }}\n        x1={scaledX}\n        x2={scaledX}\n        y1={height - margin.bottom}\n        y2={margin.top}\n      ></line>\n      <text fill=\"currentColor\" x={scaledX} dx=\"-1em\" dy=\"1em\">\n        {Math.round(triggerPos * 100)}%\n      </text>\n    </>\n  )\n})\n\nTriggerPosHandle.displayName = 'TriggerPosHandle'\nexport default TriggerPosHandle\n","const toFixed = (float: number, digits = 0) => {\n  const padding = Math.pow(10, digits)\n  return (Math.round(float * padding) / padding).toFixed(digits)\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype ohNoItIsAny = any\n\nexport function formatTime(s: ohNoItIsAny) {\n  s = Number(s)\n  if (!Number.isFinite(s)) return '--'\n\n  const m = s / 60\n  const h = s / 60 / 60\n  const ms = s * 1000\n  const us = ms * 1000\n  if (us < 1000) return toFixed(us, 0) + 's'\n  if (ms < 10) return toFixed(ms, 2) + 'ms'\n  if (ms < 1000) return toFixed(ms) + 'ms'\n  if (s < 10) return toFixed(s, 1) + 's'\n  if (h > 1) return toFixed(h, 0) + 'h' + toFixed(m % 60, 1) + 'm'\n  if (m > 5) return toFixed(m, 0) + 'm' + toFixed(s % 60, 1) + 's'\n  return toFixed(s, 0) + 's'\n}\n\nexport function formatFreq(hz: number) {\n  if (!Number.isFinite(hz)) return '--'\n\n  const khz = hz / 1000\n  if (hz < 1000) return toFixed(hz) + 'Hz'\n  if (khz < 10) return toFixed(khz, 2) + 'KHz'\n  return toFixed(khz) + 'KHz'\n}\nexport function formatVoltage(v: number): string {\n  if (!Number.isFinite(v)) return '--'\n\n  if (v < 0) return '-' + formatVoltage(-v)\n  const mv = v * 1000\n  const uv = mv * 1000\n  if (uv < 10) return toFixed(uv, 2) + 'v'\n  if (uv < 50) return toFixed(uv, 1) + 'v'\n  if (uv < 1000) return toFixed(uv, 0) + 'v'\n  if (mv < 10) return toFixed(mv, 2) + 'mv'\n  if (mv < 50) return toFixed(mv, 1) + 'mv'\n  if (mv < 1000) return toFixed(mv, 0) + 'mv'\n  return toFixed(v, 2) + 'v'\n}\n","import * as d3 from 'd3'\nimport React, { useRef, useLayoutEffect } from 'react'\n\nimport { useRecoilValue } from 'recoil'\nimport { margin, plotHeightSelector, xScaleSelector } from './hooks'\nimport { formatTime } from '../formatters'\n\nexport default function XAxis() {\n  const nodeRef = useRef<SVGSVGElement>(null)\n  const height = useRecoilValue(plotHeightSelector)\n  const xScale = useRecoilValue(xScaleSelector)\n  const gEl = nodeRef.current\n  useLayoutEffect(() => {\n    if (!gEl) return\n    const xTicks = d3.ticks(xScale.domain()[0], xScale.domain()[1], 10)\n    d3.select(gEl).call((g) =>\n      g\n        .attr('transform', `translate(0,${height - margin.bottom})`)\n        .call(\n          d3\n            .axisBottom(xScale)\n            .tickValues(xTicks)\n            .tickPadding(10)\n            .tickSize(-height + margin.top + margin.bottom)\n            .tickFormat(formatTime)\n            .tickSizeOuter(0)\n        )\n        .call((g) => g.select('.domain').remove())\n    )\n  }, [gEl, xScale, height])\n\n  return <g className=\"x axis\" ref={nodeRef} />\n}\n","import * as d3 from 'd3'\nimport React, { useRef, useLayoutEffect } from 'react'\n\nimport { useRecoilValue } from 'recoil'\nimport { margin, plotWidthSelector, yScaleSelector } from './hooks'\n\nexport default function YAxis() {\n  const nodeRef = useRef<SVGSVGElement>(null)\n  const width = useRecoilValue(plotWidthSelector)\n  const yScale = useRecoilValue(yScaleSelector)\n  const gEl = nodeRef.current\n\n  useLayoutEffect(() => {\n    if (!gEl) return\n    const yTicks = d3.ticks(yScale.domain()[0], yScale.domain()[1], 10)\n    d3.select(gEl)\n      .call((g) =>\n        g.attr('transform', `translate(${margin.left},0)`).call(\n          d3\n            .axisLeft(yScale)\n            .tickValues(yTicks)\n            .tickPadding(10)\n            .tickSize(-width + margin.right + margin.left - 1)\n            .tickFormat((v) => v + 'v')\n        )\n      )\n      .call((g) =>\n        g.select('.domain').attr(\n          'd',\n          (_d, _, path) =>\n            // close path so the domain has a right border\n            d3.select(path[0]).attr('d') + 'z'\n        )\n      )\n  }, [gEl, yScale, width])\n\n  return <g className=\"y axis\" ref={nodeRef} />\n}\n","import { isEqual } from 'lodash'\nimport React, {\n  forwardRef,\n  MouseEventHandler,\n  useImperativeHandle,\n  useState\n} from 'react'\n\nimport { useRecoilValue } from 'recoil'\nimport { formatTime, formatVoltage } from '../formatters'\nimport { xScaleSelector, yScaleSelector } from './hooks'\n\nexport type MeasureRef = {\n  onMouseDown: MouseEventHandler\n  onMouseUp: MouseEventHandler\n  onMouseMove: MouseEventHandler\n}\n\nconst Measure = forwardRef<MeasureRef>((_props, ref) => {\n  const [dragging, setDragging] = useState(false)\n  const xScale = useRecoilValue(xScaleSelector)\n  const yScale = useRecoilValue(yScaleSelector)\n  const [startPos, setStartPos] = useState({ x: -1, y: -1 })\n  const [endPos, setEndPos] = useState({ x: -1, y: -1 })\n  useImperativeHandle(ref, () => ({\n    onMouseDown(e) {\n      setStartPos({\n        x: xScale.invert(e.nativeEvent.offsetX),\n        y: yScale.invert(e.nativeEvent.offsetY)\n      })\n      setEndPos({\n        x: xScale.invert(e.nativeEvent.offsetX),\n        y: yScale.invert(e.nativeEvent.offsetY)\n      })\n      setDragging(true)\n    },\n    onMouseUp(e) {\n      if (dragging) {\n        setEndPos({\n          x: xScale.invert(e.nativeEvent.offsetX),\n          y: yScale.invert(e.nativeEvent.offsetY)\n        })\n        setDragging(false)\n      }\n    },\n    onMouseMove(e) {\n      if (dragging) {\n        setEndPos({\n          x: xScale.invert(e.nativeEvent.offsetX),\n          y: yScale.invert(e.nativeEvent.offsetY)\n        })\n      }\n    }\n  }))\n  if (isEqual(startPos, endPos)) return <></>\n  return (\n    <g className=\"Measure\">\n      <line\n        className=\"measureCap\"\n        x1={xScale(startPos.x)! - 5}\n        x2={xScale(startPos.x)! + 5}\n        y1={yScale(startPos.y)! - 5}\n        y2={yScale(startPos.y)! + 5}\n      ></line>\n      <line\n        className=\"measureCap\"\n        x1={xScale(startPos.x)! - 5}\n        x2={xScale(startPos.x)! + 5}\n        y1={yScale(startPos.y)! + 5}\n        y2={yScale(startPos.y)! - 5}\n      ></line>\n      <line\n        className=\"measureX\"\n        x1={xScale(startPos.x)}\n        x2={xScale(endPos.x)}\n        y1={yScale(startPos.y)}\n        y2={yScale(startPos.y)}\n      ></line>\n      <text\n        fill=\"currentColor\"\n        x={xScale((startPos.x + endPos.x) / 2)}\n        y={yScale(startPos.y)}\n        dx=\"-1em\"\n        dy=\"1.5em\"\n      >\n        {formatTime(endPos.x - startPos.x)}\n      </text>\n      <line\n        className=\"measureCap\"\n        x1={xScale(endPos.x)! - 5}\n        x2={xScale(endPos.x)! + 5}\n        y1={yScale(endPos.y)! - 5}\n        y2={yScale(endPos.y)! + 5}\n      ></line>\n      <line\n        className=\"measureCap\"\n        x1={xScale(endPos.x)! - 5}\n        x2={xScale(endPos.x)! + 5}\n        y1={yScale(endPos.y)! + 5}\n        y2={yScale(endPos.y)! - 5}\n      ></line>\n      <line\n        className=\"measureY\"\n        x1={xScale(endPos.x)}\n        x2={xScale(endPos.x)}\n        y1={yScale(startPos.y)}\n        y2={yScale(endPos.y)}\n      ></line>\n      <text\n        fill=\"currentColor\"\n        x={xScale(endPos.x)}\n        y={yScale((startPos.y + endPos.y) / 2)}\n        dx=\"1em\"\n        dy=\"0\"\n      >\n        {formatVoltage(endPos.y - startPos.y)}\n      </text>\n    </g>\n  )\n})\n\nMeasure.displayName = 'Measure'\nexport default Measure\n","import React, { useEffect, useRef } from 'react'\nimport useSize from '@react-hook/size'\n\nimport {\n  dataState,\n  useIsChannelOn,\n  XYModeState\n} from '../../communication/bindings'\nimport { useRecoilValue, useSetRecoilState } from 'recoil'\nimport TriggerVoltageHandle, { TriggerVoltageRef } from './TriggerVoltageHandle'\nimport TriggerPosHandle, { TriggerPosRef } from './TriggerPosHandle'\nimport {\n  lineSelector,\n  plotHeightSelector,\n  plotWidthSelector,\n  XYLineSelector\n} from './hooks'\nimport XAxis from './XAxis'\nimport YAxis from './YAxis'\nimport Measure, { MeasureRef } from './Measure'\n\nfunction XYCurve() {\n  const xyMode = useRecoilValue(XYModeState)\n  const isChannelOn = useRecoilValue(useIsChannelOn.send)\n\n  const xyLine = useRecoilValue(XYLineSelector)\n  const data = useRecoilValue(dataState)\n  const d = data[0].map(\n    (d, i) => [-data[1][i]?.v || 0, d.v] as [number, number]\n  )\n  if (!xyMode || !isChannelOn[0] || !isChannelOn[1]) return <></>\n  return (\n    <>\n      <path className={`plot-area-xy`} d={xyLine(d) || undefined}></path>\n    </>\n  )\n}\nfunction Curves() {\n  const line = useRecoilValue(lineSelector)\n  const data = useRecoilValue(dataState)\n  const ds = data.map((data) => line(data) || undefined)\n  const analogs = ds.slice(0, 2)\n  const digitals = ds.slice(2, 6)\n  const ffts = ds.slice(6, 8)\n  return (\n    <>\n      {analogs.map((d, i) => (\n        <path key={i} className={`plot-area-a${i}`} d={d}></path>\n      ))}\n      {digitals.map((d, i) => (\n        <path key={i} className={`plot-area-d${i}`} d={d}></path>\n      ))}\n      {ffts.map((d, i) => (\n        <path key={i} className={`plot-area-fft${i}`} d={d}></path>\n      ))}\n    </>\n  )\n}\n\nexport default function Plot() {\n  const nodeRef = useRef<SVGSVGElement>(null)\n  const triggerPosRef = useRef<TriggerPosRef>(null)\n  const triggerVoltageRef = useRef<TriggerVoltageRef>(null)\n  const measureRef = useRef<MeasureRef>(null)\n  const containerRef = useRef<HTMLDivElement>(null)\n  const [width, height] = useSize(containerRef)\n  const setPlotHeight = useSetRecoilState(plotHeightSelector)\n  const setPlotWidth = useSetRecoilState(plotWidthSelector)\n  useEffect(() => {\n    setPlotHeight(height)\n    setPlotWidth(width)\n  }, [height, setPlotHeight, setPlotWidth, width])\n  return (\n    <div className=\"plotContainer\" ref={containerRef}>\n      <svg\n        className=\"plot\"\n        ref={nodeRef}\n        onMouseMove={(e) => {\n          triggerPosRef.current?.onMouseMove(e)\n          triggerVoltageRef.current?.onMouseMove(e)\n          measureRef.current?.onMouseMove(e)\n          e.preventDefault()\n        }}\n        onMouseLeave={(e) => {\n          triggerPosRef.current?.onMouseUp(e)\n          triggerVoltageRef.current?.onMouseUp(e)\n          measureRef.current?.onMouseUp(e)\n          e.preventDefault()\n        }}\n        onMouseUp={(e) => {\n          triggerPosRef.current?.onMouseUp(e)\n          triggerVoltageRef.current?.onMouseUp(e)\n          measureRef.current?.onMouseUp(e)\n          e.preventDefault()\n        }}\n        onMouseDown={(e) => {\n          measureRef.current?.onMouseDown(e)\n          e.preventDefault()\n        }}\n      >\n        <XAxis />\n        <YAxis />\n        <Curves />\n        <XYCurve />\n        <Measure ref={measureRef} />\n        <TriggerVoltageHandle ref={triggerVoltageRef} />\n        <TriggerPosHandle ref={triggerPosRef} />\n      </svg>\n    </div>\n  )\n}\n","import React from 'react'\nimport {\n  useTriggerDirection,\n  isRunningState,\n  useTriggerMode,\n  TriggerMode,\n  didTriggerState,\n  useTriggerChannel,\n  TriggerDirection,\n  requestData,\n  useSecPerSample\n} from '../../communication/bindings'\nimport {\n  Icon,\n  Panel,\n  Tag,\n  ButtonToolbar,\n  ButtonGroup,\n  Button,\n  IconButton\n} from 'rsuite'\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from 'recoil'\nimport win from '../../win'\n\nconst ButtonToolbarStyle = {\n  marginTop: 10,\n  display: 'flex',\n  justifyContent: 'space-between',\n  alignItems: 'center'\n}\n\nexport default function Trigger() {\n  const isRunning = useRecoilValue(isRunningState)\n  win.requestData = useSetRecoilState(requestData.send)\n  const [triggerMode, setTriggerMode] = useRecoilState(useTriggerMode.send)\n  const [triggerChannel, setTriggerChannel] = useRecoilState(\n    useTriggerChannel.send\n  )\n  const didTrigger = useRecoilValue(didTriggerState)\n  const [triggerDirection, setTriggerDirection] = useRecoilState(\n    useTriggerDirection.send\n  )\n  const secPerSample = useRecoilValue(useSecPerSample.send)\n  const tooFastForSlowMode = secPerSample < 0.003\n  return (\n    <Panel header=\"Trigger\" shaded collapsible defaultExpanded>\n      <ButtonToolbar style={ButtonToolbarStyle}>\n        <ButtonGroup>\n          {['A0', 'AS', 'A2', 'A3', 'A4', 'A5'].map((name, idx) => (\n            <Button\n              key={idx}\n              appearance={triggerChannel === idx ? 'primary' : 'default'}\n              disabled={\n                ['A2', 'A3'].includes(\n                  name\n                ) /* these are connected to the diff amp and generate noise */\n              }\n              size=\"sm\"\n              onClick={() => setTriggerChannel(idx)}\n            >\n              {name}\n            </Button>\n          ))}\n        </ButtonGroup>\n      </ButtonToolbar>\n      <ButtonToolbar style={ButtonToolbarStyle}>\n        <ButtonGroup>\n          {Object.values(TriggerMode).map((mode) => (\n            <Button\n              key={mode}\n              appearance={triggerMode === mode ? 'primary' : 'default'}\n              color={\n                mode === TriggerMode.SLOW && tooFastForSlowMode\n                  ? 'red'\n                  : undefined\n              }\n              size=\"sm\"\n              onClick={() => setTriggerMode(mode)}\n            >\n              {mode}\n            </Button>\n          ))}\n        </ButtonGroup>\n      </ButtonToolbar>\n      <ButtonToolbar style={ButtonToolbarStyle}>\n        <div>Direction:</div>\n        <ButtonGroup>\n          <IconButton\n            size=\"sm\"\n            appearance={\n              triggerDirection === TriggerDirection.FALLING\n                ? 'primary'\n                : 'default'\n            }\n            icon={<Icon icon=\"level-down\" />}\n            onClick={() => setTriggerDirection(TriggerDirection.FALLING)}\n          />\n          <IconButton\n            size=\"sm\"\n            appearance={\n              triggerDirection === TriggerDirection.RISING\n                ? 'primary'\n                : 'default'\n            }\n            icon={<Icon icon=\"level-up\" />}\n            onClick={() => setTriggerDirection(TriggerDirection.RISING)}\n          />\n        </ButtonGroup>\n      </ButtonToolbar>\n      <ButtonToolbar style={ButtonToolbarStyle}>\n        State:&nbsp;\n        {!isRunning ? (\n          <Tag color=\"red\">Hold</Tag>\n        ) : didTrigger ? (\n          <Tag color=\"green\">Triggered</Tag>\n        ) : (\n          <Tag color=\"yellow\">Searching</Tag>\n        )}\n      </ButtonToolbar>\n    </Panel>\n  )\n}\n","import React from 'react'\nimport {\n  useIsChannelOn,\n  oversamplingFactorState,\n  fftState0,\n  fftState1,\n  XYModeState\n} from '../../communication/bindings'\nimport { Panel, ButtonToolbar, ButtonGroup, Button, Slider } from 'rsuite'\nimport { useRecoilState } from 'recoil'\n\nconst ButtonToolbarStyle = {\n  marginTop: 10,\n  display: 'flex',\n  justifyContent: 'space-between',\n  alignItems: 'center'\n}\n\nexport default function Channels() {\n  const [oversamplingFactor, setOversamplingFactor] = useRecoilState(\n    oversamplingFactorState\n  )\n  const [xyMode, setXYMode] = useRecoilState(XYModeState)\n  const [fft0, setFFT0] = useRecoilState(fftState0)\n  const [fft1, setFFT1] = useRecoilState(fftState1)\n  const [isChannelOn, setIsChannelOn] = useRecoilState(useIsChannelOn.send)\n\n  return (\n    <Panel header=\"Channels\" shaded collapsible defaultExpanded>\n      <ButtonToolbar style={ButtonToolbarStyle}>\n        <ButtonGroup>\n          {['A0', 'AS', 'A2', 'A3', 'A4', 'A5'].map((name, i) => (\n            <Button\n              key={i}\n              appearance={isChannelOn[i] ? 'primary' : 'default'}\n              size=\"sm\"\n              disabled={\n                ['A2', 'A3'].includes(\n                  name\n                ) /* these are connected to the diff amp and generate noise */\n              }\n              onClick={() => {\n                const buffer = isChannelOn.slice()\n                buffer[i] = !buffer[i]\n                setIsChannelOn(buffer)\n              }}\n            >\n              {name}\n            </Button>\n          ))}\n        </ButtonGroup>\n      </ButtonToolbar>\n      <div style={ButtonToolbarStyle}>\n        Oversample\n        <Slider\n          style={{ width: '50%' }}\n          value={oversamplingFactor}\n          onChange={setOversamplingFactor}\n          max={30}\n          min={0}\n          step={0.1}\n        />\n      </div>\n\n      <ButtonGroup>\n        <Button\n          appearance={fft0 ? 'primary' : 'default'}\n          disabled={!isChannelOn[0]}\n          size=\"sm\"\n          onClick={() => {\n            setFFT0(!fft0)\n          }}\n        >\n          FFT A0\n        </Button>\n        <Button\n          appearance={fft1 ? 'primary' : 'default'}\n          disabled={!isChannelOn[1]}\n          size=\"sm\"\n          onClick={() => {\n            setFFT1(!fft1)\n          }}\n        >\n          FFT AS\n        </Button>\n        <Button\n          appearance={xyMode ? 'primary' : 'default'}\n          disabled={!(isChannelOn[1] && isChannelOn[0])}\n          size=\"sm\"\n          onClick={() => {\n            setXYMode(!xyMode)\n          }}\n        >\n          XY\n        </Button>\n      </ButtonGroup>\n    </Panel>\n  )\n}\n","import { useState } from 'react'\n\nexport function useActiveBtns() {\n  const [state, setState] = useState(false)\n\n  const [timeout, setTimeout] = useState(-1)\n  const activateBtn = () => {\n    setState(true)\n    clearTimeout(timeout)\n    const timeoutId = window.setTimeout(() => setState(false), 200)\n    setTimeout(timeoutId)\n  }\n  return [state, activateBtn] as [typeof state, typeof activateBtn]\n}\n","import MouseTrap from 'mousetrap'\nimport React, { useEffect } from 'react'\nimport { useAmplifier, voltageRanges } from '../../communication/bindings'\nimport { formatVoltage } from '../formatters'\nimport { Icon, IconButton, SelectPicker } from 'rsuite'\nimport { useRecoilState } from 'recoil'\nimport { useActiveBtns } from './hooks'\n\nfunction Amplifier() {\n  const [amplifier, setAmplifier] = useRecoilState(useAmplifier.send)\n  const [isUpActive, tapUp] = useActiveBtns()\n  const [isDownActive, tapDown] = useActiveBtns()\n  useEffect(() => {\n    MouseTrap.bind('up', (e) => {\n      e.preventDefault()\n      tapUp()\n      setAmplifier(amplifier - 1)\n    })\n    MouseTrap.bind('down', (e) => {\n      e.preventDefault()\n      tapDown()\n      setAmplifier(amplifier + 1)\n    })\n    return () => {\n      MouseTrap.unbind('up')\n      MouseTrap.unbind('down')\n    }\n  }, [amplifier, setAmplifier, tapDown, tapUp])\n\n  return (\n    <div\n      style={{\n        width: ' 100%',\n        display: ' flex',\n        justifyContent: ' space-between',\n        marginBottom: 5\n      }}\n    >\n      <IconButton\n        active={isDownActive}\n        size=\"md\"\n        icon={<Icon icon=\"down\" />}\n        onClick={() => setAmplifier(amplifier + 1)}\n      />\n      <SelectPicker\n        searchable={false}\n        value={amplifier}\n        cleanable={false}\n        onChange={setAmplifier}\n        data={voltageRanges.map((v, i) => {\n          return {\n            label: formatVoltage(v / 10) + ' / div',\n            value: i\n          }\n        })}\n        style={{ flex: 1, marginLeft: 5, marginRight: 5 }}\n      />\n      <IconButton\n        active={isUpActive}\n        size=\"md\"\n        icon={<Icon icon=\"up\" />}\n        onClick={() => setAmplifier(amplifier - 1)}\n      />\n    </div>\n  )\n}\n\nexport default Amplifier\n","import MouseTrap from 'mousetrap'\nimport React, { useEffect } from 'react'\nimport {\n  useSecPerSample,\n  useSamplesPerBuffer,\n  constrain\n} from '../../communication/bindings'\nimport { formatTime } from '../formatters'\nimport { Icon, IconButton, SelectPicker } from 'rsuite'\nimport { useRecoilState, useRecoilValue } from 'recoil'\nimport win from '../../win'\nimport { useActiveBtns } from './hooks'\nconst us = (n: number) => n / 1000000\nconst ms = (n: number) => n / 1000\nconst s = (n: number) => n\nconst offset = (list: { value: number }[], current: number, offset: number) => {\n  let i = list.map(({ value }) => value).indexOf(current) + offset\n  i = constrain(i, 0, list.length - 1)\n  return list[i].value\n}\nexport default function TimeScales() {\n  const [secPerSample, setSecPerSample] = useRecoilState(useSecPerSample.send)\n  const samples = useRecoilValue(useSamplesPerBuffer.send)\n  const [isLeftActive, tapLeft] = useActiveBtns()\n  const [isRightActive, tapRight] = useActiveBtns()\n\n  const perSample = [\n    us(60.8), // as fast as it goes\n    us(73.6), // matching fastest adc\n    us(100.8), // as fast as it went before\n    us(140.8), // in synch with adc clock\n    us(200),\n    us(500),\n    us(1000),\n    ms(2),\n    ms(5),\n    ms(10),\n    ms(20),\n    ms(50),\n    s(0.1),\n    s(0.2),\n    s(0.5),\n    s(1),\n    s(2),\n    s(5),\n    s(10),\n    s(20),\n    s(50),\n    s(100),\n    s(1000)\n  ].map((secPerDivision) => {\n    const secPerSample = (secPerDivision * 10) / samples\n    return {\n      label: formatTime(secPerDivision) + ' / div',\n      value: secPerSample\n    }\n  })\n  useEffect(() => {\n    MouseTrap.bind('right', (e) => {\n      e.preventDefault()\n      tapRight()\n      setSecPerSample(offset(perSample, secPerSample, 1))\n    })\n    MouseTrap.bind('left', (e) => {\n      e.preventDefault()\n      tapLeft()\n      setSecPerSample(offset(perSample, secPerSample, -1))\n    })\n    return () => {\n      MouseTrap.unbind('right')\n      MouseTrap.unbind('left')\n    }\n  }, [setSecPerSample, secPerSample, perSample, tapRight, tapLeft])\n  win.setSecPerSample = setSecPerSample\n\n  return (\n    <div\n      style={{\n        width: ' 100%',\n        display: ' flex',\n        justifyContent: ' space-between',\n        marginBottom: 5\n      }}\n    >\n      <IconButton\n        active={isLeftActive}\n        size=\"md\"\n        icon={<Icon icon=\"left\" />}\n        onClick={() => setSecPerSample(offset(perSample, secPerSample, -1))}\n      />\n      <SelectPicker\n        searchable={true}\n        value={secPerSample}\n        cleanable={false}\n        onChange={(n: number) => {\n          setSecPerSample(n)\n        }}\n        data={perSample}\n        style={{ flex: 1, marginLeft: 5, marginRight: 5 }}\n      />\n      <IconButton\n        active={isRightActive}\n        size=\"md\"\n        icon={<Icon icon=\"right\" />}\n        onClick={() => setSecPerSample(offset(perSample, secPerSample, 1))}\n      />\n    </div>\n  )\n}\n","import MouseTrap from 'mousetrap'\nimport React, { useEffect } from 'react'\nimport { isRunningState } from '../../communication/bindings'\nimport { Panel, Button } from 'rsuite'\nimport { useRecoilState } from 'recoil'\nimport Amplifier from './Amplifier'\nimport TimeScales from './TimeScales'\nimport { useActiveBtns } from './hooks'\n\nexport default function Scales() {\n  const [isRunning, setIsRunning] = useRecoilState(isRunningState)\n  const [isSpaceActive, tapSpace] = useActiveBtns()\n\n  useEffect(() => {\n    MouseTrap.bind('space', (e) => {\n      e.preventDefault()\n      tapSpace()\n      setIsRunning((isRunning) => !isRunning)\n    })\n    return () => {\n      MouseTrap.unbind('space')\n    }\n  }, [setIsRunning, tapSpace])\n\n  return (\n    <Panel header=\"Scales\" shaded collapsible defaultExpanded>\n      <Button\n        active={isSpaceActive}\n        style={{\n          color: 'white',\n          backgroundColor: isRunning ? 'green' : 'red',\n          width: '100%',\n          marginBottom: '10px'\n        }}\n        size=\"sm\"\n        onClick={() => {\n          setIsRunning(!isRunning)\n        }}\n      >\n        {(isRunning ? 'Run' : 'Hold') + ' [space]'}\n      </Button>\n      <TimeScales />\n      <Amplifier />\n    </Panel>\n  )\n}\n","import {\n  IconButton,\n  Icon,\n  ButtonToolbar,\n  Tag,\n  ButtonGroup,\n  Panel\n} from 'rsuite'\nimport React, { useEffect, useState } from 'react'\nimport { allDataState } from '../../communication/bindings'\nimport serial from '../../communication/Serial'\nimport { useSetRecoilState } from 'recoil'\nimport Uploader from './Uploader'\n\nconst serialOptions = {\n  baudRate: 115200 * 1,\n  bufferSize: 20000\n}\nconst ButtonToolbarStyle = {\n  marginTop: 10,\n  display: 'flex',\n  justifyContent: 'space-between',\n  alignItems: 'center'\n}\ntype ConnectedState = 'Connected' | 'Disconnected' | 'Connecting...' | 'Error'\n\nfunction SerialControls() {\n  const [connectedWith, setConnectedWith] = useState({})\n  const [error, setError] = useState('')\n  const [serialState, setSerialState] = useState<ConnectedState>('Disconnected')\n  const setAllData = useSetRecoilState(allDataState)\n  useEffect(() => {\n    if (serialState !== 'Error') setError('')\n  }, [serialState])\n  useEffect(() => {\n    return serial.onData((data) => {\n      setAllData(data)\n    })\n  }, [setAllData])\n  useEffect(() => {\n    setSerialState('Connecting...')\n    serial\n      .connectWithPaired(serialOptions)\n      .then(setConnectedWith)\n      .then(() => setSerialState('Connected'))\n      .catch(() => setSerialState('Disconnected'))\n  }, [])\n  return (\n    <Panel shaded header=\"Serial\">\n      <ButtonGroup style={ButtonToolbarStyle}>\n        <IconButton\n          style={{ flex: 1 }}\n          appearance={serialState === 'Connected' ? 'primary' : undefined}\n          size=\"md\"\n          onClick={async () => {\n            serial\n              .connect(serialOptions)\n              .then(setConnectedWith)\n              .then(() => setSerialState('Connected'))\n              .catch((e) => {\n                setSerialState('Error')\n                setError(e.toString())\n              })\n          }}\n          icon={<Icon icon=\"arrow-right\" style={{ width: ' 100%' }} />}\n          placement=\"right\"\n        />\n        <IconButton\n          style={{ flex: 1 }}\n          size=\"md\"\n          appearance={serialState !== 'Connected' ? 'primary' : undefined}\n          onClick={async () => {\n            serial\n              .close()\n              .then(() => setSerialState('Disconnected'))\n              .catch(() => setSerialState('Error'))\n          }}\n          icon={<Icon icon=\"stop\" style={{ width: ' 100%' }} />}\n          placement=\"right\"\n        />\n\n        <IconButton\n          style={{ flex: 1 }}\n          size=\"md\"\n          onClick={async () => {\n            setSerialState('Connecting...')\n\n            await serial\n              .connectWithPaired(serialOptions)\n              .then(setConnectedWith)\n              .catch(() => serial.connect(serialOptions).then(setConnectedWith))\n              .then(() => setSerialState('Connected'))\n              .catch(() => setSerialState('Error'))\n          }}\n          icon={<Icon icon=\"recycle\" style={{ width: ' 100%' }} />}\n          placement=\"right\"\n        />\n      </ButtonGroup>\n\n      <ButtonToolbar style={ButtonToolbarStyle}>\n        State:&nbsp;\n        {(() => {\n          const color = {\n            Connected: 'green',\n            'Connecting...': 'yellow',\n            Error: 'red',\n            Disconnected: undefined\n          }[serialState]\n\n          return (\n            <Tag color={color}>\n              {serialState} {error}\n            </Tag>\n          )\n        })()}\n      </ButtonToolbar>\n      {serialState === 'Connected' && (\n        <div style={{ fontSize: 10 }}>{JSON.stringify(connectedWith)}</div>\n      )}\n      {serialState === 'Disconnected' && <Uploader />}\n    </Panel>\n  )\n}\n\nexport default SerialControls\n","import React, { useEffect, useState } from 'react'\nimport {\n  dataState,\n  freeMemoryState,\n  frequencyState,\n  voltagesState\n} from '../../communication/bindings'\nimport { formatFreq, formatTime, formatVoltage } from '../formatters'\nimport { Panel, Tag } from 'rsuite'\nimport { useRecoilValue } from 'recoil'\n\nfunction FreeMemory() {\n  const freeMemory = useRecoilValue(freeMemoryState)\n  return <Tag>Mem: {freeMemory}bytes</Tag>\n}\nfunction FPS() {\n  const [, setLastT] = useState(0)\n  const [fps, setFps] = useState(0)\n  const data = useRecoilValue(dataState)\n  useEffect(() => {\n    setLastT((lastT) => {\n      setFps((fps) => {\n        const newFps = 1000 / (performance.now() - lastT)\n        return fps * 0.9 + newFps * 0.1\n      })\n      return performance.now()\n    })\n  }, [data])\n  return <Tag>FPS: {Math.round(fps)}</Tag>\n}\n\nfunction Frequency() {\n  const frequency = useRecoilValue(frequencyState)\n  return <Tag>Freq: {formatFreq(frequency)}</Tag>\n}\nfunction Wavelength() {\n  const frequency = useRecoilValue(frequencyState)\n  return <Tag>WLength: {formatTime(1 / frequency)}</Tag>\n}\n\nconst style = {\n  width: ' 100%',\n  display: ' flex',\n  justifyContent: ' space-between'\n}\nfunction Voltages() {\n  const voltages = useRecoilValue(voltagesState)\n  return (\n    <>\n      <div style={style}>\n        <Tag>Vmin: {formatVoltage(voltages.vmin)}</Tag>\n        <Tag>Vmax: {formatVoltage(voltages.vmax)}</Tag>\n      </div>\n      <div style={style}>\n        <Tag>Vavr: {formatVoltage(voltages.vavr)}</Tag>\n        <Tag>Vp-p: {formatVoltage(voltages.vpp)}</Tag>\n      </div>\n    </>\n  )\n}\nexport default function Stats() {\n  return (\n    <div>\n      <Panel header=\"Voltages\" shaded collapsible defaultExpanded>\n        <Voltages />\n        <div style={style}>\n          <Wavelength />\n          <Frequency />\n        </div>\n        <div style={style}>\n          <FreeMemory />\n          <FPS />\n        </div>\n      </Panel>\n    </div>\n  )\n}\n","import React from 'react'\n\nimport Trigger from './Trigger'\nimport Channels from './Channels'\nimport Scales from './Scales'\nimport SerialControls from './SerialControls'\nimport Stats from './Stats'\n\nfunction Controls() {\n  return (\n    <>\n      <SerialControls />\n      <Scales />\n      <Channels />\n      <Trigger />\n      <Stats />\n    </>\n  )\n}\n\nexport default Controls\n","import React from 'react'\n\nimport { Panel } from 'rsuite'\n\nexport default function About() {\n  return (\n    <Panel header=\"About\" shaded collapsible defaultExpanded>\n      <p>David Buezas 2020</p>\n      <a href=\"https://github.com/dbuezas/arduino-web-oscilloscope\">\n        https://github.com/dbuezas/arduino-web-oscilloscope\n      </a>\n    </Panel>\n  )\n}\n","import React from 'react'\n\nimport { Panel, Button, Notification, Steps } from 'rsuite'\nimport useCopy from '@react-hook/copy'\n\nconst chromeFlagsUrl =\n  'chrome://flags/#enable-experimental-web-platform-features'\nconst styles = {\n  width: '200px',\n  display: 'inline-table',\n  verticalAlign: 'top'\n}\nfunction EnableSerialInstructions() {\n  const { copy } = useCopy(chromeFlagsUrl)\n\n  return (\n    <div className=\"App\">\n      <Panel\n        shaded\n        bordered\n        style={{\n          margin: '20px auto',\n          overflow: 'scroll',\n          height: '100%',\n          zoom: 0.8\n        }}\n      >\n        <Panel\n          header={\n            <>\n              <p style={{ fontSize: 30 }}>\n                Enable experimental web platform features to activate the Web\n                Serial API{' '}\n              </p>\n              <br />\n            </>\n          }\n        >\n          <Steps vertical style={styles}>\n            <Steps.Item\n              title=\"Copy the chrome flags url\"\n              description={\n                <Button\n                  color=\"green\"\n                  onClick={() => {\n                    copy()\n                    Notification.success({\n                      title: 'It is now in your clipboard',\n                      description: chromeFlagsUrl\n                    })\n                  }}\n                >\n                  {chromeFlagsUrl}\n                </Button>\n              }\n            />\n            <Steps.Item\n              title=\"Paste it in the address bar of the browser and press [enter]\"\n              description={\n                <>\n                  <img\n                    alt=\"\"\n                    src={process.env.PUBLIC_URL + '/address-bar.png'}\n                  ></img>\n                  <p>\n                    Right there. This will take you to the the page where you\n                    can support for the serial port.\n                  </p>\n                </>\n              }\n            />\n            <Steps.Item\n              title=\"Enable the experimental web platform features\"\n              description={\n                <img\n                  alt=\"\"\n                  src={\n                    process.env.PUBLIC_URL +\n                    '/ExperimentalWebPlatformFeatures.png'\n                  }\n                ></img>\n              }\n            />\n            <Steps.Item\n              title=\"Reload this page\"\n              description=\"And you'll be ready to use the oscilloscope\"\n            />\n            <Steps.Item\n              title=\"Enjoy\"\n              description={\n                <>\n                  <img\n                    width=\"500px\"\n                    alt=\"\"\n                    src={process.env.PUBLIC_URL + '/screenshot.png'}\n                  ></img>\n                  <p>\n                    Do not do something stupid, the board is connected to your\n                    computer so it shares Ground with it, also do not push more\n                    than 5v to it.\n                  </p>\n                </>\n              }\n            />\n          </Steps>\n        </Panel>\n      </Panel>\n    </div>\n  )\n}\n\nexport default EnableSerialInstructions\n","import React from 'react'\nimport Plot from './Plot/Plot'\n\nimport Controls from './Controls'\nimport { Panel, Container, Content, Sidebar } from 'rsuite'\nimport About from './About'\nimport EnableSerialInstructions from './EnableSerialInstructions'\n\nfunction getChromeVersion() {\n  const raw = navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./)\n  return Number(raw ? parseInt(raw[2], 10) : false)\n}\nfunction App() {\n  if (getChromeVersion() < 86)\n    return <p>Requires an updated version of Chrome ( 86.x.x)</p>\n  if (!navigator.serial) return <EnableSerialInstructions />\n  return (\n    <div className=\"App\">\n      <Container>\n        <Content>\n          <Panel shaded>\n            <Plot />\n          </Panel>\n        </Content>\n        <Sidebar width={261}>\n          <Controls />\n          <About />\n        </Sidebar>\n      </Container>\n    </div>\n  )\n}\n\nexport default App\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import './index.scss'\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\n\nimport App from './components/App'\nimport * as serviceWorker from './serviceWorker'\nimport { RecoilRoot } from 'recoil'\n\nReactDOM.render(\n  <React.StrictMode>\n    <RecoilRoot>\n      <App />\n    </RecoilRoot>\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister()\n"],"sourceRoot":""}